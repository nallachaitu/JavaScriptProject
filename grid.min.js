function defineDionGrid(){dataObj=function(){this.cssClass=this.type="";this.options=null;this.name=this.value=""};changeHandler=function(){this.callBacks=[]};changeHandler.prototype.subscribe=function(a){this.callBacks.push(a)};changeHandler.prototype.raiseCallBacks=function(a,b){for(var c=0;c<this.callBacks.length;c++)this.callBacks[c](a,b)};clsDionGrid=function(){this.parentDivId=this.gridName="";this.parentDivElement=null;this.defaultCellWidth=this.defaultCellHeight=1;this.defaultColGap=this.defaultRowGap=
0;this.curXLSColNo=this.curXLSRowNo=1;this.maxHeight=this.minHeight=this.width=this.maxWidth=this.minWidth=this.height=this.left=this.top=this.XLSColCount=this.XLSRowCount=0;this.displayCellArray=[];this.displayRowArray=[];this.displayColArray=[];this.XLSCellArray=[];this.XLSRowArray=[];this.XLSColArray=[];this.interpolationDiv=this.gridDiv=null;this.defaultEditableCellStyle="gridCellBorder ";this.defaultOddEditableCellStyle="oddGridCellBorder ";this.defaultEvenEditableCellStyle="evenGridCellBorder ";
this.defaultNonEditableCellStyle="gridCell ";this.defaultOddNonEditableCellStyle="oddGridCell ";this.defaultEvenNonEditableCellStyle="evenGridCell ";this.defaultGridDivStyle="gridDiv ";this.defaultTextAlign=" left";this.defaultErrorStyle="borderError";this.mode="select";this.interpolatedRange=this.dragItem="";this.selectedRange="0:0:0:0";this.showInterpolationDiv=!0;this.isCustomContextMenu=this.isCopyPasteEnabled=this.showContextMenu=!1;this.hasAutoHeight=this.hasAutoWidth=!0;this.contextMenuFn=
null;this.onCellChanged=new changeHandler;this.onCellClicked=null};clsDionGrid.prototype.createFullScreen=function(){this.createGridDiv();this.createScreenGrid();this.showInterpolationDiv&&this.createInterpolationDiv();this.attachGridDiv()};clsDionGrid.prototype.createGridDiv=function(){var a=this;this.gridDiv=document.createElement("div");this.gridDiv.id=this.gridName+":gridDiv";this.gridDiv.isAttached=!1;this.gridDiv.style.left=this.left+"px";this.gridDiv.style.top=this.top+"px";this.gridDiv.style.width=
this.width+"px";this.gridDiv.style.height=this.height+"px";this.gridDiv.className=this.defaultGridDivStyle;this.gridDiv.onmouseout=function(b){var c=a.parentDivElement,d=this.offsetLeft+getLengthFromString(this.style.width),e=this.offsetLeft+getLengthFromString(c.style.left),f=this.offsetTop+getLengthFromString(this.style.height)+getLengthFromString(c.style.top),c=this.offsetTop+getLengthFromString(c.style.top);if(a.dragItem=="cell"){if(b==null)b=window.event;var g=0,h=0;b.pageX?(g=b.pageX,h=b.pageY):
(g=b.clientX+document.documentElement.scrollLeft,h=b.clientY+document.documentElement.scrollTop);var i,j,k;h>f&&g>d?(i=a.selectedRange.split(":"),j=parseInt(i[2])+1>a.XLSRowCount?parseInt(i[2]):parseInt(i[2])+1,k=parseInt(i[3])+1>a.XLSColCount?parseInt(i[3]):parseInt(i[3])+1):h>f?(i=a.selectedRange.split(":"),j=parseInt(i[2])+1>a.XLSRowCount?parseInt(i[2]):parseInt(i[2])+1,k=i[3]):g>d?(i=a.selectedRange.split(":"),j=i[2],k=parseInt(i[3])+1>a.XLSColCount?parseInt(i[3]):parseInt(i[3])+1):h<c&&g<e?(i=
a.selectedRange.split(":"),j=parseInt(i[2])-1<1?1:parseInt(i[2])-1,k=parseInt(i[3])-1<1?1:parseInt(i[3])-1):h<c?(i=a.selectedRange.split(":"),j=parseInt(i[2])-1<1?1:parseInt(i[2])-1,k=i[3]):g<e&&(i=a.selectedRange.split(":"),j=i[2],k=parseInt(i[3])-1<1?1:parseInt(i[3])-1);if(i!=void 0||i!=null)if(j=i[0]+":"+i[1]+":"+j+":"+k,a.selectedRange!=j)a.selectedRange=j,a.applyRange();preventDefaultBehaviour(b)}else if(a.dragItem=="interpolationDiv"){if(b==null)b=window.event;b.pageX?(g=b.pageX,h=b.pageY):
(g=b.clientX+document.documentElement.scrollLeft,h=b.clientY+document.documentElement.scrollTop);i=a.interpolatedRange.split(":");h>f&&g>d?(j=parseInt(i[2])+1>a.XLSRowCount?parseInt(i[2]):parseInt(i[2])+1,k=parseInt(i[3])+1>a.XLSColCount?parseInt(i[3]):parseInt(i[3])+1):h>f?(j=parseInt(i[2])+1>a.XLSRowCount?parseInt(i[2]):parseInt(i[2])+1,k=i[3]):g>d?(j=i[2],k=parseInt(i[3])+1>a.XLSColCount?parseInt(i[3]):parseInt(i[3])+1):h<c&&g<e?(j=parseInt(i[2])-1<1?1:parseInt(i[2])-1,k=parseInt(i[3])-1<1?1:parseInt(i[3])-
1):h<c?(j=parseInt(i[2])-1<1?1:parseInt(i[2])-1,k=i[3]):g<e&&(j=i[2],k=parseInt(i[3])-1<1?1:parseInt(i[3])-1);b=getStartX(a.selectedRange);d=getStartY(a.selectedRange);e=getEndX(a.selectedRange);f=getEndY(a.selectedRange);_endCellX=j;_endCellY=k;Math.abs(f-_endCellY)>Math.abs(e-_endCellX)?_endCellY>f?(a.interpolatedRange!=""&&a.borderMapper(a.interpolatedRange,"noneDashed"),a.interpolatedRange=b+":"+d+":"+e+":"+_endCellY,a.borderMapper(a.interpolatedRange,"allDashed")):_endCellY<d?(a.interpolatedRange!=
""&&a.borderMapper(a.interpolatedRange,"noneDashed"),a.interpolatedRange=b+":"+_endCellY+":"+e+":"+f,a.borderMapper(a.interpolatedRange,"allDashed")):(a.borderMapper(a.interpolatedRange,"noneDashed"),a.interpolatedRange=""):_endCellX>e?(a.interpolatedRange!=""&&a.borderMapper(a.interpolatedRange,"noneDashed"),a.interpolatedRange=b+":"+d+":"+_endCellX+":"+f,a.borderMapper(a.interpolatedRange,"allDashed")):_endCellX<b?(a.interpolatedRange!=""&&a.borderMapper(a.interpolatedRange,"noneDashed"),a.interpolatedRange=
_endCellX+":"+d+":"+e+":"+f,a.borderMapper(a.interpolatedRange,"allDashed")):(a.borderMapper(a.interpolatedRange,"noneDashed"),a.interpolatedRange="");a.applyRange()}};this.gridDiv.onmouseup=function(){a.clearDrag()};this.gridDiv.onmousedown=function(){a.hideContextMenu()};this.gridDiv.onmousemove=function(){}};clsDionGrid.prototype.attachGridDiv=function(){if(!this.gridDiv.isAttached)this.parentDivElement&&this.parentDivElement.childNodes&&this.parentDivElement.childNodes.length>0?this.parentDivElement.insertBefore(this.gridDiv,
this.parentDivElement.childNodes[0]):this.parentDivElement.appendChild(this.gridDiv),this.gridDiv.isAttached=!0};clsDionGrid.prototype.removeGridDiv=function(){if(this.gridDiv.isAttached)this.parentDivElement.removeChild(this.gridDiv),this.gridDiv.isAttached=!1};clsDionGrid.prototype.createScreenGrid=function(){this.displayCellArray[0]=null;for(var a=1;a<=this.XLSRowCount;a++){this.displayCellArray[a]=[];this.displayCellArray[a][0]=null;for(var b=1;b<=this.XLSColCount;b++){var c=this.createCellDiv(a,
b);this.displayCellArray[a][b]=c;this.insertFormatter("input",a,b)}}};clsDionGrid.prototype.createXLSGridInMemory=function(){this.XLSCellArray[0]=null;this.XLSRowArray[0]=null;this.XLSColArray[0]=null;this.XLSRowArray[0]=null;for(var a=1;a<=this.XLSRowCount;a++)this.XLSRowArray[a]=new clsMemoryRow(this.defaultCellHeight),this.XLSRowArray[a].rowNo=a,this.XLSRowArray[a].gap=this.defaultRowGap;this.XLSColArray[0]=null;for(var b=1;b<=this.XLSColCount;b++)this.XLSColArray[b]=new clsMemoryCol(this.defaultCellWidth),
this.XLSColArray[b].colNo=b,this.XLSColArray[b].gap=this.defaultColGap;for(a=1;a<=this.XLSRowCount;a++){this.XLSCellArray[a]=[];this.XLSCellArray[a][0]=null;for(b=1;b<=this.XLSColCount;b++)this.initCellInMemory(a,b)}};clsDionGrid.prototype.createInterpolationDiv=function(){var a=this;this.interpolationDiv=document.createElement("div");this.interpolationDiv.className="interpolationDivClass";this.gridDiv.appendChild(this.interpolationDiv);this.interpolationDiv.onmousedown=function(b){a.saveOneScreenCellInMemory(a.curXLSRowNo,
a.curXLSColNo);a.dragItem="interpolationDiv";preventDefaultBehaviour(b);document.onmouseup=OnMouseUp};this.interpolationDiv.onmouseup=function(){a.dragItem="";if(a.interpolatedRange!="")a.borderMapper(a.interpolatedRange,"noneDashed"),a.selectedRange=a.interpolatedRange,a.interpolatedRange="",a.applyRange()}};clsDionGrid.prototype.initCellInMemory=function(a,b){this.XLSCellArray[a]||(this.XLSCellArray[a]=[]);this.displayCellArray[a]||(this.displayCellArray[a]=[]);this.XLSCellArray[a][b]=new clsMemoryCell;
this.XLSCellArray[a][b].parentXLSArray=this.XLSCellArray;this.XLSCellArray[a][b].parentRow=this.XLSRowArray[a];this.XLSCellArray[a][b].parentCol=this.XLSColArray[b];this.XLSCellArray[a][b].className=(a%2?this.defaultEvenEditableCellStyle:this.defaultOddEditableCellStyle)+" "+this.defaultTextAlign+"AlignCellClass ";this.XLSCellArray[a][b].grandParentDionGrid=this;this.XLSCellArray[a][b].updateCellByString("");var c=this.createCellDiv(a,b);this.displayCellArray[a][b]=c;this.insertFormatter("input",
a,b)};clsDionGrid.prototype.updateXLSCount=function(a,b){for(var c=this.XLSRowCount+1;c<=a;c++)this.XLSRowArray[c]=new clsMemoryRow(this.defaultCellHeight),this.XLSRowArray[c].rowNo=c,this.XLSRowArray[c].gap=this.defaultRowGap;this.XLSColArray[0]=null;for(var d=this.XLSColCount+1;d<=b;d++)this.XLSColArray[d]=new clsMemoryCol(this.defaultCellWidth),this.XLSColArray[d].colNo=d,this.XLSColArray[d].gap=this.defaultRowGap;for(c=1;c<=this.XLSRowCount;c++)for(d=this.XLSColCount+1;d<=b;d++)this.initCellInMemory(c,
d);for(c=this.XLSRowCount+1;c<=a;c++)for(d=1;d<=b&&d<=this.XLSColCount;d++)this.initCellInMemory(c,d);for(c=this.XLSRowCount+1;c<=a;c++)for(d=this.XLSColCount+1;d<=b;d++)this.initCellInMemory(c,d);this.XLSRowCount=a;this.XLSColCount=b};clsDionGrid.prototype.insertRow=function(a){this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo);this.updateXLSCount(this.XLSRowCount+1,this.XLSColCount);if(!(a<1||a>this.XLSRowCount)){for(var b=this.XLSRowCount;b>a;b--)this.XLSRowArray[b]=this.XLSRowArray[b-
1],this.XLSRowArray[b].rowNo=b,this.XLSRowArray[b].gap=this.defaultRowGap;this.XLSRowArray[a]=new clsMemoryRow(this.defaultCellHeight);this.XLSRowArray[a].rowNo=a;for(var c=[],b=1;b<=this.XLSColCount;b++)if(this.XLSCellArray[a][b].spannedBy.row!=0&&this.XLSCellArray[a][b].spannedBy.col!=0){var d=this.XLSCellArray[this.XLSCellArray[a][b].spannedBy.row][this.XLSCellArray[a][b].spannedBy.col];this.XLSCellArray[a][b].spannedBy.row!=a&&indexOfElementInArray(c,d)==-1&&c.push(d)}for(b=0;b<c.length;b++)c[b].rowSpan++;
for(b=this.XLSRowCount;b>a;b--)for(c=1;c<=this.XLSColCount;c++)this.XLSCellArray[b][c]=this.XLSCellArray[b-1][c],this.XLSCellArray[b][c].parentRow=this.XLSRowArray[b],this.XLSCellArray[b][c].parentCol=this.XLSColArray[c];for(c=1;c<=this.XLSColCount;c++)this.initCellInMemory(a,c);this.adjustNamedRange(a+":1:"+this.XLSRowCount+":"+this.XLSColCount,1,0);this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.insertRowAfter=function(a){this.saveOneScreenCellInMemory(this.curXLSRowNo,
this.curXLSColNo);this.updateXLSCount(this.XLSRowCount+1,this.XLSColCount);if(!(a+1<1||a+1>this.XLSRowCount)){for(var b=this.XLSRowCount;b>a+1;b--)this.XLSRowArray[b]=this.XLSRowArray[b-1],this.XLSRowArray[b].rowNo=b,this.XLSRowArray[b].gap=this.defaultRowGap;this.XLSRowArray[a+1]=new clsMemoryRow(this.defaultCellHeight);this.XLSRowArray[a+1].rowNo=a+1;for(var c=[],b=1;b<=this.XLSColCount;b++)if(this.XLSCellArray[a][b].spannedBy.row!=0&&this.XLSCellArray[a][b].spannedBy.col!=0){var d=this.XLSCellArray[this.XLSCellArray[a][b].spannedBy.row][this.XLSCellArray[a][b].spannedBy.col];
this.XLSCellArray[a][b].spannedBy.row!=a&&indexOfElementInArray(c,d)==-1&&c.push(d)}for(b=0;b<c.length;b++)c[b].rowSpan++;for(b=this.XLSRowCount;b>a+1;b--)for(c=1;c<=this.XLSColCount;c++)this.XLSCellArray[b][c]=this.XLSCellArray[b-1][c],this.XLSCellArray[b][c].parentRow=this.XLSRowArray[b],this.XLSCellArray[b][c].parentCol=this.XLSColArray[c];for(c=1;c<=this.XLSColCount;c++)this.initCellInMemory(a+1,c);this.adjustNamedRange(a+":1:"+this.XLSRowCount+":"+this.XLSColCount,1,0);this.refreshSpan();this.updateScreenFromXLS();
this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.insertMultipleRow=function(a,b){this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo);if(!(b<1||a<1||a>this.XLSRowCount+1)){for(var c=1;c<=b;c++)this.XLSCellArray[this.XLSRowCount+c]=[];for(c=this.XLSRowCount;c>=a+b;c--)this.XLSRowArray[c]=this.XLSRowArray[c-b],this.XLSRowArray[c].rowNo=c,this.XLSRowArray[c].gap=this.defaultRowGap;for(c=0;c<b;c++)this.XLSRowArray[a+c]=new clsMemoryRow(this.defaultCellHeight),this.XLSRowArray[a+
c].rowNo=a+c;for(c=this.XLSRowCount;c>=a+b;c--)for(var d=1;d<=this.XLSColCount;d++)this.XLSCellArray[c][d]=this.XLSCellArray[c-b][d],this.XLSCellArray[c][d].parentRow=this.XLSRowArray[c],this.XLSCellArray[c][d].parentCol=this.XLSColArray[d];for(c=0;c<b;c++)for(d=1;d<=this.XLSColCount;d++)this.initCellInMemory(a+c,d);this.updateXLSCount(this.XLSRowCount+b,this.XLSColCount);this.adjustNamedRange(a+":1:"+this.XLSRowCount+":"+this.XLSColCount,b,0);this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};
clsDionGrid.prototype.insertCol=function(a){this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo);this.updateXLSCount(this.XLSRowCount,this.XLSColCount+1);if(!(a<1||a>this.XLSColCount)){for(var b=this.XLSColCount;b>a;b--)this.XLSColArray[b]=this.XLSColArray[b-1],this.XLSColArray[b].colNo=b,this.XLSColArray[b].gap=this.defaultColGap;this.XLSColArray[a]=new clsMemoryCol(this.defaultCellWidth);this.XLSColArray[a].colNo=a;for(var b=[],c=1;c<=this.XLSRowCount;c++)if(this.XLSCellArray[c][a].spannedBy.row!=
0&&this.XLSCellArray[c][a].spannedBy.col!=0){var d=this.XLSCellArray[this.XLSCellArray[c][a].spannedBy.row][this.XLSCellArray[c][a].spannedBy.col];this.XLSCellArray[a][c].spannedBy.col!=a&&indexOfElementInArray(b,d)==-1&&b.push(d)}for(c=0;c<b.length;c++)b[c].colSpan++;for(b=this.XLSColCount;b>a;b--)for(c=1;c<=this.XLSRowCount;c++)this.XLSCellArray[c][b]=this.XLSCellArray[c][b-1],this.XLSCellArray[c][b].parentRow=this.XLSRowArray[c],this.XLSCellArray[c][b].parentCol=this.XLSColArray[b];for(c=1;c<=
this.XLSRowCount;c++)this.initCellInMemory(c,a);this.adjustNamedRange("1:"+a+":"+this.XLSRowCount+":"+this.XLSColCount,0,1);this.refreshSpan();this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.insertColAfter=function(a){this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo);this.updateXLSCount(this.XLSRowCount,this.XLSColCount+1);if(!(a+1<1||a+1>this.XLSColCount)){for(var b=this.XLSColCount;b>a+1;b--)this.XLSColArray[b]=this.XLSColArray[b-
1],this.XLSColArray[b].colNo=b,this.XLSColArray[b].gap=this.defaultColGap;this.XLSColArray[a+1]=new clsMemoryCol(this.defaultCellWidth);this.XLSColArray[a+1].colNo=a+1;for(var b=[],c=1;c<=this.XLSRowCount;c++)if(this.XLSCellArray[c][a].spannedBy.row!=0&&this.XLSCellArray[c][a].spannedBy.col!=0){var d=this.XLSCellArray[this.XLSCellArray[c][a].spannedBy.row][this.XLSCellArray[c][a].spannedBy.col];this.XLSCellArray[c][a].spannedBy.col!=a&&indexOfElementInArray(b,d)==-1&&b.push(d)}for(c=0;c<b.length;c++)b[c].colSpan++;
for(b=this.XLSColCount;b>a+1;b--)for(c=1;c<=this.XLSRowCount;c++)this.XLSCellArray[c][b]=this.XLSCellArray[c][b-1],this.XLSCellArray[c][b].parentRow=this.XLSRowArray[c],this.XLSCellArray[c][b].parentCol=this.XLSColArray[b];for(c=1;c<=this.XLSRowCount;c++)this.initCellInMemory(c,a+1);this.adjustNamedRange("1:"+a+":"+this.XLSRowCount+":"+this.XLSColCount,0,1);this.refreshSpan();this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.insertMultipleCol=function(a,
b){this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo);if(!(b<1||a<1||a>this.XLSColCount+1)){for(var c=this.XLSColCount;c>=a+b;c--)this.XLSColArray[c]=this.XLSColArray[c-b],this.XLSColArray[c].colNo=c,this.XLSColArray[c].gap=this.defaultColGap;for(var d=0;d<b;d++)this.XLSColArray[a+d]=new clsMemoryCol(this.defaultCellWidth),this.XLSColArray[a+d].colNo=a+d;for(c=this.XLSColCount;c>=a+b;c--)for(d=1;d<=this.XLSRowCount;d++)this.XLSCellArray[d][c]=this.XLSCellArray[d][c-b],this.XLSCellArray[d][c].parentRow=
this.XLSRowArray[d],this.XLSCellArray[d][c].parentCol=this.XLSColArray[c];for(d=0;d<b;d++)for(c=1;c<=this.XLSRowCount;c++)this.initCellInMemory(c,a+d);this.updateXLSCount(this.XLSRowCount,this.XLSColCount+b);this.adjustNamedRange("1:"+a+":"+this.XLSRowCount+":"+this.XLSColCount,0,b);this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.deleteCol=function(a){if(this.XLSColCount!=1&&(this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo),!(a<1||
a>this.XLSColCount))){for(var b=a;b<this.XLSColCount;b++)this.XLSColArray[b]=this.XLSColArray[b+1],this.XLSColArray[b].colNo=b;for(var b=[],c=1;c<=this.XLSRowCount;c++){var d=this.XLSCellArray[c][a];d.spannedBy.row!=0&&d.spannedBy.col!=0&&(d=this.XLSCellArray[d.spannedBy.row][d.spannedBy.col],indexOfElementInArray(b,d)==-1&&b.push(d))}for(c=0;c<b.length;c++)b[c].colSpan--;for(b=a;b<this.XLSColCount;b++)for(c=1;c<=this.XLSRowCount;c++)this.XLSCellArray[c][b]=this.XLSCellArray[c][b+1],this.XLSCellArray[c][b].parentRow=
this.XLSRowArray[c],this.XLSCellArray[c][b].parentCol=this.XLSColArray[b];for(c=1;c<=this.XLSRowCount;c++)this.XLSCellArray[c][this.XLSColCount]=null,this.XLSCellArray[c].splice(this.XLSColCount,1),this.displayCellArray[c].splice(this.XLSColCount,1);this.curXLSColNo==this.XLSColCount&&this.XLSColCount!=1&&this.curXLSColNo--;this.XLSColCount=Math.max(1,this.XLSColCount-1);(!this.XLSCellArray[1]||!this.XLSCellArray[1][1])&&this.initCellInMemory(1,1);this.adjustNamedRange("1:"+a+":"+this.XLSRowCount+
":"+this.XLSColCount,0,-1);this.refreshSpan();this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.deleteRow=function(a){if(this.XLSRowCount!=1&&(this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo),!(a<1||a>this.XLSRowCount))){for(var b=a;b<this.XLSRowCount;b++)this.XLSRowArray[b]=this.XLSRowArray[b+1],this.XLSRowArray[b].rowNo=b;for(var c=[],b=1;b<=this.XLSColCount;b++)if(this.XLSCellArray[a][b].spannedBy.row!=0&&this.XLSCellArray[a][b].spannedBy.col!=
0){var d=this.XLSCellArray[this.XLSCellArray[a][b].spannedBy.row][this.XLSCellArray[a][b].spannedBy.col];indexOfElementInArray(c,d)==-1&&c.push(d)}for(b=0;b<c.length;b++)c[b].rowSpan--;for(b=a;b<this.XLSRowCount;b++)for(c=1;c<=this.XLSColCount;c++)this.XLSCellArray[b][c]=this.XLSCellArray[b+1][c],this.XLSCellArray[b][c].parentRow=this.XLSRowArray[b],this.XLSCellArray[b][c].parentCol=this.XLSColArray[c];this.displayCellArray.splice(this.XLSRowCount,1);this.XLSCellArray.splice(this.XLSRowCount,1);this.XLSRowArray.splice(this.XLSRowCount,
1);this.curXLSRowNo==this.XLSRowCount&&this.XLSRowCount!=1&&this.curXLSRowNo--;this.XLSRowCount=Math.max(1,this.XLSRowCount-1);(!this.XLSCellArray[1]||!this.XLSCellArray[1][1])&&this.initCellInMemory(1,1);this.adjustNamedRange(a+":1:"+this.XLSRowCount+":"+this.XLSColCount,-1,0);this.refreshSpan();this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.deleteMultipleRow=function(a,b){this.XLSRowCount<b&&(b=this.XLSRowCount-1);this.saveOneScreenCellInMemory(this.curXLSRowNo,
this.curXLSColNo);if(!(a<1||a>this.XLSRowCount||b<1)){a+b>this.XLSRowCount&&(b=this.XLSRowCount-a+1);for(var c=a;c+b<=this.XLSRowCount;c++)this.XLSRowArray[c]=this.XLSRowArray[c+b],this.XLSRowArray[c].rowNo=c;for(c=a;c+b<=this.XLSRowCount;c++)for(var d=1;d<=this.XLSColCount;d++)this.XLSCellArray[c][d]=this.XLSCellArray[c+b][d],this.XLSCellArray[c][d].parentRow=this.XLSRowArray[c],this.XLSCellArray[c][d].parentCol=this.XLSColArray[d];for(d=0;d<b;d++)this.displayCellArray.splice(this.XLSRowCount-d),
this.XLSCellArray.splice(this.XLSRowCount-d);this.XLSRowCount-=b;this.XLSRowCount-=b;this.XLSRowCount=Math.max(1,this.XLSRowCount-b);if(this.curXLSRowNo>this.XLSRowCount)this.curXLSRowNo=this.XLSRowCount;(!this.XLSCellArray[1]||!this.XLSCellArray[1][1])&&this.initCellInMemory(1,1);this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.deleteMultipleCol=function(a,b){this.XLSColCount<b&&(b=this.XLSColCount-1);this.saveOneScreenCellInMemory(this.curXLSRowNo,
this.curXLSColNo);if(!(a<1||a>this.XLSColCount||b<1)){a+b>this.XLSColCount&&(b=this.XLSColCount-a+1);for(var c=a;c+b<=this.XLSColCount;c++)this.XLSColArray[c]=this.XLSColArray[c+b],this.XLSColArray[c].colNo=c;for(c=a;c+b<=this.XLSColCount;c++)for(var d=1;d<=this.XLSRowCount;d++)this.XLSCellArray[d][c]=this.XLSCellArray[d][c+b],this.XLSCellArray[d][c].parentRow=this.XLSRowArray[d],this.XLSCellArray[d][c].parentCol=this.XLSColArray[c];for(c=1;c<=this.XLSRowCount;c++)this.XLSCellArray[c][this.XLSColCount-
d]=null,this.displayCellArray[c].splice(this.XLSColCount-d),this.XLSCellArray[c].splice(this.XLSColCount-d);this.XLSColCount=Math.max(1,this.XLSColCount-b);if(this.curXLSColNo>this.XLSColCount)this.curXLSColNo=this.XLSColCount;(!this.XLSCellArray[1]||!this.XLSCellArray[1][1])&&this.initCellInMemory(1,1);this.updateScreenFromXLS();this.refreshGridCells();this.refreshHeaders()}};clsDionGrid.prototype.copyRange=function(a){this.saveOneScreenCellInMemory(this.curXLSRowNo,this.curXLSColNo);copiedRange=
"";workbook.copiedCellArray=[];var b=a.split(":");if(b.length!=4)return!1;else{var c=parseInt(b[0]),d=parseInt(b[1]),e=parseInt(b[2]),b=parseInt(b[3]);if(c>e)var f=e,e=c,c=f;d>b&&(f=b,b=d,d=f);for(f=0;f<Math.abs(c-e)+1;f++){if(f+c>this.XLSRowCount)break;workbook.copiedCellArray[f]=[];for(var g=0;g<Math.abs(d-b)+1;g++)g+d>this.XLSColCount||(workbook.copiedCellArray[f][g]=this.XLSCellArray[f+c][g+d].copyCell())}}copiedRange=a;workbook.setCopiedRange(this.gridName,copiedRange)};clsDionGrid.prototype.pasteCopiedCells=
function(a,b){var c=workbook.copiedCellArray.length,d=0;if(workbook.copiedCellArray.length>0)d=workbook.copiedCellArray[0].length;var e=workbook.copiedCellArray;if(e.length>0)for(var f=0;f<c;f++){if(a+f>this.XLSRowCount)break;for(var g=0;g<d;g++)if(!(b+g>this.XLSColCount))this.XLSCellArray[a+f][b+g].updateCellByString(e[f][g].value),this.XLSCellArray[a+f][b+g].displayValue=e[f][g].displayValue,this.XLSCellArray[a+f][b+g].displayType=e[f][g].displayType,this.onCellChanged.raiseCallBacks(null,{row:a+
f,cell:b+g})}this.updateScreenFromXLS()};clsDionGrid.prototype.pasteSpecialCopiedCells=function(a,b){var c=workbook.copiedCellArray.length,d=0;if(workbook.copiedCellArray.length>0)d=workbook.copiedCellArray[0].length;var e=workbook.copiedCellArray;if(workbook.copiedCellArray.length>0)for(var f=0;f<c;f++){if(a+f>this.XLSRowCount)break;for(var g=0;g<d;g++)if(!(b+g>this.XLSColCount)){var h=this.XLSCellArray[a+f][b+g];this.moveCell(e[f][g],a+f,b+g);this.onCellChanged.raiseCallBacks(null,{row:a+f,cell:b+
g});e[f][g].cellType=="input"?e[f][g].type!="formula"?h.updateCellByString(e[f][g].stringValue):h.updateCellByString("="+modifyFormula(e[f][g].stringValue.substr(1),a-getStartX(copiedRange),b-getStartY(copiedRange))):(this.XLSCellArray[a+f][b+g]=e[f][g].copyCell(),this.XLSCellArray[a+f][b+g].updateCellByWidget())}}this.updateScreenFromXLS()};clsDionGrid.prototype.deleteSelectedCells=function(a,b){var c=a.split(":");if(c.length!=4)return!1;var d=parseInt(c[0]),e=parseInt(c[1]),f=parseInt(c[2]),c=parseInt(c[3]);
if(d>f)var g=f,f=d,d=g;e>c&&(g=c,c=e,e=g);var h=f-d+1,g=c-e+1;if(b=="left"){for(var i=d;i<=f;i++)for(var j=e;j<=this.XLSColCount-g;j++)this.XLSCellArray[i][j]=this.XLSCellArray[i][j+g],this.XLSCellArray[i][j].parentRow=this.XLSRowArray[i],this.XLSCellArray[i][j].parentCol=this.XLSColArray[j];for(i=d;i<=f;i++)for(j=this.XLSColCount-g+1;j<=this.XLSColCount;j++)this.XLSCellArray[i][j]=new clsMemoryCell,this.XLSCellArray[i][j].parentXLSArray=this.XLSCellArray,this.XLSCellArray[i][j].parentRow=this.XLSRowArray[i],
this.XLSCellArray[i][j].parentCol=this.XLSColArray[j],d=i%2?this.defaultEvenEditableCellStyle:this.defaultOddEditableCellStyle,this.XLSCellArray[i][j].className=d+" "+this.defaultTextAlign+"AlignCellClass ",this.XLSCellArray[i][j].grandParentDionGrid=this,this.XLSCellArray[i][j].updateCellByString("");this.updateScreenFromXLS()}else if(b=="up"){for(i=d;i<=this.XLSRowCount-h;i++)for(j=e;j<=c;j++)this.XLSCellArray[i][j]=this.XLSCellArray[i+h][j],this.XLSCellArray[i][j].parentRow=this.XLSRowArray[i],
this.XLSCellArray[i][j].parentCol=this.XLSColArray[j];for(i=this.XLSRowCount-h+1;i<=this.XLSRowCount;i++)for(j=e;j<=c;j++)this.XLSCellArray[i][j]=new clsMemoryCell,this.XLSCellArray[i][j].parentXLSArray=this.XLSCellArray,this.XLSCellArray[i][j].parentRow=this.XLSRowArray[i],this.XLSCellArray[i][j].parentCol=this.XLSColArray[j],d=i%2?this.defaultEvenEditableCellStyle:this.defaultOddEditableCellStyle,this.XLSCellArray[i][j].className=d+" "+this.defaultTextAlign+"AlignCellClass ",this.XLSCellArray[i][j].grandParentDionGrid=
this,this.XLSCellArray[i][j].updateCellByString("");this.updateScreenFromXLS()}else if(b=="noShift")for(i=d;i<=f;i++)for(j=e;j<=c;j++)if(this.XLSCellArray[i][j].readOnly==!1){if(this.XLSCellArray[i][j].cellType=="input")this.XLSCellArray[i][j].updateCellByString("");else if(this.XLSCellArray[i][j].cellType=="notional"||this.XLSCellArray[i][j].cellType=="date")this.XLSCellArray[i][j].value="",this.XLSCellArray[i][j].valueOptions.value="";this.refreshCell(i,j)}};clsDionGrid.prototype.isInXLSRange=function(a,
b){return a>0&&a<=this.XLSRowCount&&b>0&&b<=this.XLSColCount};clsDionGrid.prototype.isCurrentCell=function(a,b){return this.isInXLSRange(a,b)&&a==this.curXLSRowNo&&b==this.curXLSColNo};clsDionGrid.prototype.isFormula=function(a,b){if(this.isInXLSRange(a,b)&&this.isCurrentCell(a,b)&&this.mode=="edit"&&this.displayCellArray[a][b].cellType=="input"){var c=this.displayCellArray[a][b].editor.getValue();if(c.length>0&&c.substr(0,1)=="=")return!0}return!1};clsDionGrid.prototype.interpolate=function(a,b){var c=
getStartX(a),d=getStartY(a),e=getEndX(a),f=getEndY(a),g=getStartX(b),h=getStartY(b),i=getEndX(b),j=getEndY(b),k=!0,m=!0;g==c&&h==h&&(i>e||j>f)?(i==e?(h=f+1,m=!1):(g=e+1,m=!0),k=!0):(g==c?(j=d-1,m=!1):(i=c-1,m=!0),k=!1);var l,p;if(k)for(k=g;k<=i;k++)for(var n=h;n<=j;n++){l=c+(k-g)%(e-c+1);p=d+(n-h)%(f-d+1);var s=this.XLSCellArray[k][n],r=this.XLSCellArray[l][p];this.moveCell(r,k,n);if(r.type=="formula")s.updateCellByString(modifyFormula("="+r.stringValue.substr(1),k-l,n-p));else if(r.type=="integer"||
r.type=="float"){r=p=l=0;if(m){for(var q=c;q<=e;q++){var o=this.XLSCellArray[q][n];if(o.type=="integer"||o.type=="float")l>0&&(p+=o.value-r),l++,r=o.value}for(q=k-1;q>=c;q--)if(o=this.XLSCellArray[q][n],o.type=="integer"||o.type=="float"){r=o.value;break}}else{for(q=d;q<=f;q++)if(o=this.XLSCellArray[k][q],o.type=="integer"||o.type=="float")l>0&&(p+=o.value-r),l++,r=o.value;for(q=n-1;q>=d;q--)if(o=this.XLSCellArray[k][q],o.type=="integer"||o.type=="float"){r=o.value;break}}l=l>1?r+p/(l-1):r;s.updateCellByString(""+
l)}}else for(k=i;k>=g;k--)for(n=j;n>=h;n--)if(l=e+(k-i)%(e-c+1),p=f+(n-j)%(f-d+1),s=this.XLSCellArray[k][n],r=this.XLSCellArray[l][p],this.moveCell(r,k,n),r.type=="formula")s.updateCellByString(modifyFormula("="+r.stringValue.substr(1),k-l,n-p));else if(r.type=="integer"||r.type=="float"){r=p=l=0;if(m){for(q=c;q<=e;q++)if(o=this.XLSCellArray[q][n],o.type=="integer"||o.type=="float")l>0&&(p+=o.value-r),l++,r=o.value;for(q=k+1;q<=e;q++)if(o=this.XLSCellArray[q][n],o.type=="integer"||o.type=="float"){r=
o.value;break}}else{for(q=d;q<=f;q++)if(o=this.XLSCellArray[k][q],o.type=="integer"||o.type=="float")l>0&&(p+=o.value-r),l++,r=o.value;for(q=n+1;q<=f;q++)if(o=this.XLSCellArray[k][q],o.type=="integer"||o.type=="float"){r=o.value;break}}l=l>1?r-p/(l-1):r;s.updateCellByString(""+l)}};clsDionGrid.prototype.createCellDiv=function(a,b){var c=this,d=document.createElement("div");d.className=a%2?this.defaultEvenEditableCellStyle:this.defaultOddEditableCellStyle;d.id=this.gridName+":CDiv_"+a+"_"+b;this.gridDiv.appendChild(d);
d.tabIndex=0;d.onmousedown=function(a){c.hideContextMenu();c.clearInterpolation();if(a==null)a=window.event;if(a.button==1&&window.event!=null||a.button==0){var b=this.id.split(":")[1];document.onmouseup=OnMouseUp;var b=b.substr(5),d=b.indexOf("_"),h=parseInt(b.substr(0,d)),b=parseInt(b.substr(d+1)),d="",i=workbook.curDionGrid;if(!i)i=workbook.curDionGrid=c;i.displayCellArray[i.curXLSRowNo][i.curXLSColNo].editor&&(d=i.displayCellArray[i.curXLSRowNo][i.curXLSColNo].editor.getValue());if(a.shiftKey){i=
c.curXLSRowNo+":"+c.curXLSColNo+":"+h+":"+b;if(c.selectedRange!=i)c.selectedRange=i,c.applyRange();preventDefaultBehaviour(a)}else{var i=h+":"+b+":"+h+":"+b,j=workbook.isCurGrid(c);if(c.mode=="edit")if(d.length>0&&d.substr(0,1)=="=")preventDefaultBehaviour(a);else{if(!(h==c.curXLSRowNo&&b==c.curXLSColNo&&j))c.selectedRange=i,c.goToCell(h,b),preventDefaultBehaviour(a)}else if(!(h==c.curXLSRowNo&&b==c.curXLSColNo&&j))c.selectedRange=i,c.goToCell(h,b),preventDefaultBehaviour(a)}if(!c.XLSCellArray[h][b].readOnly)c.dragItem=
"cell"}};d.onmouseup=function(a){if(c.onCellClicked)c.onCellClicked(c.curXLSRowNo,c.curXLSColNo);if(a==null)a=window.event;if(c.dragItem=="cell"){if(a.button==1&&window.event!=null||a.button==0){var b=this.id.split(":")[1],b=b.substr(5),d=b.indexOf("_"),a=parseInt(b.substr(0,d)),b=parseInt(b.substr(d+1));_endCellX=a;_endCellY=b;d=workbook.curDionGrid;if(d.mode=="edit"&&d.isFormula(workbook.curXLSRowNo,workbook.curXLSColNo)&&(workbook.curXLSRowNo!=_endCellX||workbook.curXLSColNo!=_endCellY)){var h=
d.displayCellArray[d.curXLSRowNo][d.curXLSColNo].childNodes[0],i=h.selectionEnd,j="";workbook.isCurGrid(c)||(j=c.gridName+"."+j);j+=c.XLSCellArray[a][b].id;i>=0?h.value=h.value.substr(0,i)+j+h.value.substr(i):h.value+=j;d.selectedRange=d.curXLSRowNo+":"+d.curXLSColNo+":"+d.curXLSRowNo+":"+d.curXLSColNo;d.applyRange();if(this.showFormatDiv&&this.formulaBarInput!=null)d.formulaBarInput.value=h.value}else if(d.isInXLSRange(_endCellX,_endCellY)&&d.XLSCellArray[_endCellX][_endCellY].type=="label"&&(a=
c.selectedRange.split(":"),a=a[0]+":"+a[1]+":"+_endCellX+":"+_endCellY,c.selectedRange!=a))c.selectedRange=a,c.applyRange()}}else if((c.dragItem="interpolationDiv")&&c.interpolatedRange!="")c.borderMapper(c.interpolatedRange,"noneDashed"),c.interpolate(c.selectedRange,c.interpolatedRange),c.selectedRange=c.interpolatedRange,c.interpolatedRange="",c.applyRange(),c.updateScreenFromXLS();c.dragItem="";document.onmouseup=null;document.onmousemove=null};d.onmousemove=function(a){if(a==null)a=window.event;
var b=c.selectedRange.split(":"),d=this.id.split(":")[1],d=d.substr(5),h=d.indexOf("_"),i=parseInt(d.substr(0,h)),d=parseInt(d.substr(h+1));document.mouseup=OnMouseUp;if(c.dragItem=="cell"){_endCellX=i;_endCellY=d;i=b[0]+":"+b[1]+":"+_endCellX+":"+_endCellY;if(c.selectedRange!=i)c.selectedRange=i,c.applyRange();preventDefaultBehaviour(a)}else if(c.dragItem=="row"){_endCellX=i;_endCellY=c.XLSRowCount;i=b[0]+":"+b[1]+":"+_endCellX+":"+_endCellY;if(c.selectedRange!=i)c.selectedRange=i,c.applyRange();
preventDefaultBehaviour(a)}else if(c.dragItem=="col"){_endCellX=c.XLSColCount;_endCellY=d;i=b[0]+":"+b[1]+":"+_endCellX+":"+_endCellY;if(c.selectedRange!=i)c.selectedRange=i,c.applyRange();preventDefaultBehaviour(a)}else if(c.dragItem=="interpolationDiv"){var b=getStartX(c.selectedRange),h=getStartY(c.selectedRange),j=getEndX(c.selectedRange),k=getEndY(c.selectedRange);_endCellX=i;_endCellY=d;Math.abs(k-_endCellY)>Math.abs(j-_endCellX)?_endCellY>k?(c.interpolatedRange!=""&&c.borderMapper(c.interpolatedRange,
"noneDashed"),c.interpolatedRange=b+":"+h+":"+j+":"+_endCellY,c.borderMapper(c.interpolatedRange,"allDashed")):_endCellY<h?(c.interpolatedRange!=""&&c.borderMapper(c.interpolatedRange,"noneDashed"),c.interpolatedRange=b+":"+_endCellY+":"+j+":"+k,c.borderMapper(c.interpolatedRange,"allDashed")):(c.borderMapper(c.interpolatedRange,"noneDashed"),c.interpolatedRange=""):_endCellX>j?(c.interpolatedRange!=""&&c.borderMapper(c.interpolatedRange,"noneDashed"),c.interpolatedRange=b+":"+h+":"+_endCellX+":"+
k,c.borderMapper(c.interpolatedRange,"allDashed")):_endCellX<b?(c.interpolatedRange!=""&&c.borderMapper(c.interpolatedRange,"noneDashed"),c.interpolatedRange=_endCellX+":"+h+":"+j+":"+k,c.borderMapper(c.interpolatedRange,"allDashed")):(c.borderMapper(c.interpolatedRange,"noneDashed"),c.interpolatedRange="");preventDefaultBehaviour(a)}};d.oncontextmenu=function(a){if(c.showContextMenu==!0){var b=this.id.split(":")[1];if(a==null)a=window.event;var b=b.substr(5),d=b.indexOf("_"),h=parseInt(b.substr(0,
d)),i=parseInt(b.substr(d+1)),j=parseInt(b.substr(0,d)),k=parseInt(b.substr(d+1));c.hideContextMenu();b=new contextMenu;b.createContextMenu(this.gridName+":cellContextMenu");var m=d=0;a.pageX?(d=a.pageX,m=a.pageY):(d=a.clientX+document.documentElement.scrollLeft,m=a.clientY+document.documentElement.scrollTop);b.contextMenuDiv.style.left=d+"px";b.contextMenuDiv.style.top=m+"px";workbook.contextMenuDiv=b;c.isCustomContextMenu?(c.contextMenuFn&&c.contextMenuFn(c,j,k,b),b.contextMenuItemCount==0&&c.hideContextMenu()):
(d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("copy Range"),d.setLabel("Copy Range"),d.setAction(function(){c.hideContextMenu();c.copySelectedCells()}),b.addItem(d),workbook.copiedCellArray.length!=0&&(d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("pasteRange"),d.setLabel("Paste"),d.setAction(function(){c.hideContextMenu();c.pasteCopiedCells(j,k)}),b.addItem(d),d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("pasteSpecialRange"),d.setLabel("Paste Special"),
d.setAction(function(){c.hideContextMenu();c.pasteSpecialCopiedCells(j,k)}),b.addItem(d)),d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("deleteRange"),d.setLabel("delete shift left"),d.setAction(function(){c.hideContextMenu();c.deleteSelectedCells(c.selectedRange,"left")}),b.addItem(d),d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("deleteRangeUp"),d.setLabel("delete shift up"),d.setAction(function(){c.hideContextMenu();c.deleteSelectedCells(c.selectedRange,"up")}),
b.addItem(d),d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("deleteRangeNo"),d.setLabel("delete no shift"),d.setAction(function(){c.hideContextMenu();c.deleteSelectedCells(c.selectedRange,"noShift")}),b.addItem(d),d=new contextMenuItem,d.setParentDivId(b.contextMenuId),d.create("nameRange"),d.setLabel("Name the Range"),d.setAction(function(){c.hideContextMenu();var a=c.selectedRange.split(":"),a=getColLabelFromNumber(parseInt(a[1]))+a[0]+":"+getColLabelFromNumber(parseInt(a[3]))+
a[2];workbook.nameRange("kechit",this.gridName,a)}),b.addItem(d),c.displayCellArray[h][i].cellType=="combo"&&(h=new contextMenuItem,h.setParentDivId(b.contextMenuId),h.create("changeValues"),h.setLabel("Change Values"),h.setAction(function(){c.hideContextMenu();c.mode="none";var a=new comboEditValues;a.createComboEditValues(c.parentDivId,"ComboEditValuesDiv",function(){for(var b="",d=0;d<a.valuesInputArray.length;d++)b+=a.valuesInputArray[d].value+",";c.insertComboBox(j,k,{valueOptions:{possibleValues:b,
selectedIndex:0}});document.getElementById(c.parentDivId).removeChild(document.getElementById("ComboEditValuesDiv"));c.mode="select"})}),b.addItem(h)));document.onclick=c.hideContextMenu;preventDefaultBehaviour(a)}};d.ondblclick=function(a){var b=this.id.split(":")[1],b=b.substr(5),d=b.indexOf("_"),h=parseInt(b.substr(0,d)),b=parseInt(b.substr(d+1)),d=workbook.isCurGrid(c);if(!(c.mode=="edit"&&h==c.curXLSRowNo&&b==c.curXLSColNo&&d))c.goToCell(h,b),(!c.isInXLSRange(h,b)||c.XLSCellArray[h][b].readOnly==
!1)&&c.displayCellArray[c.curXLSRowNo][c.curXLSColNo].editor.focus(),c.mode="edit",preventDefaultBehaviour(a)};d.onfocus=function(){c.mode="select"};d.onblur=function(){c.mode="none";c.clearDrag()};return d};clsDionGrid.prototype.moveCell=function(a,b,c){if(this.isInXLSRange(b,c)){var d=this.XLSCellArray[b][c];if(a.cellType=="input"){if(d.cellType!="input")this.insertWidget("input",b,c,a),this.displayCellArray[b][c].editor.rowNo=b,this.displayCellArray[b][c].editor.colNo=c,d=this.XLSCellArray[b][c];
d.updateCellByString(a.stringValue);d.displayValue=convertTo(d.value,d.type,d.displayType);d.className=a.className;d.backgroundColor=a.backgroundColor;d.displayType=a.displayType}else this.isCurrentCell(b,c)?(this.insertWidget(a.cellType,b,c,a),this.displayCellArray[b][c].editor.rowNo=b,this.displayCellArray[b][c].editor.colNo=c):this.insertFormatter(a.cellType,b,c,a),d.value=a.value,d.valueOptions=a.valueOptions,d.backgroundColor=a.backgroundColor,d.displayType=a.displayType,d.className=a.className;
this.refreshCell(b,c)}};clsDionGrid.prototype.clearInterpolation=function(){if(this.interpolatedRange!="")this.borderMapper(this.interpolatedRange,"noneDashed"),getStartX(this.interpolatedRange),getStartY(this.interpolatedRange),getEndX(this.interpolatedRange),getEndY(this.interpolatedRange),this.interpolate(this.selectedRange,this.interpolatedRange),this.selectedRange=this.interpolatedRange,this.interpolatedRange="",this.applyRange(),this.updateScreenFromXLS()};clsDionGrid.prototype.clearDragValues=
function(){this.dragItem=""};clsDionGrid.prototype.clearDrag=function(){this.dragItem=""};clsDionGrid.prototype.adjustNamedRange=function(a,b,c){for(var d=workbook.nameMap.valSet(),e=0;e<d.length;e++){var f=d[e].split(".")[0];if(this.gridName==f){var g=d[e].split(".")[1];if(isCell(g)){var h=getCellRowCol(g.toUpperCase()),i=parseInt(h[1]),h=getColNoFromLabel(h[0]);isInRange(i,h,a)&&(b<0||c<0?workbook.nameMap.remove(e):d[e]=f+"."+modifyFormula(g,b,c))}else if(isRange(g))if(b>=0&&c>=0){var g=g.split(":"),
j,h=getCellRowCol(g[0].toUpperCase()),i=parseInt(h[1]),h=getColNoFromLabel(h[0]);j=isInRange(i,h,a)?modifyFormula(g[0],b,c):g[0];h=getCellRowCol(g[1].toUpperCase());i=parseInt(h[1]);h=getColNoFromLabel(h[0]);g=isInRange(i,h,a)?modifyFormula(g[1],b,c):g[1];d[e]=f+"."+j+":"+g}else if(b<=0&&c<=0){g=g.split(":");h=getCellRowCol(g[0].toUpperCase());j=parseInt(h[1]);var k=getColNoFromLabel(h[0]),h=getCellRowCol(g[1].toUpperCase()),i=parseInt(h[1]),h=getColNoFromLabel(h[0]);j=isInRange(j,k,a)?isInsideRange(j,
k,a)?modifyFormula(g[0],b,c):g[0]:g[0];g=isInRange(i,h,a)?modifyFormula(g[1],b,c):g[1];d[e]=j!=g?f+"."+j+":"+g:f+"."+j}}}}}defineDionGrid();function defineGridAPI(){clsDionGrid.prototype.setData=function(a,b,c,d,e){if(this.isInXLSRange(a,b)){if(e)this.XLSCellArray[a][b].cellType=e;this.XLSCellArray[a][b].cellType=="input"?(this.XLSCellArray[a][b].errorMesg="",this.XLSCellArray[a][b].updateCellByString(c)):(this.XLSCellArray[a][b].errorMesg="",this.XLSCellArray[a][b].value=c,d?this.XLSCellArray[a][b].valueOptions=d:this.XLSCellArray[a][b].valueOptions.value=c,this.XLSCellArray[a][b].updateCellByWidget());this.refreshCell(a,b)}};clsDionGrid.prototype.modifyData=
function(a,b,c){if(this.isInXLSRange(a,b)){if(this.XLSCellArray[a][b].cellType=="input")this.XLSCellArray[a][b].updateCellByString(value);else{if(c)for(var d in c)this.XLSCellArray[a][b].valueOptions[d]=c[d];this.XLSCellArray[a][b].updateCellByWidget()}this.refreshCell(a,b)}};clsDionGrid.prototype.setCellId=function(a,b,c){if(this.isInXLSRange(a,b))workbook.setCellId(c,this,this.XLSCellArray[a][b]),this.XLSCellArray[a][b].id=c};clsDionGrid.prototype.getCellId=function(a){return workbook.getCellById(a,
this)};clsDionGrid.prototype.setHighlight=function(a,b,c){if(this.isInXLSRange(a,b)){var d=this.XLSCellArray[a][b];d.className=c&&this.XLSCellArray[a][b].isVisible==!0?addClassName(d.className," highlightCell"):removeClassName(d.className,"highlightCell");this.refreshCell(a,b)}};clsDionGrid.prototype.setError=function(a,b,c){if(this.isInXLSRange(a,b))this.XLSCellArray[a][b].errorMesg=this.XLSCellArray[a][b].isVisible==!0?c:"",this.refreshCell(a,b)};clsDionGrid.prototype.setVisibility=function(a,b,
c){if(this.isInXLSRange(a,b))this.XLSCellArray[a][b].isVisible=c,this.refreshCell(a,b)};clsDionGrid.prototype.setTag=function(a,b,c){if(this.isInXLSRange(a,b))this.XLSCellArray[a][b].tag=c};clsDionGrid.prototype.setType=function(a,b,c){if(this.isInXLSRange(a,b))this.XLSCellArray[a][b].cellType=c,this.refreshCell(a,b)};clsDionGrid.prototype.setCurrentCell=function(a,b){if(this.isInXLSRange(a,b))this.curXLSRowNo=a,this.curXLSColNo=b};clsDionGrid.prototype.setOnCellClick=function(a){if(a)this.onCellClicked=
a};clsDionGrid.prototype.getData=function(a,b){return!this.isInXLSRange(a,b)?null:this.XLSCellArray[a][b].value};clsDionGrid.prototype.getOptions=function(a,b){return!this.isInXLSRange(a,b)?null:this.XLSCellArray[a][b].valueOptions};clsDionGrid.prototype.getTag=function(a,b){return!this.isInXLSRange(a,b)?null:this.XLSCellArray[a][b].tag};clsDionGrid.prototype.setContextMenuFn=function(a){this.contextMenuFn=a};clsDionGrid.prototype.setParentDivId=function(a){var b=this,c=document.getElementById(a);
this.parentDivElement=c;removeAllChildren(c);c.onmousedown=function(){if(!(workbook.curDionGrid.isFormula(workbook.curXLSRowNo,workbook.curXLSColNo)&&workbook.curDionGrid.mode=="edit"))workbook.curDionGrid=b};b.parentDivId=a};clsDionGrid.prototype.setParentDivElement=function(a){var b=this;this.parentDivElement=a;removeAllChildren(a);a.onmousedown=function(){if(!(workbook.curDionGrid.isFormula(workbook.curXLSRowNo,workbook.curXLSColNo)&&workbook.curDionGrid.mode=="edit"))workbook.curDionGrid=b}};
clsDionGrid.prototype.init=function(a,b){if(a){this.width=b.width;this.height=b.height;if(b.hasAutoWidth!=void 0)this.hasAutoWidth=b.hasAutoWidth,this.maxWidth=b.maxWidth,this.minWidth=b.minWidth;if(b.hasAutoHeight!=void 0)this.hasAutoHeight=b.hasAutoHeight,this.maxHeight=b.maxHeight,this.minHeight=b.minHeight;this.top=b.top?b.top:0;this.left=b.left?b.left:0;this.gridName=a;this.loneSquareWidth=40;this.loneSquareHeight=20;this.defaultEditableCellStyle=b.defaultEditableCellStyle?b.defaultEditableCellStyle:
"gridCellBorder ";this.defaultOddEditableCellStyle=b.defaultOddEditableCellStyle?b.defaultOddEditableCellStyle:"gridCellBorder ";this.defaultEvenEditableCellStyle=b.defaultEvenEditableCellStyle?b.defaultEvenEditableCellStyle:"gridCellBorder ";this.defaultGridDivStyle=b.defaultGridDivStyle?b.defaultGridDivStyle:"gridDiv ";this.defaultNonEditableCellStyle=b.defaultNonEditableCellStyle?b.defaultNonEditableCellStyle:"gridCell ";this.defaultOddNonEditableCellStyle=b.defaultOddNonEditableCellStyle?b.defaultOddNonEditableCellStyle:
"gridCell ";this.defaultEvenNonEditableCellStyle=b.defaultEvenNonEditableCellStyle?b.defaultEvenNonEditableCellStyle:"gridCell ";this.defaultCellHeight=b.defaultCellHeight?b.defaultCellHeight:20;this.defaultCellWidth=b.defaultCellWidth?b.defaultCellWidth:120;this.defaultRowGap=b.defaultRowGap?b.defaultRowGap:0;this.defaultColGap=b.defaultColGap?b.defaultColGap:0;this.isMouseWheel=b.isMouseWheel?b.isMouseWheel:!1;this.defaultTextAlign=b.defaultTextAlign?b.defaultTextAlign:" left";if(b.hideTopPanel)this.showInterpolationDiv=
b.hideTopPanel==!0?!1:!0;this.showContextMenu=b.showContextMenu?b.showContextMenu:!1;this.showInterpolationDiv=b.showInterpolationDiv?b.showInterpolationDiv:!1;this.isCustomContextMenu=b.isCustomContextMenu?b.isCustomContextMenu:!1;this.createFullScreen();this.createXLSGridInMemory();this.updateXLSCount(b.rows,b.cols);b.data&&this.setMatrix(b.data);if(b.columnWidths)for(var c=0;c<b.columnWidths.length&&c<this.XLSColCount;c++)this.XLSColArray[c+1].width=b.columnWidths[c];if(b.rowHeights)for(c=0;c<
b.rowHeights.length&&c<this.XLSRowCount;c++)this.XLSRowArray[c+1].height=b.rowHeights[c];this.showFormatDiv=!1;this.refreshSpan();this.refreshGridCells();this.updateScreenFromXLS();this.refreshHeaders();workbook.registerGrid(a,this)}};clsDionGrid.prototype.setMatrix=function(a){this.XLSCellArray=[];for(var b=1;b<=this.XLSRowCount;b++){this.XLSCellArray[b]=[];this.XLSCellArray[b][0]=null;for(var c=1;c<=this.XLSColCount;c++)if(this.initCellInMemory(b,c),!(a[b-1]==void 0||a[b-1][c-1]==void 0)){a[b-1][c-
1].type?a[b-1][c-1].type=="none"?(this.XLSCellArray[b][c].cellType="input",this.XLSCellArray[b][c].readOnly=!0,this.XLSCellArray[b][c].className=((b-1)%2?this.defaultEvenNonEditableCellStyle:this.defaultOddNonEditableCellStyle)+" "+this.defaultTextAlign+"AlignCellClass "):a[b-1][c-1].type=="dropdown"?this.XLSCellArray[b][c].cellType="combo":a[b-1][c-1].type=="classToggle"?(this.XLSCellArray[b][c].cellType="classToggle",this.XLSCellArray[b][c].readOnly=!0):this.XLSCellArray[b][c].cellType=a[b-1][c-
1].type:this.XLSCellArray[b][c].cellType="input";if(a[b-1][c-1].readOnly==!0)this.XLSCellArray[b][c].readOnly=!0;if(a[b-1][c-1].cssClass)this.XLSCellArray[b][c].className=a[b-1][c-1].cssClass+" ";if(a[b-1][c-1].rowSpan)this.XLSCellArray[b][c].rowSpan=a[b-1][c-1].rowSpan;if(a[b-1][c-1].colSpan)this.XLSCellArray[b][c].colSpan=a[b-1][c-1].colSpan;if(a[b-1][c-1].tag)this.XLSCellArray[b][c].tag=a[b-1][c-1].tag;if(a[b-1][c-1].isVisible!=void 0)this.XLSCellArray[b][c].isVisible=a[b-1][c-1].isVisible;if(a[b-
1][c-1].options)if(a[b-1][c-1].type=="dropdown"){for(var d=0;d<a[b-1][c-1].options.length;d++)if(!a[b-1][c-1].options[d].displayLabel)a[b-1][c-1].options[d].displayLabel=a[b-1][c-1].options[d].label;this.XLSCellArray[b-1][c-1].valueOptions={possibleValues:a[b-1][c-1].options,value:a[b-1][c-1].options[0].value,index:0,subIndex:-1}}else this.XLSCellArray[b][c].valueOptions=a[b-1][c-1].options;if(a[b-1][c-1].formatType)this.XLSCellArray[b][c].displayType=a[b-1][c-1].formatType.copy();if(a[b-1][c-1].value)this.XLSCellArray[b][c].valueOptions.value=
a[b-1][c-1].value,this.XLSCellArray[b][c].updateCellByWidget();this.XLSCellArray[b][c].cellType=="input"?this.XLSCellArray[b][c].updateCellByString(a[b-1][c-1].value):this.XLSCellArray[b][c].updateCellByWidget()}}};clsDionGrid.prototype.initialize=function(a,b){if(a){this.width=b.width;this.height=b.height;if(b.hasAutoWidth!=void 0)this.hasAutoWidth=b.hasAutoWidth,this.maxWidth=b.maxWidth,this.minWidth=b.minWidth;if(b.hasAutoHeight!=void 0)this.hasAutoHeight=b.hasAutoHeight,this.maxHeight=b.maxHeight,
this.minHeight=b.minHeight;this.top=b.top?b.top:0;this.left=b.left?b.left:0;this.lRowNo=this.XLSRowCount;this.lColNo=this.XLSColCount;this.gridName=a;this.loneSquareWidth=40;this.loneSquareHeight=20;this.defaultEditableCellStyle=b.defaultEditableCellStyle?b.defaultEditableCellStyle:"gridCellBorder ";this.defaultOddEditableCellStyle=b.defaultOddEditableCellStyle?b.defaultOddEditableCellStyle:"gridCellBorder ";this.defaultEvenEditableCellStyle=b.defaultEvenEditableCellStyle?b.defaultEvenEditableCellStyle:
"gridCellBorder ";this.defaultGridDivStyle=b.defaultGridDivStyle?b.defaultGridDivStyle:"gridDiv ";this.defaultNonEditableCellStyle=b.defaultNonEditableCellStyle?b.defaultNonEditableCellStyle:"gridCell ";this.defaultOddNonEditableCellStyle=b.defaultOddNonEditableCellStyle?b.defaultOddNonEditableCellStyle:"gridCell ";this.defaultEvenNonEditableCellStyle=b.defaultEvenNonEditableCellStyle?b.defaultEvenNonEditableCellStyle:"gridCell ";this.defaultCellHeight=b.defaultCellHeight?b.defaultCellHeight:20;this.defaultCellWidth=
b.defaultCellWidth?b.defaultCellWidth:120;this.defaultRowGap=b.defaultRowGap?b.defaultRowGap:0;this.defaultColGap=b.defaultColGap?b.defaultColGap:0;this.isMouseWheel=b.isMouseWheel?b.isMouseWheel:!1;this.defaultTextAlign=b.defaultTextAlign?b.defaultTextAlign:" left";if(b.hideTopPanel)this.showInterpolationDiv=b.hideTopPanel==!0?!1:!0;this.showContextMenu=b.showContextMenu?b.showContextMenu:!1;this.showInterpolationDiv=b.showInterpolationDiv?b.showInterpolationDiv:!1;this.isCustomContextMenu=b.isCustomContextMenu?
b.isCustomContextMenu:!1;this.createFullScreen();this.createXLSGridInMemory();if(b.data){var c=b.data.length-1;if(!c||c==0)return;var d=b.data[0].length-1;if(!d||d==0)return;this.updateXLSCount(c,d)}else this.updateXLSCount(b.rows,b.cols);b.data&&this.setMatrixData(b.data);if(b.columnWidths)for(c=0;c<b.columnWidths.length&&c<this.XLSColCount;c++)this.XLSColArray[c+1].width=b.columnWidths[c];if(b.rowHeights)for(c=0;c<b.rowHeights.length&&c<this.XLSRowCount;c++)this.XLSRowArray[c+1].height=b.rowHeights[c];
this.refreshSpan();this.refreshGridCells();this.updateScreenFromXLS();this.refreshHeaders();workbook.registerGrid(a,this)}};clsDionGrid.prototype.setMatrixData=function(a){this.XLSCellArray=[];for(var b=1;b<=this.XLSRowCount;b++){this.XLSCellArray[b]=[];this.XLSCellArray[b][0]=null;for(var c=1;c<=this.XLSColCount;c++)if(this.initCellInMemory(b,c),!(a[b]==void 0||a[b][c]==void 0)){a[b][c].type?a[b][c].type=="none"?(this.XLSCellArray[b][c].cellType="input",this.XLSCellArray[b][c].readOnly=!0,this.XLSCellArray[b][c].className=
(b%2?this.defaultEvenNonEditableCellStyle:this.defaultOddNonEditableCellStyle)+" "+this.defaultTextAlign+"AlignCellClass "):a[b][c].type=="dropdown"?this.XLSCellArray[b][c].cellType="combo":a[b][c].type=="classToggle"?(this.XLSCellArray[b][c].cellType="classToggle",this.XLSCellArray[b][c].readOnly=!0):this.XLSCellArray[b][c].cellType=a[b][c].type:this.XLSCellArray[b][c].cellType="input";if(a[b][c].readOnly==!0)this.XLSCellArray[b][c].readOnly=!0;if(a[b][c].cssClass)this.XLSCellArray[b][c].className=
a[b][c].cssClass+" ";if(a[b][c].rowSpan)this.XLSCellArray[b][c].rowSpan=a[b][c].rowSpan;if(a[b][c].colSpan)this.XLSCellArray[b][c].colSpan=a[b][c].colSpan;if(a[b][c].tag)this.XLSCellArray[b][c].tag=a[b][c].tag;a[b][c].name&&this.nameCell(b,c,a[b][c].name);if(a[b][c].isVisible!=void 0)this.XLSCellArray[b][c].isVisible=a[b][c].isVisible;if(a[b][c].options)if(a[b][c].type=="dropdown"){for(var d=0;d<a[b][c].options.length;d++)if(!a[b][c].options[d].displayLabel)a[b][c].options[d].displayLabel=a[b][c].options[d].label;
this.XLSCellArray[b][c].valueOptions={possibleValues:a[b][c].options,value:a[b][c].options[0].value,index:0,subIndex:-1}}else a[b][c].type=="currencyPair"?this.XLSCellArray[b][c].valueOptions=a[b][c].options:a[b][c].type=="toggle"?this.XLSCellArray[b][c].valueOptions=a[b][c].options:a[b][c].type=="notional"?this.XLSCellArray[b][c].valueOptions=a[b][c].options:a[b][c].type=="delta"?(this.XLSCellArray[b][c].valueOptions=a[b][c].options,this.XLSCellArray[b][c].readOnly=!0):this.XLSCellArray[b][c].valueOptions=
a[b][c].options;if(a[b][c].formatType)this.XLSCellArray[b][c].displayType=a[b][c].formatType.copy();if(a[b][c].value)this.XLSCellArray[b][c].valueOptions.value=a[b][c].value,this.XLSCellArray[b][c].updateCellByWidget();this.XLSCellArray[b][c].cellType=="input"?this.XLSCellArray[b][c].updateCellByString(a[b][c].value):this.XLSCellArray[b][c].updateCellByWidget()}}};clsDionGrid.prototype.resetDataOld=function(a,b,c){if(b)this.height=b;if(c)this.width=c;if((b=a.length)&&b!=0)if((c=a[0].length)&&c!=0){this.XLSCellArray=
[];this.updateXLSCount(b,c);for(b=1;b<=this.XLSRowCount;b++){this.XLSCellArray[b]=[];this.XLSCellArray[b][0]=null;for(c=1;c<=this.XLSColCount;c++)if(this.initCellInMemory(b,c),!(a[b-1]==void 0||a[b-1][c-1]==void 0)){a[b-1][c-1].type?a[b-1][c-1].type=="none"?(this.XLSCellArray[b][c].cellType="input",this.XLSCellArray[b][c].readOnly=!0,this.XLSCellArray[b][c].className=this.defaultNonEditableCellStyle+" "+this.defaultTextAlign+"AlignCellClass "):a[b-1][c-1].type=="dropdown"?this.XLSCellArray[b][c].cellType=
"combo":a[b-1][c-1].type=="classToggle"?(this.XLSCellArray[b][c].cellType="classToggle",this.XLSCellArray[b][c].readOnly=!0):this.XLSCellArray[b][c].cellType=a[b-1][c-1].type:this.XLSCellArray[b][c].cellType="input";if(a[b-1][c-1].readOnly==!0)this.XLSCellArray[b][c].readOnly=!0;if(a[b-1][c-1].cssClass)this.XLSCellArray[b][c].className=a[b-1][c-1].cssClass+" ";if(a[b-1][c-1].rowSpan)this.XLSCellArray[b][c].rowSpan=a[b-1][c-1].rowSpan;if(a[b-1][c-1].colSpan)this.XLSCellArray[b][c].colSpan=a[b-1][c-
1].colSpan;if(a[b-1][c-1].tag)this.XLSCellArray[b][c].tag=a[b-1][c-1].tag;if(a[b-1][c-1].isVisible!=void 0)this.XLSCellArray[b][c].isVisible=a[b-1][c-1].isVisible;if(a[b-1][c-1].options)if(a[b-1][c-1].type=="dropdown"){for(var d=0;d<a[b-1][c-1].options.length;d++)if(!a[b-1][c-1].options[d].displayLabel)a[b-1][c-1].options[d].displayLabel=a[b-1][c-1].options[d].label;this.XLSCellArray[b-1][c-1].valueOptions={possibleValues:a[b-1][c-1].options,value:a[b-1][c-1].options[0].value,index:0,subIndex:-1}}else this.XLSCellArray[b][c].valueOptions=
a[b-1][c-1].options;if(a[b-1][c-1].formatType)this.XLSCellArray[b][c].displayType=a[b-1][c-1].formatType.copy();if(a[b-1][c-1].value)this.XLSCellArray[b][c].valueOptions.value=a[b-1][c-1].value,this.XLSCellArray[b][c].updateCellByWidget();this.XLSCellArray[b][c].cellType=="input"?this.XLSCellArray[b][c].updateCellByString(a[b-1][c-1].value):this.XLSCellArray[b][c].updateCellByWidget()}}for(c=1;c<=this.XLSColCount;c++)if(!(a[0]==void 0||a[0][c-1]==void 0)&&a[0][c-1].width)this.XLSColArray[c].width=
a[0][c-1].width;this.refreshSpan();this.refreshHeaders();this.refreshGridCells();this.updateScreenFromXLS()}};clsDionGrid.prototype.resetData=function(a,b,c){if(b)this.height=b;if(c)this.width=c;if((b=a.length)&&b!=0)if((c=a[0].length)&&c!=0){this.XLSCellArray=[];this.XLSRowCount=b-1;this.XLSColCount=c-1;this.updateXLSCount(b-1,c-1);for(b=1;b<=this.XLSRowCount;b++){this.XLSCellArray[b]=[];this.XLSCellArray[b][0]=null;for(c=1;c<=this.XLSColCount;c++)if(this.initCellInMemory(b,c),!(a[b]==void 0||a[b][c]==
void 0)){a[b][c].type?a[b][c].type=="none"?(this.XLSCellArray[b][c].cellType="input",this.XLSCellArray[b][c].readOnly=!0,this.XLSCellArray[b][c].className=this.defaultNonEditableCellStyle+" "+this.defaultTextAlign+"AlignCellClass "):a[b][c].type=="dropdown"?this.XLSCellArray[b][c].cellType="combo":a[b][c].type=="classToggle"?(this.XLSCellArray[b][c].cellType="classToggle",this.XLSCellArray[b][c].readOnly=!0):this.XLSCellArray[b][c].cellType=a[b][c].type:this.XLSCellArray[b][c].cellType="input";if(a[b][c].readOnly==
!0)this.XLSCellArray[b][c].readOnly=!0;if(a[b][c].cssClass)this.XLSCellArray[b][c].className=a[b][c].cssClass+" ";if(a[b][c].rowSpan)this.XLSCellArray[b][c].rowSpan=a[b][c].rowSpan;if(a[b][c].colSpan)this.XLSCellArray[b][c].colSpan=a[b][c].colSpan;if(a[b][c].tag)this.XLSCellArray[b][c].tag=a[b][c].tag;a[b][c].name&&this.nameCell(b,c,a[b][c].name);if(a[b][c].isVisible!=void 0)this.XLSCellArray[b][c].isVisible=a[b][c].isVisible;if(a[b][c].options)if(a[b][c].type=="dropdown"){for(var d=0;d<a[b][c].options.length;d++)if(!a[b][c].options[d].displayLabel)a[b][c].options[d].displayLabel=
a[b][c].options[d].label;this.XLSCellArray[b][c].valueOptions={possibleValues:a[b][c].options,value:a[b][c].options[0].value,index:0,subIndex:-1}}else a[b][c].type=="currencyPair"?this.XLSCellArray[b][c].valueOptions=a[b][c].options:a[b][c].type=="toggle"?this.XLSCellArray[b][c].valueOptions=a[b][c].options:a[b][c].type=="notional"?this.XLSCellArray[b][c].valueOptions=a[b][c].options:a[b][c].type=="delta"?(this.XLSCellArray[b][c].valueOptions=a[b][c].options,this.XLSCellArray[b][c].readOnly=!0):this.XLSCellArray[b][c].valueOptions=
a[b][c].options;if(a[b][c].formatType)this.XLSCellArray[b][c].displayType=a[b][c].formatType.copy();if(a[b][c].value)this.XLSCellArray[b][c].valueOptions.value=a[b][c].value,this.XLSCellArray[b][c].updateCellByWidget();this.XLSCellArray[b][c].cellType=="input"?this.XLSCellArray[b][c].updateCellByString(a[b][c].value):this.XLSCellArray[b][c].updateCellByWidget()}}for(c=1;c<=this.XLSColCount;c++)if(!(a[1]==void 0||a[1][c]==void 0)&&a[1][c].width)this.XLSColArray[c].width=a[1][c].width;this.refreshSpan();
this.refreshHeaders();this.refreshGridCells();this.updateScreenFromXLS()}};clsDionGrid.prototype.insertRows=function(a,b){b<0||a<1||a>this.XLSRowCount||(b==1?this.insertRow(a):this.insertMultipleRow(a,b))};clsDionGrid.prototype.insertCols=function(a,b){b<0||a<1||a>this.XLSColCount||(b==1?this.insertCol(a):this.insertMultipleCol(a,b))};clsDionGrid.prototype.deleteRows=function(a,b){b<0||(b==1?this.deleteRow(a):this.deleteMultipleRow(a,b))};clsDionGrid.prototype.deleteCols=function(a,b){b<0||(b==1?
this.deleteCol(a):this.deleteMultipleCol(a,b))};clsDionGrid.prototype.makeEditable=function(a){if(typeof a=="string")if(isRange(a)){var a=a.split(":"),b=getCellRowCol(a[0].toUpperCase()),c=getCellRowCol(a[1].toUpperCase()),a=getColNoFromLabel(b[0]),d=getColNoFromLabel(c[0]),b=parseInt(b[1]),c=parseInt(c[1]);this.setReadonly(""+b+":"+a+":"+c+":"+d,!1)}else isNumRange(a)?this.setReadonly(a,!1):isCell(a)&&(d=getCellRowCol(a.toUpperCase()),a=getColNoFromLabel(d[0]),d=parseInt(d[1]),this.setReadonly(""+
a+":"+d+":"+a+":"+d,!1))};clsDionGrid.prototype.makeNonEditable=function(a){if(typeof a=="string")if(isRange(a)){var a=a.split(":"),b=getCellRowCol(a[0].toUpperCase()),c=getCellRowCol(a[1].toUpperCase()),a=getColNoFromLabel(b[0]),d=getColNoFromLabel(c[0]),b=parseInt(b[1]),c=parseInt(c[1]);this.setReadonly(""+b+":"+a+":"+c+":"+d,!0)}else isNumRange(a)?this.setReadonly(a,!0):isCell(a)&&(d=getCellRowCol(a.toUpperCase()),a=getColNoFromLabel(d[0]),d=parseInt(d[1]),this.setReadonly(""+a+":"+d+":"+a+":"+
d,!0))};clsDionGrid.prototype.setReadonly=function(a,b){var c=a.split(":");if(c.length!=4)return!1;var d=parseInt(c[0]),e=parseInt(c[1]),f=parseInt(c[2]),c=parseInt(c[3]);if(d>f)var g=f,f=d,d=g;e>c&&(g=c,c=e,e=g);for(;d<=f;d++)for(g=e;g<=c;g++)this.XLSCellArray[d][g].readOnly=b,this.XLSCellArray[d][g].className=b==!0?d%2?this.defaultEvenNonEditableCellStyle:this.defaultOddNonEditableCellStyle:d%2?this.defaultEvenEditableCellStyle:this.defaultOddEditableCellStyle;this.updateScreenFromXLS()};clsDionGrid.prototype.setColumnWidth=
function(a,b){this.XLSColArray[a].width=b;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.setRowHeight=function(a,b){this.XLSRowArray[a].height=b;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.setAllRowheight=function(a){for(var b=0;b<this.XLSRowCount;b++)this.XLSRowArray[b].height=a;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.setAllColWidth=function(a){for(var b=0;b<this.XLSColCount;b++)this.XLSColArray[b].width=a;this.refreshGridCells();
this.refreshHeaders()};clsDionGrid.prototype.setRowGap=function(a,b){this.XLSRowArray[a].gap=b;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.setColGap=function(a,b){this.XLSColArray[a].gap=b;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.setAllRowGap=function(a){for(var b=1;b<=this.XLSRowCount;b++)this.XLSRowArray[b].gap=a;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.setAllColGap=function(a){for(var b=1;b<=this.XLSColCount;b++)this.XLSColArray[b].gap=
a;this.refreshGridCells();this.refreshHeaders()};clsDionGrid.prototype.insertWidget=function(a,b,c,d){var e=this.displayCellArray[b][c],e=removeAllChildren(e),f=FinsheetEditors.getEditor(a);if(f&&(f=new f({container:e,rowNo:b,colNo:c,grid:this,item:d}),e.cellType=a,e.editor=f,this.isInXLSRange(b,c)&&d!=void 0))this.XLSCellArray[b][c].valueOptions=d.valueOptions};clsDionGrid.prototype.insertFormatter=function(a,b,c,d){var e=this.displayCellArray[b][c],e=removeAllChildren(e),f=FinsheetEditors.getFormatter(a);
if(f&&(new f({container:e,rowNo:b,colNo:c,grid:this,item:d}),e.cellType=a,e.editor=null,this.isInXLSRange(b,c)&&d))this.XLSCellArray[b][c].valueOptions=d.valueOptions};clsDionGrid.prototype.nameCell=function(a,b,c){this.isInXLSRange(a,b)&&(a=getColLabelFromNumber(b)+a,workbook.nameRange(c,this.gridName,a))};clsDionGrid.prototype.nameRange=function(a,b){if(isCell(a)||isRange(a))workbook.nameRange(b,this.gridName,a);else if(isNumRange(a)){var c=getRange(a);workbook.nameRange(b,this.gridName,c)}};clsDionGrid.prototype.copyRow=
function(a){this.isInXLSRange(a,1)&&this.copyRange(""+a+":1:"+a+":"+this.lColNo)};clsDionGrid.prototype.copyCol=function(a){this.isInXLSRange(1,a)&&this.copyRange("1:"+a+":"+this.lRowNo+":"+a)};clsDionGrid.prototype.copyCell=function(a,b){this.isInXLSRange(a,b)&&this.copyRange(a+":"+b+":"+a+":"+b)};clsDionGrid.prototype.copySelectedCells=function(){this.copyRange(this.selectedRange)};clsDionGrid.prototype.paste=function(a,b){this.isInXLSRange(a,b)&&this.pasteSpecialCopiedCells(a,b)};clsDionGrid.prototype.setClassName=
function(a,b){var c=getNumRange(a);if(c!=null){var d=this;this.mapFnToRange(c,function(a,c){d.XLSCellArray[a][c].className=b})}};clsDionGrid.prototype.setCellClassName=function(a,b,c){this.XLSCellArray[a][b].className=c};clsDionGrid.prototype.addCellClassName=function(a,b,c){if(this.isInXLSRange(a,b)){var d=this.XLSCellArray[a][b];if(c&&this.XLSCellArray[a][b].isVisible==!0)d.className=addClassName(d.className," "+c);this.refreshCell(a,b)}};clsDionGrid.prototype.changeDisplayFormat=function(a,b){if(isCell(a)){var c=
getCellRowCol(a.toUpperCase()),d=parseInt(c[1]),c=getColNoFromLabel(c[0]);if(this.isInXLSRange(d,c)){var e=this.XLSCellArray[d][c];b?(e.displayType=b.copy(),e.displayValue=convertTo(e.value,e.type,e.displayType)):(e.displayType=null,e.displayValue=e.value);e.cellType=="input"&&this.refreshCell(d,c)}}else if(isRange(a))for(var f=a.split(":"),e=getCellRowCol(f[0].toUpperCase()),f=getCellRowCol(f[1].toUpperCase()),d=getColNoFromLabel(e[0]),c=getColNoFromLabel(f[0]),e=parseInt(e[1]),f=parseInt(f[1]),
g=e;g<=f;g++)for(var h=d;h<=c;h++){e=this.XLSCellArray[g][h];b?(e.displayType=b.copy(),e.displayValue=convertTo(e.value,e.type,e.displayType)):(e.displayType=null,e.displayValue=e.value);if(e.cellType!="input")return;this.refreshCell(g,h)}else if(isNumRange(a)){f=a.split(":");d=parseInt(f[1]);c=parseInt(f[3]);e=parseInt(f[0]);f=parseInt(f[2]);for(g=e;g<=f;g++)for(h=d;h<=c;h++)e=this.XLSCellArray[g][h],b?(e.displayType=b.copy(),e.displayValue=convertTo(e.value,e.type,e.displayType)):(e.displayType=
null,e.displayValue=e.value),e.cellType=="input"&&this.refreshCell(g,h)}};clsDionGrid.prototype.leftAlign=function(a){a=getNumRange(a);a!=null&&this.alignRangeFn(a,"left")};clsDionGrid.prototype.rightAlign=function(a){a=getNumRange(a);a!=null&&this.alignRangeFn(a,"right")};clsDionGrid.prototype.centerAlign=function(a){a=getNumRange(a);a!=null&&this.alignRangeFn(a,"center")};clsDionGrid.prototype.bold=function(a){a=getNumRange(a);if(a!=null){var b=this;this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=
addClassName(b.XLSCellArray[a][d].className,"boldFontCellClass ")})}};clsDionGrid.prototype.italics=function(a){var a=getNumRange(a),b=this;a!=null&&this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=addClassName(b.XLSCellArray[a][d].className,"italicStyleCellClass ")})};clsDionGrid.prototype.underline=function(a){var a=getNumRange(a),b=this;a!=null&&this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=addClassName(b.XLSCellArray[a][d].className,"underlineDecorationCellClass ")})};
clsDionGrid.prototype.removeBold=function(a){var a=getNumRange(a),b=this;a!=null&&this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=removeClassName(b.XLSCellArray[a][d].className,"boldFontCellClass ")})};clsDionGrid.prototype.removeItalics=function(a){var a=getNumRange(a),b=this;a!=null&&this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=removeClassName(b.XLSCellArray[a][d].className,"italicStyleCellClass ")})};clsDionGrid.prototype.removeUnderline=function(a){var a=getNumRange(a),
b=this;a!=null&&this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=removeClassName(b.XLSCellArray[a][d].className,"underlineDecorationCellClass ")})};clsDionGrid.prototype.border=function(a,b){var c=getNumRange(a);c!=null&&this.borderMapper(c,b)};clsDionGrid.prototype.setRowSpan=function(a,b,c){if(this.isInXLSRange(a,b))this.XLSCellArray[a][b].rowSpan=c;this.refreshSpan();this.refreshGridCells()};clsDionGrid.prototype.setColSpan=function(a,b,c){if(this.isInXLSRange(a,b))this.XLSCellArray[a][b].colSpan=
c;this.refreshSpan();this.refreshGridCells()};clsDionGrid.prototype.setRowDeletable=function(a,b){if(this.isInXLSRange(a,1))this.XLSRowArray[a].isDeletable=b};clsDionGrid.prototype.setColDeletable=function(a,b){if(this.isInXLSRange(1,col))this.XLSColArray[col].isDeletable=b}}defineGridAPI();function defineDionDisplayFunctions(){clsDionGrid.prototype.saveOneScreenCellInMemory=function(a,b){if(this.isCurrentCell(a,b)){var c=this.displayCellArray[a][b];if(c.editor&&c.editor.isValueChanged()){var d=this.XLSCellArray[a][b];if(c.cellType=="input"){var e=c.editor;e.applyValue(d);e=d.className;d.errorMesg!=""?(e=addClassName(d.className," "+this.defaultErrorStyle),showErrorNotification(d.errorMesg)):e=removeClassName(d.className,this.defaultErrorStyle);this.mode="none";this.onCellChanged.raiseCallBacks(null,
{row:a,cell:b});c.className=e}else if(c.cellType!="input")e=c.editor,e.getValue(),e.applyValue(d),d.errorMesg!=""?(e=addClassName(d.className," "+this.defaultErrorStyle),showErrorNotification(d.errorMesg)):e=removeClassName(d.className,this.defaultErrorStyle),this.mode="none",c.className=e,this.onCellChanged.raiseCallBacks(null,{row:a,cell:b})}this.dragItem=""}};clsDionGrid.prototype.refreshCell=function(a,b){var c=this.XLSCellArray[a][b];if(this.isCurrentCell(a,b)&&FinsheetEditors.hasFormatter(c.cellType)){var d=
this.displayCellArray[a][b].editor;d?d.loadValue(c):this.insertFormatter(c.cellType,a,b,c);this.displayCellArray[a][b].className=c.className;if(this.showFormulaBar)this.formulaBarInput.value=c.stringValue}else if(FinsheetEditors.hasFormatter(c.cellType))this.insertFormatter(c.cellType,a,b,c),this.displayCellArray[a][b].className=c.className;else if((d=this.displayCellArray[a][b].editor)?d.loadValue(c):this.insertWidget(c.cellType,a,b,c),this.displayCellArray[a][b].className=c.className,this.showFormulaBar)this.formulaBarInput.value=
c.stringValue;this.refreshCellCSS(a,b)};clsDionGrid.prototype.refreshCellCSS=function(a,b){if(this.isInXLSRange(a,b)){var c=this.XLSCellArray[a][b],d=c.className;c.errorMesg!=""?(d=addClassName(c.className," "+this.defaultErrorStyle),showErrorNotification(c.errorMesg)):d=removeClassName(c.className,this.defaultErrorStyle);this.displayCellArray[a][b].className=d;this.displayCellArray[a][b].style.visibility=c.isVisible==!0?"visible":"hidden"}};clsDionGrid.prototype.updateScreenFromXLS=function(){for(var a,
b,c=1;c<=this.XLSRowCount&&c<=this.XLSRowCount;c++)for(var d=1;d<=this.XLSColCount&&d<=this.XLSColCount;d++)b=this.XLSCellArray[c]&&this.XLSCellArray[c][d]?this.XLSCellArray[c][d]:{cellType:"input",value:"",displayValue:"",stringValue:""},a=this.displayCellArray[c][d],!this.isCurrentCell(c,d)&&FinsheetEditors.hasFormatter(b.cellType)||b.readOnly?this.insertFormatter(b.cellType,c,d,b):this.insertWidget(b.cellType,c,d,b),a.className=this.XLSCellArray[c]&&this.XLSCellArray[c][d]?this.XLSCellArray[c][d].errorMesg!=
""?b.className+" "+this.defaultErrorStyle:b.className:(c%2?this.defaultEvenEditableCellStyle:this.defaultOddEditableCellStyle)+" "+this.defaultTextAlign+"AlignCellClass ";this.applyRange()};clsDionGrid.prototype.applyRange=function(){for(var a,b=1;b<=this.XLSRowCount;b++)for(var c=1;c<=this.XLSColCount&&c<=this.XLSColCount;c++)if(a=this.displayCellArray[b][c],!isInRange(b,c,this.selectedRange)&&this.XLSCellArray[b]&&this.XLSCellArray[b][c])a.style.background=this.XLSCellArray[b][c].backgroundColor;
if(this.showInterpolationDiv)b=this.selectedRange,a=getEndX(b),b=getEndY(b),a>0&&a<=this.XLSRowCount&&b>0&&b<=this.XLSColCount?(this.interpolationDiv.style.top=getLengthFromString(this.displayCellArray[a][b].style.top)+getLengthFromString(this.displayCellArray[a][b].style.height)-4+"px",this.interpolationDiv.style.left=getLengthFromString(this.displayCellArray[a][b].style.left)+getLengthFromString(this.displayCellArray[a][b].style.width)-4+"px",this.interpolationDiv.style.display="block"):this.interpolationDiv.style.display=
"none"};clsDionGrid.prototype.refreshGridCells=function(){var a=0,b=0,c,d,e;this.removeGridDiv();for(var f=1;f<=this.XLSRowCount;f++){c=this.XLSRowArray[f]?this.XLSRowArray[f]:{height:this.defaultCellHeight,gap:0};for(var g=1;g<=this.XLSColCount;g++){d=this.XLSColArray[g]?this.XLSColArray[g]:{width:this.defaultCellWidth,gap:0};e=this.displayCellArray[f][g];e=e.style;var h=f,i=g;if(h<=this.XLSRowCount&&i<=this.XLSColCount){var j=1,k=1,m=!0,m=this.XLSCellArray[h][i],j=m.rowSpan,k=m.colSpan,m=m.isVisible;
e.top=b+"px";e.left=a+"px";e.width=Math.max(this.getTotalWidth(i,i+k-1)-1,0)+"px";e.height=Math.max(this.getTotalHeight(h,h+j-1)-1,0)+"px";e.visibility=m==!0?"visible":"hidden";a=a+d.width+d.gap}else e.visibility="hidden"}f<=this.XLSRowCount&&(b=b+c.height+c.gap);a=0}if(this.showInterpolationDiv)b=this.selectedRange,a=getEndX(b),b=getEndY(b),a>0&&a<this.XLSRowCount&&b>0&&b<this.XLSColCount?(this.interpolationDiv.style.top=getLengthFromString(this.displayCellArray[a][b].style.top)+getLengthFromString(this.displayCellArray[a][b].style.height)-
4+"px",this.interpolationDiv.style.left=getLengthFromString(this.displayCellArray[a][b].style.left)+getLengthFromString(this.displayCellArray[a][b].style.width)-4+"px",this.interpolationDiv.style.display="block"):this.interpolationDiv.style.display="none";this.attachGridDiv()};clsDionGrid.prototype.refreshSpan=function(){for(var a=1;a<=this.XLSRowCount;a++)for(var b=1;b<=this.XLSColCount;b++){var c=a,d=b,e=1,f=1,f=this.XLSCellArray[c][d],e=f.rowSpan,f=f.colSpan;if(e>1||f>1)for(var g=c;g<c+e;g++)for(var h=
d;h<d+f;h++)if(!(g==c&&h==d))this.XLSCellArray[g][h].isVisible=!1,this.XLSCellArray[g][h].spannedBy={row:c,col:d};if(this.XLSCellArray[c][d].spannedBy.row!=0&&this.XLSCellArray[c][d].spannedBy.col!=0){e=this.XLSCellArray[c][d].spannedBy.row;f=this.XLSCellArray[c][d].spannedBy.col;g=this.XLSCellArray[e][f];if(g.rowSpan<c-e+1)this.XLSCellArray[c][d].spannedByCell={row:0,col:0},this.XLSCellArray[c][d].isVisible=!0;if(g.colSpan<d-f+1)this.XLSCellArray[c][d].spannedByCell={row:0,col:0},this.XLSCellArray[c][d].isVisible=
!0}}};clsDionGrid.prototype.refreshHeaders=function(){this.gridDiv.style.left=this.left+0+"px";this.gridDiv.style.top=this.top+0+0+"px";gridWidth=this.getTotalWidth(1,this.XLSColCount);gridHeight=this.getTotalHeight(1,this.XLSRowCount);this.gridDiv.style.width=gridWidth+1+"px";this.gridDiv.style.height=gridHeight+1+"px"};clsDionGrid.prototype.makeVisibleOnScreen=function(){};clsDionGrid.prototype.goToCell=function(a,b){if(!(a>this.XLSRowCount||b>this.XLSColCount||a<1||b<1)){var c=workbook.isCurGrid(this);
if(this.curXLSRowNo==a&&this.curXLSColNo==b&&c&&this.displayCellArray[a][b].editor)this.displayCellArray[a][b].editor.blur(),this.mode="select";else{workbook.curDionGrid=this;var c=this.displayCellArray[this.curXLSRowNo][this.curXLSColNo],d=this.XLSCellArray[this.curXLSRowNo][this.curXLSColNo].cellType;if(c.editor)FinsheetEditors.hasFormatter(d)?(c.editor&&c.editor.blur&&c.editor.blur(),c.editor.destroy(),c.editor=null):(c.editor&&c.editor.blur&&c.editor.blur(),c.editor.destroy());c={cellType:"input",
value:"",displayValue:"",stringValue:""};c=this.XLSCellArray[this.curXLSRowNo][this.curXLSColNo];FinsheetEditors.hasFormatter(c.cellType)&&this.insertFormatter(c.cellType,this.curXLSRowNo,this.curXLSColNo,c);this.mode="select";!this.XLSCellArray[a]||!this.XLSCellArray[a][b]||!this.XLSCellArray[a][b].readOnly?(this.curXLSRowNo=a,this.curXLSColNo=b,workbook.curXLSRowNo=a,workbook.curXLSColNo=b,this.selectedRange=a+":"+b+":"+a+":"+b):this.selectedRange=this.curXLSRowNo+":"+this.curXLSColNo+":"+this.curXLSRowNo+
":"+this.curXLSColNo;if(this.isInXLSRange(this.curXLSRowNo,this.curXLSColNo)&&(c=this.XLSCellArray[this.curXLSRowNo]&&this.XLSCellArray[this.curXLSRowNo][this.curXLSColNo]?this.XLSCellArray[this.curXLSRowNo][this.curXLSColNo]:{cellType:"input",value:"",displayValue:"",stringValue:""},c.errorMesg?showErrorNotification(c.errorMesg):showErrorNotification(""),FinsheetEditors.hasFormatter(c.cellType)&&this.insertWidget(c.cellType,this.curXLSRowNo,this.curXLSColNo,c),this.mode="select",c=this.displayCellArray[this.curXLSRowNo][this.curXLSColNo],
c.editor))c.focus(),c.editor.autofocus()==!1?this.mode="select":c.editor.focus();this.applyRange()}}};clsDionGrid.prototype.getTotalWidth=function(a,b){if(a<=0)a=1;else if(a>this.XLSColCount)a=this.XLSColCount;if(b<=0)b=1;else if(b>this.XLSColCount)b=this.XLSColCount;b<a&&(b=a);for(var c=0,d=a;d<=b;d++)c+=d!=b?this.XLSColArray[d]?this.XLSColArray[d].width+this.XLSColArray[d].gap:this.defaultCellWidth:this.XLSColArray[d]?this.XLSColArray[d].width:this.defaultCellWidth;return c};clsDionGrid.prototype.getTotalHeight=
function(a,b){if(a<=0)a=1;else if(a>this.XLSRowCount)a=this.XLSRowCount;if(b<=0)b=1;else if(b>this.XLSRowCount)b=this.XLSRowCount;b<a&&(b=a);for(var c=0,d=a;d<=b;d++)c+=d!=b?this.XLSRowArray[d]?this.XLSRowArray[d].height+this.XLSRowArray[d].gap:this.defaultCellHeight:this.XLSRowArray[d]?this.XLSRowArray[d].height:this.defaultCellHeight;return c};clsDionGrid.prototype.getLastRow=function(){return this.XLSRowCount};clsDionGrid.prototype.getLastCol=function(){return this.XLSColCount};clsDionGrid.prototype.hideContextMenu=
function(){if(workbook.contextMenuDiv!=null)workbook.contextMenuDiv.hideSubMenu(),document.body.removeChild(document.getElementById(workbook.contextMenuDiv.contextMenuId)),workbook.contextMenuDiv=null,document.onclick=null};clsDionGrid.prototype.setNext=function(a,b){if(isCell(a)&&isCell(b)){var c=getCellRowCol(a),d=parseInt(c[1]),c=getColNoFromLabel(c[0]),e=getCellRowCol(b),f=parseInt(e[1]),e=getColNoFromLabel(e[0]);if(this.isInXLSRange(d,c)&&this.isInXLSRange(f,e))f=this.XLSCellArray[f][e],this.XLSCellArray[d][c].nextCell=
b,f.previousCell=a}};clsDionGrid.prototype.multipleSetNext=function(a){if(a.length>0)for(var b=0;b+1<a.length;b+=2)this.setNext(a[b],a[b+1])};clsDionGrid.prototype.rightEditableCell=function(){for(var a=this.curXLSRowNo,b=this.curXLSColNo,c=a;c<=this.XLSRowCount;c++)for(var d=b+1;d<=this.XLSColCount;d++)if(this.XLSCellArray[c][d].readOnly==!1&&this.XLSCellArray[c][d].isVisible==!0)return{rowNo:c,colNo:d};return{rowNo:a,colNo:b}};clsDionGrid.prototype.leftEditableCell=function(){for(var a=this.curXLSRowNo,
b=this.curXLSColNo,c=a;c>0;c--)for(var d=b-1;d>0;d--)if(this.XLSCellArray[c][d].readOnly==!1&&this.XLSCellArray[c][d].isVisible==!0)return{rowNo:c,colNo:d};return{rowNo:a,colNo:b}};clsDionGrid.prototype.upEditableCell=function(){for(var a=this.curXLSRowNo,b=this.curXLSColNo,c=b;c>0;c--)for(var d=a-1;d>0;d--)if(this.XLSCellArray[d][c].readOnly==!1&&this.XLSCellArray[d][c].isVisible==!0)return{rowNo:d,colNo:c};return{rowNo:a,colNo:b}};clsDionGrid.prototype.downEditableCell=function(){for(var a=this.curXLSRowNo,
b=this.curXLSColNo,c=b;c<=this.XLSColCount;c++)for(var d=a+1;d<=this.XLSRowCount;d++)if(this.XLSCellArray[d][c].readOnly==!1&&this.XLSCellArray[d][c].isVisible==!0)return{rowNo:d,colNo:c};return{rowNo:a,colNo:b}};clsDionGrid.prototype.nextEditableCell=function(){var a=this.curXLSRowNo,b=this.curXLSColNo;if(a<=this.XLSRowCount)for(var c=b+1;c<=this.XLSColCount;c++)if(this.XLSCellArray[a][c].readOnly==!1&&this.XLSCellArray[a][c].isVisible==!0)return{rowNo:a,colNo:c};for(var d=a+1;d<=this.XLSRowCount;d++)for(c=
1;c<=this.XLSColCount;c++)if(this.XLSCellArray[d][c].readOnly==!1)return{rowNo:d,colNo:c};return{rowNo:a,colNo:b}};clsDionGrid.prototype.previousEditableCell=function(){for(var a=this.curXLSRowNo,b=this.curXLSColNo,c=b-1;c>0;c--)if(this.XLSCellArray[a][c].readOnly==!1&&this.XLSCellArray[a][c].isVisible==!0)return{rowNo:a,colNo:c};for(var d=a-1;d>0;d--)for(c=this.XLSColCount;c>0;c--)if(this.XLSCellArray[d][c].readOnly==!1&&this.XLSCellArray[d][c].isVisible==!0)return{rowNo:d,colNo:c};return{rowNo:a,
colNo:b}}}defineDionDisplayFunctions();function defineClsXLSGrid(){clsMemoryRow=function(a){this.height=a;this.gap=this.rowNo=0;this.isDeletable=!0};clsMemoryCol=function(a){this.width=a;this.gap=this.colNo=0;this.isDeletable=!0};clsMemoryCell=function(){this.stringValue=this.value="";this.type="null";this.align="left";this.className=this.textColor=this.backgroundColor="";this.isModified=this.isDirty=!1;this.cellType="input";this.displayType=null;this.previousCell=this.nextCell=this.displayValue="";this.readOnly=!1;this.valueOptions={value:""};
this.id=this.tag="";this.colSpan=this.rowSpan=1;this.isVisible=!0;this.spannedBy={row:0,col:0};this.grandParentDionGrid=this.parentXLSArray=this.parentCol=this.parentRow=null;this.formStr="";this.outputQueue=[];this.operatorStack=[];this.calcStack=[];this.dependLinkArray=[];this.formulaParents=[];this.formulaCalcId="";this.isCircular=!1;this.errorMesg=""};clsMemoryCell.prototype.updateCellByString=function(a){var b;this.formulaParents=[];b=getNumberType(a);if(b!=this.type)this.type=b;if(b=="formula")this.stringValue=
""+a,bracketMatch(a)==0?this.evalFormula():(this.errorMesg+="\nBracket Mismatch",this.value="#BRACKET");else if(b=="integer")a=removePreceedingZeros(a),this.value=parseInt(a),this.stringValue=""+this.value;else if(b=="float")a=removePreceedingZeros(a),this.value=parseFloat(a),this.stringValue=""+this.value;else if(b=="text")this.stringValue=this.value=a;else if(b=="boolean")this.value=a.toUpperCase()=="TRUE"?!0:!1,this.stringValue=a;else if(b=="null")this.stringValue=this.value="";a=createRandomString();
this.type=="formula"?(this.formulaCalcId="",this.calculateRPN(a)):this.updateParentValue(a);this.displayValue=convertTo(this.value,this.type,this.displayType);this.valueOptions.value=this.value;this.valueOptions.displayValue=this.displayValue;this.valueOptions.stringValue=this.stringValue};clsMemoryCell.prototype.updateParentValue=function(a){for(mNo=0;mNo<this.dependLinkArray.length;mNo++){mParent=workbook.getCellByString(this.dependLinkArray[mNo]);var b=mParent.parentRow.rowNo,c=mParent.parentCol.colNo;
mParent.calculateRPN(a);mParent.grandParentDionGrid.refreshCell(b,c)}};clsMemoryCell.prototype.updateCellByWidget=function(){var a=this.valueOptions;this.type="text";a=a.value;this.stringValue=""+a;this.value=a;this.updateParentValue(createRandomString());this.displayValue=convertTo(a,this.type,this.displayType);if(!this.valueOptions.displayValue)this.valueOptions.displayValue=convertTo(a,this.type,this.displayType);if(this.cellType=="combo")for(var b=this.valueOptions.possibleValues,c=0;c<b.length;c++){if(b[c].value==
a)this.valueOptions.index=c,this.valueOptions.subIndex=-1;if(b[c].subMenu)for(var d=0;d<b[c].subMenu.length;d++)if(b[c].subMenu[d].value==a)this.valueOptions.index=c,this.valueOptions.subIndex=d}};clsMemoryCell.prototype.copyCell=function(){var a=new clsMemoryCell;a.value=this.value;a.stringValue=this.stringValue;a.type=this.type;a.align=this.align;a.backgroundColor=this.backgroundColor;a.textColor=this.textColor;a.className=this.className;a.isDirty=this.isDirty;a.isModified=this.isModified;a.cellType=
this.cellType;a.possibleValues=this.possibleValues;a.selectedIndex=this.selectedIndex;a.cellType=this.cellType;a.displayType=this.displayType;a.displayValue=this.displayValue;a.valueOptions=this.valueOptions;a.parentXLSArray=this.parentXLSArray;a.formStr=this.formStr;a.outputQueue=this.outputQueue;a.operatorStack=this.operatorStack;a.calcStack=this.calcStack;a.dependLinkArray=this.dependLinkArray;a.parentRow=this.parentRow;a.parentCol=this.parentCol;a.grandParentDionGrid=this.grandParentDionGrid;
a.formulaCalcId=this.formulaCalcId;a.isCircular=this.isCircular;return a};clsMemoryCell.prototype.evalFormula=function(){for(var a=this.stringValue.substr(1,this.stringValue.length-1),b="",c="";this.outputQueue.length>0;)this.outputQueue.pop();for(;this.operatorStack.length>0;)this.operatorStack.pop();for(var d=0;d<a.length;d++)c=a.substr(d,1),c!=" "&&(isOperator(c)?(this.handleToken(b),b="",this.pushOperatorOnStack(c)):b+=c);this.handleToken(b);this.finalTransfer()};clsMemoryCell.prototype.pushOperatorOnStack=
function(a){var b;if(a=="(")this.outputQueue.push(a),this.operatorStack.push(a);else if(a==")")this.handleCloseBracket();else if(a==",")this.handleComma();else if(operatorAssociativity(a)=="L")for(;;)if(this.operatorStack.length==0){this.operatorStack.push(a);break}else if(this.operatorStack[this.operatorStack.length-1]==")"){this.operatorStack.push(a);break}else if(operatorPrecedence(a)>operatorPrecedence(this.operatorStack[this.operatorStack.length-1])){this.operatorStack.push(a);break}else b=this.operatorStack.pop(),
this.outputQueue.push(b);else for(;;)if(this.operatorStack.length==0){this.operatorStack.push(a);break}else if(this.operatorStack[this.operatorStack.length-1]==")"){this.operatorStack.push(a);break}else if(operatorPrecedence(a)>=operatorPrecedence(this.operatorStack[this.operatorStack.length-1])){this.operatorStack.push(a);break}else b=this.operatorStack.pop(),this.outputQueue.push(b)};clsMemoryCell.prototype.handleToken=function(a){if(!(a==""||a==" "))if(isFunction(a))this.operatorStack.push(a);
else if(getNumberType(a)=="integer")this.outputQueue.push(parseInt(a));else if(getNumberType(a)=="float")this.outputQueue.push(parseFloat(a));else if(getNumberType(a)=="boolean")this.outputQueue.push(toBoolean(a));else if(workbook.getCellById(a,this.grandParentDionGrid)!=null){var b=workbook.getCellById(a,this.grandParentDionGrid);this.formulaParents[this.formulaParents.length]=a;if(!b)this.value="#CELL",this.errorMesg+="\nCell Not Found"+a;this.outputQueue.push(a);if(a.toUpperCase==this.getCellRefAsString())this.isCircular=
!0,this.errorMesg+="\nCircular Reference",this.value=this.displayValue="#CIRC";this.updateParentDependLink(b.parentXLSArray[b.parentRow.rowNo][b.parentCol.colNo])}else a.substr(0,1)=='"'&&a.substr(a.length-1,1)=='"'?this.outputQueue.push(a):a.substr(0,1)=="'"&&a.substr(a.length-1,1)=="'"?this.outputQueue.push(a):workbook.nameMap.get(a)!=null?(a=workbook.nameMap.get(a).split(".")[1],this.handleToken(a)):(this.errorMesg+="\n"+a+" Not Found",this.value=this.displayValue="#NAME")};clsMemoryCell.prototype.handleCloseBracket=
function(){for(var a,b=!0,c=[];this.outputQueue.length>0;)if(a=this.outputQueue.pop(),a=="(")break;else c.push(a);for(c=c.reverse();this.operatorStack.length>0;)if(a=this.operatorStack.pop(),a=="("){this.operatorStack.length>0&&isFunction(this.operatorStack[this.operatorStack.length-1])&&(a=this.operatorStack.pop(),c.push(a));c.length>0?this.outputQueue.push(c):(this.errorMesg="Empty Bracket Found",this.value=this.displayValue="#EMPTY BRACKET");b=!1;break}else c.push(a);if(b)this.errorMesg+="\nBracket Mismatch found",
this.value=this.displayValue="#BRACKET"};clsMemoryCell.prototype.handleComma=function(){for(var a;this.operatorStack.length>0;){if(this.operatorStack[this.operatorStack.length-1]=="(")break;a=this.operatorStack.pop();this.outputQueue.push(a)}};clsMemoryCell.prototype.updateParentDependLink=function(a){var b=0;if(a!=void 0){for(var a=a.dependLinkArray,c=this.grandParentDionGrid.gridName+"."+this.getCellRefAsString();b<a.length;)a[b]==c?a.splice(b,1):b++;a.push(c)}};clsMemoryCell.prototype.finalTransfer=
function(){for(var a;this.operatorStack.length>0;)a=this.operatorStack.pop(),this.outputQueue.push(a)};clsMemoryCell.prototype.calculateRPN=function(a){if(!this.isCircular){if(this.type=="formula"){for(;this.calcStack.length>0;)this.calcStack.pop();if(this.errorMesg=="")var b=this.solveFormula(this.calcStack,this.outputQueue);if(this.formulaCalcId==a)this.isCircular=!0,this.errorMesg+="\nCircular Reference",this.value=this.displayValue="#CIRC";else{if(this.formulaCalcId=="")this.formulaCalcId=a;this.isCircular=
!1}if(this.errorMesg=="")this.displayValue=this.value=b}for(var c,b=0;b<this.dependLinkArray.length;b++){c=workbook.getCellByString(this.dependLinkArray[b]);var d=c.parentRow.rowNo,e=c.parentCol.colNo;c.calculateRPN(a);c.grandParentDionGrid.refreshCell(d,e)}}};clsMemoryCell.prototype.popFromCalcStack=function(a){a=a.pop();if(workbook.getCellById(a,this.grandParentDionGrid)!=null)if(a=workbook.getCellById(a,this.grandParentDionGrid),a==void 0||a==null)this.value="#CELL",this.errorMesg="Cell Not Found";
else if(a.errorMesg!="")this.errorMesg=a.errorMesg,this.value="#VALUE";else return a=a.value,a==""?0:a;else return typeof a=="string"&&a.length>0?toBoolean(a)==!0?!0:toBoolean(a)==!1?!1:a:a==""?0:a};clsMemoryCell.prototype.getCellRefAsString=function(){var a=this.parentRow.rowNo;return""+getColLabelFromNumber(this.parentCol.colNo)+""+a};clsMemoryCell.prototype.clearAllBackLinks=function(){this.getCellRefAsString();var a,b,c;for(a=0;a<this.outputQueue.length;a++){c=this.outputQueue[a];if(isCell(c)){c=
this.grandParentDionGrid.gridName+"."+c;b=getCellRowCol(c.toUpperCase());b=this.parentXLSArray[parseInt(b[1])][getColNoFromLabel(b[0])];mCellObjArray=b.dependLinkArray;for(b=0;b<mCellObjArray.length;)c==mCellObjArray[b]?mCellObjArray.splice(b,1):b++}if(isGridCell(c)){mCellObjArray=workbook.getCellByString(c).dependLinkArray;for(b=0;b<mCellObjArray.length;)c==mCellObjArray[b]?mCellObjArray.splice(b,1):b++}}};clsMemoryCell.prototype.clearFormula=function(){this.formStr="";this.outputQueue=[];this.operatorStack=
[];this.calcStack=[];this.formulaCalcId="";this.isCircular=!1;this.errorMesg=""};clsMemoryCell.prototype.solveFormula=function(a,b){for(var c,d=0;d<b.length;d++)if(c=b[d],typeof c=="object")c.length&&a.push(this.solveFormula([],c));else if(isOperator(c)){var e,f,g=operatorArgCount(c),h=!1;if(g!=-1)if(g==1){if(e=this.popFromCalcStack(a),e==void 0||e==null)this.errorMesg+="Operator "+c+" Argument Not Found",this.value="#ARG",h=!0}else{if(g==2){e=this.popFromCalcStack(a);if(e==void 0||e==null)this.errorMesg+=
"Operator "+c+" Argument Not Found",this.value="#ARG",h=!0;f=this.popFromCalcStack(a);if(f==void 0||f==null)this.errorMesg+="Operator "+c+" Argument Not Found",this.value="#ARG",h=!0}}else this.errorMesg+="Operator "+c+" Argument Count Not Defined",this.value="#ARG",h=!0;if(!h)switch(c){case "+":c=f+e;a.push(c);break;case "-":c=f-e;a.push(c);break;case "*":c=f*e;a.push(c);break;case "/":c=f/e;a.push(c);break;case "^":c=Math.pow(f,e);a.push(c);break;case ">":(c=f>e)?a.push("true"):a.push("false");
break;case "<":(c=f<e)?a.push("true"):a.push("false");break;case "=":(c=f=e)?a.push("true"):a.push("false")}}else a.push(c);d=this.popFromCalcStack(a);e=a.pop();if(e!=void 0||e!=null)this.errorMesg+="\nExtra Arguments Found - ("+e+")",this.value="#ARGEXTRA";return this.errorMesg==""?d:this.value}}defineClsXLSGrid();var _startCellY=1,_startCellX=1,_endCellY=1,_endCellX=1,_isCellShiftDrag=!1,_isCut=!1;function getColLabelFromNumber(a){if(a<=26)return String.fromCharCode(a+64);var b=parseInt(a/26);a-=26*b;a==0&&(a=26,b--);return String.fromCharCode(b+64)+String.fromCharCode(a+64)}function getColNoFromLabel(a){for(var b=0,c=a.toUpperCase(),a=0;a<c.length;a++)b*=26,b=b+c.charCodeAt(a)-65;return b+1}
function getCellRowCol(a){var b,c,d=[];if(a.match(/^[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}$/)){a=a.replace(/[\$]/g,"");for(b=0;b<a.length;b++)if(c=a.charCodeAt(b),c>=48&&c<=57)break;d.push(a.substr(0,b));d.push(a.substr(b,a.length,b));return d}else return null}
function getNumberType(a){if(a==null)return"null";a=""+a;if(a=="")return"null";if((""+a).substr(0,1)=="=")return"formula";var b=/^[0-9]+$/,a=a.substr(0,1)=="+"||a.substr(0,1)=="-"?a.substr(1):a;if(a.toUpperCase()=="TRUE"||a.toUpperCase()=="FALSE")return"boolean";if(a.match(b))return"integer";else{var c=a.indexOf(".");if(c<0)return"text";var d=a.substr(0,c),c=a.substr(c+1);return a.substr(0,1)=="."&&c.match(b)?"float":!d.match(b)?"text":!c.match(b)?"text":"float"}}
function removePreceedingZeros(a){for(a+="";a.indexOf("0")===0&&a.length!=1;)a=a.substr(1);return a}function getLengthFromString(a){return a.length>2?parseInt(a.substr(0,a.length-2)):null}function removeAllChildren(a){if(a.hasChildNodes())for(;a.childNodes.length>=1;)a.removeChild(a.firstChild)}
function isInRange(a,b,c){var d=c.split(":");if(d.length!=4)return!1;else{var c=parseInt(d[0]),e=parseInt(d[1]),f=parseInt(d[2]),d=parseInt(d[3]);if(c>f)var g=f,f=c,c=g;e>d&&(g=d,d=e,e=g);return a>=c&&a<=f&&b>=e&&b<=d?!0:!1}}function isInsideRange(a,b,c){var d=c.split(":");if(d.length!=4)return!1;else{var c=parseInt(d[0]),e=parseInt(d[1]),f=parseInt(d[2]),d=parseInt(d[3]);if(c>f)var g=f,f=c,c=g;e>d&&(g=d,d=e,e=g);return a>c&&a<f&&b>e&&b<d?!0:!1}}
function isXInRange(a,b){var c=b.split(":");if(c.length!=4)return!1;else{var d=parseInt(c[0]),c=parseInt(c[2]);if(d>c)var e=c,c=d,d=e;return a>=d&&a<=c?!0:!1}}function isYInRange(a,b){var c=b.split(":");if(c.length!=4)return!1;else{var d=parseInt(c[1]),c=parseInt(c[3]);if(d>c)var e=c,c=d,d=e;return a>=d&&a<=c?!0:!1}}function removeClassName(a,b){for(var c=a;c.indexOf(b)!=-1;)c=c.replace(b,"");return c}function toggleClassName(a,b){return a.indexOf(b)!=-1?removeClassName(a,b):addClassName(a,b)}
function addClassName(a,b){a=removeClassName(a,b);a+=b;return a}function colCount(a){var b=a.split(":");if(b.length!=4)return"";else{a=parseInt(b[1]);b=parseInt(b[3]);if(a>b)var c=b,b=a,a=c;return b-a+1}}function rowCount(a){var b=a.split(":");if(b.length!=4)return"";else{a=parseInt(b[0]);b=parseInt(b[2]);if(a>b)var c=b,b=a,a=c;return b-a+1}}function getStartX(a){var b=a.split(":");return b.length!=4?"":(a=parseInt(b[0]),b=parseInt(b[2]),a>b&&(a=b),a)}
function getStartY(a){var b=a.split(":");return b.length!=4?"":(a=parseInt(b[1]),b=parseInt(b[3]),a>b&&(a=b),a)}function getEndX(a){var b=a.split(":");return b.length!=4?"":(a=parseInt(b[0]),b=parseInt(b[2]),a>b&&(b=a),b)}function getEndY(a){var b=a.split(":");return b.length!=4?"":(a=parseInt(b[1]),b=parseInt(b[3]),a>b&&(b=a),b)}function createRandomString(){var a="",a=a+=parseInt(Math.random()*89999)+1E4,a=a+=parseInt(Math.random()*89999)+1E4;return a=a+=parseInt(Math.random()*89999)+1E4}
function preventDefaultBehaviour(a){if(a)if(a.preventDefault)a.preventDefault();else return a.cancelBubble=!0,a.returnValue=!1}function preventPropagation(a){if(a)if(a.preventDefault)a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation();else return a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation(),!1}
function convertTo(a,b,c){if(!a&&a!=0&&a!="0")return"";a=a.toString();if(c==void 0||c==null)return typeof a=="string"?removeDoubleQuotes(a):a;if(c.format=="percent")return formatAsPercent(a,b,c);else if(c.format=="currency")return formatAsCurrency(a,b,c);else if(c.format=="accounting")return formatAsCurrency(a,b,c);else if(c.format=="delta")return removeDelta(a)+" &#9651";return removeDoubleQuotes(a)}function removeDelta(a){for(;a.indexOf(" &#9651")!=-1;)a=a.replace(" &#9651","");return a}
function removeDoubleQuotes(a){if(a.split('"').length%2==0)return a;if(a.split("'").length%2==0)return a;for(var a=a.split('"'),b="",c=0;c<a.length;c+=1)b+=removeSingleQuotes(a[c]);return b}function removeSingleQuotes(a){for(var a=a.split("'"),b="",c=0;c<a.length;c+=2)b+=a[c];return b}function convertToNum(a,b){a=""+a;if(b.symbol)for(;a.indexOf(b.symbol)!=-1;)a=a.replace(b.symbol,"");for(;a.indexOf(",")!=-1;)a=a.replace(",","");for(;a.indexOf(" ")!=-1;)a=a.replace(" ","");return a}
function formatAsCurrency(a,b,c){a&&(a=convertToNum(a,c));b=="formula"&&(b=getNumberType(""+a));if(b=="integer")a=adjustDecimal(""+a,c.decimalCount);else if(b=="float")b=Math.pow(10,c.decimalCount),a=""+Math.round(parseFloat(a)*b)/b,a=adjustDecimal(a,c.decimalCount);else return removeDoubleQuotes(a);var b=a.indexOf("."),d=a.substr(0,b),e=a.substr(b+1);b==-1&&(d=a,e="");var f=!1;d.indexOf("-")!=-1&&(d=d.substr(1),f=!0);var g=d.length;if(g==0)return c.symbol+"0";else if(g>11)return formatAsCurSymbol(a);
var h=g%3;if(c.useThousandSeparator){a=c.symbol+d.substr(0,h);for(c=h;c<g;c+=3)a+=c!=0?","+d.substr(c,3):d.substr(c,3);f&&(a="-"+a);return b!=-1?a+"."+e:a}else return c.symbol+a?c.symbol+a:""}function formatAsCurSymbol(a){var a=""+a,b=a.length;if(b<11)return a;a=parseInt(a)/getNotional(b);return adjustDecimal(""+a,2)+getSymbol(b)}function getNotional(a){if(a>9&&a<=12)return Math.pow(10,9);else if(a>12)return Math.pow(10,12)}function getSymbol(a){if(a>9&&a<=12)return"B";else if(a>12)return"T"}
function formatAsPercent(a,b,c){b=="formula"&&(b=getNumberType(""+a));var d="";if(b=="integer")a!="0"&&a!=""&&(d=a+"00");else if(b=="float")a!="0"&&a!=""&&(b=Math.pow(10,c.decimalCount),d=""+Math.round(parseFloat(a)*100*b)/b);else return removeDoubleQuotes(a);d=adjustDecimal(d,c.decimalCount);return d+"%"}
function adjustDecimal(a,b){if(a=="0"||a==""||!a)return"0";var c=a.indexOf(".");if(c<0)return b>0?a+"."+zeroString(b):a;var d=a.substr(0,c);if(b<=0)return d;var c=a.substr(c+1),e=c.length;return e<b?d+"."+c+zeroString(b-e):d+"."+c.substr(0,b)}function zeroString(a){for(var b="",c=0;c<a;c++)b+="0";return b}
function getAlignment(a){switch(a){case "integer":return"right";case "float":return"right";case "formula":return"right";case "text":return"left";case "boolean":return"left";case "null":return"left";default:return"left"}}
function getNumRange(a){if(isCell(a)){var b=getCellRowCol(a.toUpperCase()),a=parseInt(b[1]),b=getColNoFromLabel(b[0]);return a+":"+b+":"+a+":"+b}else if(isRange(a)){var a=a.split(":"),c=getCellRowCol(a[0].toUpperCase()),d=getCellRowCol(a[1].toUpperCase()),a=getColNoFromLabel(c[0]),b=getColNoFromLabel(d[0]),c=parseInt(c[1]),d=parseInt(d[1]);return c+":"+a+":"+d+":"+b}else return isNumRange(a)?a:null}
function getRange(a){if(isNumRange(a)){var b=a.split(":"),a=parseInt(b[0]),c=parseInt(b[1]),d=parseInt(b[2]),b=parseInt(b[3]);return a==d&&c==b?getColLabelFromNumber(c)+a:getColLabelFromNumber(c)+a+":"+getColLabelFromNumber(b)+d}}function stringToPercent(a){var a=(""+a).replace(/^[ ]|[ ]$/g,""),a=a.replace(/%/,""),b=getNumberType(a);return b=="integer"?parseInt(a)/100:b=="float"?parseFloat(a)/100:"0%"}
function percentToVal(a){var a=""+a,b=getNumberType(a);return b=="integer"?parseInt(a)*100+"%":b=="float"?parseFloat(a)*100+"%":a}function removeAllChildren(a){if(a.childNodes)for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0]);return a}function trapUpKeyFn(a){if(a==null)a=window.event;switch(a.keyCode){case 16:_isCellShiftDrag=!1}}
function OnMouseUp(){document.onmousemove=null;document.onmouseup=null;workbook.curDionGrid&&(workbook.curDionGrid.clearInterpolation(),workbook.curDionGrid.clearDrag())}
function trapKeyFn(a){if(workbook.curDionGrid){if(a==null)a=window.event;var b,c;a.keyCode==8&&workbook.curDionGrid.mode=="select"&&preventDefaultBehaviour(a);if(workbook.curDionGrid.mode!="none")switch(a.keyCode){case 16:if(!_isCellShiftDrag){a=workbook.curDionGrid.selectedRange.split(":");if(a.length!=4)return!1;_isCellShiftDrag=!0;_startCellX=parseInt(a[0]);_startCellY=parseInt(a[1]);_endCellX=parseInt(a[2]);_endCellY=parseInt(a[3])}break;case 17:break;case 9:b=null;workbook.curDionGrid.isInLRange(workbook.curDionGrid.curXLSRowNo,
workbook.curDionGrid.curXLSColNo)&&(b=workbook.curDionGrid.XLSCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo]);a.shiftKey?b&&b.previousCell!=""?(c=getCellRowCol(b.previousCell),b=parseInt(c[1]),c=getColNoFromLabel(c[0])):(c=workbook.curDionGrid.previousEditableCell(),b=c.rowNo,c=c.colNo):b&&b.nextCell!=""?(c=getCellRowCol(b.nextCell),b=parseInt(c[1]),c=getColNoFromLabel(c[0])):(c=workbook.curDionGrid.nextEditableCell(),b=c.rowNo,c=c.colNo);workbook.curDionGrid.goToCell(b,
c);preventDefaultBehaviour(a);break;case 33:b=workbook.curDionGrid.curXLSRowNo-10;b<1&&(b=1);a.shiftKey?(_endCellX-=10,_endCellX<1&&(_endCellX=1),workbook.curDionGrid.selectedRange=_startCellX+":"+_startCellY+":"+_endCellX+":"+_endCellY):workbook.curDionGrid.goToCell(b,workbook.curDionGrid.curXLSColNo);preventDefaultBehaviour(a);break;case 34:b=workbook.curDionGrid.curXLSRowNo+10;if(b>workbook.curDionGrid.XLSRowCount)b=workbook.curDionGrid.XLSRowCount;if(a.shiftKey){_endCellX+=10;if(_endCellX>workbook.curDionGrid.XLSRowCount)_endCellX=
workbook.curDionGrid.XLSRowCount;workbook.curDionGrid.selectedRange=_startCellX+":"+_startCellY+":"+_endCellX+":"+_endCellY}else workbook.curDionGrid.goToCell(b,workbook.curDionGrid.curXLSColNo);break;case 37:if(workbook.curDionGrid.mode=="select")a.shiftKey?(_endCellY-=1,_endCellY<1&&(_endCellY=1),workbook.curDionGrid.selectedRange=_startCellX+":"+_startCellY+":"+_endCellX+":"+_endCellY):(c=workbook.curDionGrid.leftEditableCell(),b=c.rowNo,c=c.colNo,workbook.curDionGrid.goToCell(b,c)),preventDefaultBehaviour(a);
break;case 38:a.shiftKey?(_endCellX-=1,_endCellX<1&&(_endCellX=1),workbook.curDionGrid.selectedRange=_startCellX+":"+_startCellY+":"+_endCellX+":"+_endCellY):(c=workbook.curDionGrid.upEditableCell(),b=c.rowNo,c=c.colNo,workbook.curDionGrid.goToCell(b,c));preventDefaultBehaviour(a);break;case 39:if(workbook.curDionGrid.mode=="select"){if(a.shiftKey){_endCellY+=1;if(_endCellY>workbook.curDionGrid.XLSColCount)_endCellY=workbook.curDionGrid.XLSColCount;workbook.curDionGrid.selectedRange=_startCellX+":"+
_startCellY+":"+_endCellX+":"+_endCellY}else c=workbook.curDionGrid.rightEditableCell(),b=c.rowNo,c=c.colNo,workbook.curDionGrid.goToCell(b,c);preventDefaultBehaviour(a)}break;case 40:if(a.shiftKey){_endCellX+=1;if(_endCellX>workbook.curDionGrid.XLSRowCount)_endCellX=workbook.curDionGrid.XLSRowCount;workbook.curDionGrid.selectedRange=_startCellX+":"+_startCellY+":"+_endCellX+":"+_endCellY}else c=workbook.curDionGrid.downEditableCell(),b=c.rowNo,c=c.colNo,workbook.curDionGrid.goToCell(b,c);preventDefaultBehaviour(a);
break;case 67:a.ctrlKey&&(workbook.curDionGrid.copySelectedCells(),preventDefaultBehaviour(a));break;case 86:a.ctrlKey&&(_isCut&&(workbook.curDionGrid.deleteSelectedCells(workbook.curDionGrid.copiedRange,"noShift"),_isCut=!1),workbook.curDionGrid.pasteSpecialCopiedCells(workbook.curDionGrid.curXLSRowNo,workbook.curDionGrid.curXLSColNo),preventDefaultBehaviour(a));break;case 88:if(a.ctrlKey)workbook.curDionGrid.borderMapper(workbook.curDionGrid.copiedRange,"noneDashed"),workbook.curDionGrid.copiedRange=
"",workbook.curDionGrid.copiedCellArray=[],_isCut=!0,workbook.curDionGrid.copySelectedCells(),preventDefaultBehaviour(a);break;case 46:workbook.curDionGrid.mode=="select"&&(workbook.curDionGrid.deleteSelectedCells(workbook.curDionGrid.selectedRange,"noShift"),preventDefaultBehaviour(a));break;case 13:c=a.shiftKey?workbook.curDionGrid.upEditableCell():workbook.curDionGrid.downEditableCell();b=c.rowNo;c=c.colNo;workbook.curDionGrid.goToCell(b,c);preventDefaultBehaviour(a);break;case 113:if(workbook.curDionGrid.XLSCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].readOnly==
!1)b=workbook.curDionGrid.displayCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].editor;b?b.focus():workbook.curDionGrid.isInLRange(workbook.curDionGrid.curXLSRowNo,workbook.curDionGrid.curXLSColNo)&&(a=workbook.curDionGrid.XLSCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo],workbook.curDionGrid.insertWidget(a.cellType,workbook.curDionGrid.curXLSRowNo,workbook.curDionGrid.curXLSColNo,a),workbook.curDionGrid.displayCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].editor&&
workbook.curDionGrid.displayCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].editor.focus());break;case 27:trapEscKeyFn(a);preventDefaultBehaviour(a);break;default:if(workbook.curDionGrid.mode!="edit"&&(!workbook.curDionGrid.isInXLSRange(workbook.curDionGrid.curXLSRowNo,workbook.curDionGrid.curXLSColNo)||workbook.curDionGrid.XLSCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].readOnly==!1))workbook.curDionGrid.displayCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].blur(),
workbook.curDionGrid.displayCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].editor&&workbook.curDionGrid.displayCellArray[workbook.curDionGrid.curXLSRowNo][workbook.curDionGrid.curXLSColNo].editor.focus();workbook.copiedCellArray.length>0&&(workbook.clearCopiedRange(),_isCut=!1)}}}function addEvent(a,b,c){document.addEventListener?a.addEventListener(b,c,null):document.attachEvent&&a.attachEvent("on"+b,c)}
function startcatching(){addEvent(document,"keypress",trapEscKeyFn)}
function trapEscKeyFn(a){if(a==null)a=window.event;if(a.keyCode==27){var b=workbook.curDionGrid.curXLSRowNo,c=workbook.curDionGrid.curXLSColNo;workbook.curDionGrid.isInXLSRange(b,c)&&(workbook.curDionGrid.refreshCell(b,c),workbook.curDionGrid.displayCellArray[b][c].editor&&workbook.curDionGrid.displayCellArray[b][c].editor.blur(),workbook.curDionGrid.refreshCell(b,c));workbook.curDionGrid.mode="select";preventDefaultBehaviour(a)}return!0}
function findPosX(a){var b=0;if(a.offsetParent)for(;;){b+=a.offsetLeft;if(!a.offsetParent)break;a=a.offsetParent}else a.x&&(b+=a.x);return b}function findPosY(a){var b=0;if(a.offsetParent)for(;;){b+=a.offsetTop;if(!a.offsetParent)break;a=a.offsetParent}else a.y&&(b+=a.y);return b}
function getNameOfMonth(a){switch(a){case "1":return"Jan";case "2":return"Feb";case "3":return"Mar";case "4":return"Apr";case "5":return"May";case "6":return"Jun";case "7":return"Jul";case "8":return"Aug";case "9":return"Sep";case "10":return"Oct";case "11":return"Nov";case "12":return"Dec";case "01":return"Jan";case "02":return"Feb";case "03":return"Mar";case "04":return"Apr";case "05":return"May";case "06":return"Jun";case "07":return"Jul";case "08":return"Aug";case "09":return"Sep"}}
function getMonthFromName(a){a=(""+a).toLowerCase();switch(a){case "jan":return"01";case "feb":return"02";case "mar":return"03";case "apr":return"04";case "may":return"05";case "jun":return"06";case "jul":return"07";case "aug":return"08";case "sep":return"09";case "oct":return"10";case "nov":return"11";case "dec":return"12";default:return a}}
function getDateFromText(a){var b=a.match(/^[1-9][0-9]*[dwmyDWMY]$/);if(b&&b.length==1)return a;else if(a=a.replace(/^[ ]|[ ]$/g,""),a=a.replace(" ","-"),a=a.replace(" ","-"),a=a.replace("/","-"),a=a.replace("/","-"),a=parseDate(a),a=Date.parse(a)){var c=new Date(a),a=c.getMonth()+1,b=c.getDate(),c=c.getFullYear();return a+"/"+b+"/"+c}else return NaN}function indexOfElementInArray(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1}
function parseDate(a){a=a.split("-");if(a.length!=3)return"";a[2].length==2&&(a[2]="20"+a[2]);return a[1].length==3?getMonthFromName(a[1])+"/"+a[0]+"/"+a[2]:a[0].length==3?getMonthFromName(a[0])+"/"+a[1]+"/"+a[2]:a[1]+"/"+a[0]+"/"+a[2]}function showErrorNotification(){}function log(a,b){console&&console.log(a,b)}
function addCopyRow(a,b,c){var d=new contextMenuItem;d.setParentDivId(a.contextMenuId);d.create("CopyRow");d.setLabel(gettext("Copy Row"));d.setAction(function(){b.hideContextMenu();b.copyRow(c)});a.addItem(d)}function addDeleteRow(a,b,c){var d=new contextMenuItem;d.setParentDivId(a.contextMenuId);d.create("DeleteRow");d.setLabel(gettext("Delete Row"));d.setAction(function(){b.hideContextMenu();b.deleteRows(c,1)});a.addItem(d)}
function addPasteRow(a,b,c){var d=new contextMenuItem;d.setParentDivId(a.contextMenuId);d.create("PasteRow");d.setLabel(gettext("Paste Row"));d.setAction(function(){b.hideContextMenu();b.paste(c,1)});a.addItem(d)};function defineContextMenu(){contextMenu=function(){this.contextMenuId="";this.contextMenuItemArray=[];this.contextMenuDiv=null;this.contextMenuItemCount=0;this.subMenu=null};contextMenu.prototype.createContextMenu=function(a,b){this.contextMenuDiv=document.createElement("div");this.contextMenuDiv.className="contextMenuDiv";this.contextMenuId=a;this.contextMenuDiv.id=a;b?document.getElementById(b).appendChild(this.contextMenuDiv):document.body.appendChild(this.contextMenuDiv)};contextMenu.prototype.addItem=
function(a){this.contextMenuItemArray[this.contextMenuItemCount]=a;a.setParentDivId(this.contextMenuId);this.contextMenuDiv.appendChild(a.contextMenuItemDiv);this.contextMenuItemCount++;a.parent=this;var b=this;a.contextMenuItemDiv.onmouseover=function(){b.hideSubMenu()}};contextMenu.prototype.hideSubMenu=function(){if(this.subMenu!=null)this.subMenu.contextMenuDiv.style.display="none",document.body.removeChild(this.subMenu.contextMenuDiv),this.subMenu=null};contextMenu.prototype.showSubMenu=function(){if(this.subMenu!=
null)document.body.appendChild(this.subMenu.contextMenuDiv),this.subMenu.contextMenuDiv.style.display="block"};contextMenuItem=function(){this.label="";this.action=null;this.parentDivId="";this.contextMenuItemDiv=null;this.contextMenuItemId="";this.parent=this.subMenu=null};contextMenuItem.prototype.create=function(a){this.contextMenuItemDiv=document.createElement("div");this.contextMenuItemDiv.className="contextMenuCell";this.contextMenuItemId=a;this.contextMenuItemDiv.id=a;document.getElementById(this.parentDivId).appendChild(this.contextMenuItemDiv)};
contextMenuItem.prototype.setLabel=function(a){this.label=a;this.contextMenuItemDiv.innerHTML=a};contextMenuItem.prototype.setAction=function(a){this.action=a;this.contextMenuItemDiv.onclick=a};contextMenuItem.prototype.setParentDivId=function(a){this.parentDivId=a};contextMenuItem.prototype.addSubMenuItem=function(a){var b=this;this.subMenu==null?(this.subMenu=new contextMenu,this.subMenu.createContextMenu(this.contextMenuItemId+"subMenu"),document.body.removeChild(this.subMenu.contextMenuDiv),$(b.contextMenuItemDiv).append($("<span class='fr' style='padding-left:5px'><img src='/static/newGrid/img/side-arrow.png'/></span>")),
this.subMenu.addItem(a),this.contextMenuItemDiv.onmouseover=function(){b.parent.hideSubMenu();b.parent.subMenu=b.subMenu;b.parent.showSubMenu()},this.subMenu.contextMenuDiv.style.left=getLengthFromString(this.parent.contextMenuDiv.style.left)+150+"px",this.subMenu.contextMenuDiv.style.top=this.parent.contextMenuDiv.style.top):this.subMenu.addItem(a)}}defineContextMenu();function isOperator(a){switch(a){case "(":case ")":case "^":case "*":case "/":case "%":case "+":case "-":case ",":case ">":case "<":case "=":return!0;default:return!1}}function operatorPrecedence(a){switch(a){case "^":return 14;case "*":case "/":case "%":return 13;case "+":case "-":return 12;case ">":case "<":case "=":return 11;default:return-1}}function operatorAssociativity(a){switch(a){case "^":return"R";default:return"L"}}
function isFunction(a){if(isNaN(a)==!1)return!1;if(typeof a!="string")return!1;switch(a.toUpperCase()){case "MATHMIN":case "MATHMAX":case "MATHSQRT":case "MATHSQUARE":case "IF":case "SUM":return!0;default:return!1}}function operatorArgCount(a){switch(a.toUpperCase()){case "+":case "-":case "*":case "/":case "^":case ">":case "<":case "=":return 2;default:return-1}}
function functionArgCount(a){switch(a.toUpperCase()){case "IF":return 3;case "MATHSQRT":case "MATHSQUARE":return 1;case "MATHMIN":case "MATHMAX":case "SUM":return 0;default:return-1}}function mathMin(a){for(var b=a[0],c=0;c<a.length;c++)a[c]<b&&(b=a[c]);return b}function mathMax(a){for(var b=a[0],c=0;c<a.length;c++)a[c]>b&&(b=a[c]);return b}function sum(a){for(var b=a[0],c=1;c<a.length;c++)b+=a[c];return b}function mathSqrt(a){return Math.pow(a,0.5)}function mathSquare(a){return a*a}
function bracketMatch(a){for(var b=0,c=0;c<a.length;c++)mChar=a.substr(c,1),mChar=="("?b++:mChar==")"&&b--;return b}function toBoolean(a){a=""+a;return a.toUpperCase()=="TRUE"?!0:a.toUpperCase()=="FALSE"?!1:null}function modifyFormula(a,b,c){a=""+a;if(a.split('"').length%2==0)return a;if(a.split("'").length%2==0)return a;for(var a=a.split('"'),d="",e=0;e<a.length;e+=2)d+=removeQuotes(a[e],b,c),e+1<a.length&&(d+='"'+a[e+1]+'"');return d}
function removeQuotes(a,b,c){for(var a=(""+a).split("'"),d="",e=0;e<a.length;e+=2)d+=modify(a[e],b,c),e+1<a.length&&(d+="'"+a[e+1]+"'");return d}function modify(a,b,c){for(var a=""+a,d=/[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}/,e="";a.match(d)!=null;)e+=a.substr(0,a.match(d).index)+""+modifyFormulaHelper(a.match(d)[0],b,c),a=a.substr(a.match(d).index+a.match(d)[0].length);e+=a;return e}
function modifyFormulaHelper(a,b,c){var a=""+a,d=/[\$]{1,1}[a-zA-Z]{1,3}[1-9]{1,1}[0-9]{0,3}/,e=/[a-zA-Z]{1,3}[\$]{1,1}[1-9]{1,1}[0-9]{0,3}/,f=/[1-9]{1,1}[0-9]{0,3}/,g=/[a-zA-Z]{1,3}/;return a.match(/[\$]{1,1}[a-zA-Z]{1,3}[\$]{1,1}[1-9]{1,1}[0-9]{0,3}/)!=null?a:a.match(d)!=null?"$"+a.match(g)[0]+(parseInt(a.match(f)[0])+b):a.match(e)!=null?getColLabelFromNumber(getColNoFromLabel(a.match(g)[0])+c)+"$"+a.match(f)[0]:getColLabelFromNumber(getColNoFromLabel(a.match(g)[0])+c)+(parseInt(a.match(f)[0])+
b)}function isCell(a){return a==void 0||a==null?!1:(""+a).match(/^[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}$/)!=null}function isRange(a){return a==void 0||a==null?!1:(""+a).match(/^[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}:[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}$/)!=null}function isNumRange(a){return a==void 0||a==null?!1:(""+a).match(/^[1-9]{1,1}[0-9]{0,3}:[1-9]{1,1}[0-9]{0,3}:[1-9]{1,1}[0-9]{0,3}:[1-9]{1,1}[0-9]{0,3}$/)!=null}
function isGridCell(a){if(a==void 0||a==null)return!1;a=(""+a).split(".");return a.length!=2?!1:(""+a[1]).match(/^[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}$/)!=null}function isGridRange(a){if(a==void 0||a==null)return!1;a=(""+a).split(".");return a.length!=2?!1:(""+a[1]).match(/^[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}:[\$]{0,1}[a-zA-Z]{1,3}[\$]{0,1}[1-9]{1,1}[0-9]{0,3}$/)!=null}
function notionalValue(a){a=removePreceedingZeros(a);if(!a)return 0;a=""+a;if(getNumberType(a)=="integer")return parseInt(a);else if(getNumberType(a)=="float")return parseFloat(a);else{var a=a.toUpperCase(),b=/^[0-9]+[\.]{0,1}[0-9]*[M]$/,c=/^[0-9]+[\.]{0,1}[0-9]*[B]$/,d=/^[0-9]+[\.]{0,1}[0-9]*[T]$/;return a.match(/^[0-9]+[\.]{0,1}[0-9]*[K]$/)?getNumVal(a.substr(0,a.length-1))*1E3:a.match(b)?getNumVal(a.substr(0,a.length-1))*1E6:a.match(c)?getNumVal(a.substr(0,a.length-1))*1E9:a.match(d)?getNumVal(a.substr(0,
a.length-1))*1E12:a}}function getNumVal(a){if(!a)return 0;a=""+a;return getNumberType(a)=="integer"?parseInt(a):getNumberType(a)=="float"?parseFloat(a):""};var FinsheetEditors={InputCellFormatter:function(a){a.item&&$("<div class='formatter_txt backgroundNone'>"+a.item.displayValue+"</div>").appendTo(a.container)},ComboCellFormatter:function(a){if(a.item){var b=$("<div class='drop_down'/>"),c=$("<div class='drop_down_text'>"),d=$("<div class='drop_down_img'>");c.html(a.item.valueOptions.possibleValues.split(",")[a.item.valueOptions.selectedIndex].toString());c.width(getLengthFromString(a.container.style.width)-20);d.css("left",getLengthFromString(a.container.style.width)-
19);b.appendTo(a.container);c.appendTo(b);d.appendTo(b)}},DeltaCellFormatter:function(a){if(a.item){var b=$("<div class='cellStyle paddingTop allGrayBorder'>"),c=$("<div class='formatter_txt'>");b.html(a.item.valueOptions.value.toString());c.html(a.item.valueOptions.text.toString());b.width(30);b.height(getLengthFromString(a.container.style.height)-4);c.width(getLengthFromString(a.container.style.width)-32);c.height(getLengthFromString(a.container.style.height));c.css("left",32);b.appendTo(a.container);
c.appendTo(a.container)}},CurrencyPairFormatter:function(a){a.item&&$("<div class='formatter_txt'>"+a.item.valueOptions.currency1.toString()+" / "+a.item.valueOptions.currency2.toString()+"</div>").appendTo(a.container)},ToggleFormatter:function(a){a.item&&($toggleDiv=$("<div class='toggle'/>"),$input=$("<div class='toggleText'/>"),$toggleImg=$("<div class='toggleImg'/>"),$toggleDiv.appendTo(a.container),$input.appendTo($toggleDiv),$toggleImg.appendTo($toggleDiv),$toggleDiv.width(getLengthFromString(a.container.style.width)-
2),$toggleDiv.height("100%"),$input.width(getLengthFromString(a.container.style.width)-23),$input.height("100%"),$toggleImg.css("left",getLengthFromString(a.container.style.width)-23),$input.html(a.item.valueOptions.possibleOptions[a.item.valueOptions.currentIndex]))},CheckBoxCellEditor:function(a){var b,c;this.init=function(){b=$("<div class='checkboxcellStyle'/>");c=$("<input type='checkbox' class='checkboxcellStyle2'></input>");b.append(c);b.appendTo(a.container);a.item&&this.loadValue(a.item);
c.click(function(){a.grid.saveOneScreenCellInMemory(a.rowNo,a.colNo)})};this.destroy=function(){};this.loadValue=function(a){if(a.valueOptions!=null){var e=a.valueOptions,a=e.value,e=e.text;this.defaultValue=a;a===!0?c.attr("checked",!0):c.attr("checked",!1);b.append("<b>"+e+"</b>")}};this.applyValue=function(a){a.valueOptions={value:c.is(":checked"),text:b.html()};a.updateCellByWidget();this.defaultValue=a.valueOptions.value};this.getValue=function(){return c.is(":checked")};this.isValueChanged=
function(){return!(!c.is(":checked")&&this.defaultValue==null)&&c.is(":checked")!=this.defaultValue};this.focus=function(){a.grid.mode="select"};this.blur=function(){a.grid.mode="none"};this.autofocus=function(){return!1};this.position=function(){};this.setBackground=function(){};this.setClass=function(){};this.init()},CurrencyPairEditor:function(a){var b,c;this.defaultValue="";this.rowNo=a.rowNo;this.colNo=a.colNo;var d=["AUD / USD","EUR / USD","GBP / USD","NZD / USD","USD / CAD","USD / CHF","USD / JPY"];
this.init=function(){var e=a.grid,f=this;b=$("<INPUT type='text' class='cellStyle' />");c=$("<div class = 'currencyToggle'>&nbsp;</div>");c.appendTo(a.container);b.appendTo(a.container);b.autocomplete(d,{minChars:0,max:110,autoFill:!1,mustMatch:!1,matchContains:!1,scrollHeight:220,width:getLengthFromString(a.container.style.width)});b.width(getLengthFromString(a.container.style.width)-27);c.width(21);b.height(getLengthFromString(a.container.style.height));c.click(function(){var a=b.val().split("/");
a.length===2&&(b.val($.trim(a[1])+" / "+$.trim(a[0])),e.saveOneScreenCellInMemory(f.rowNo,f.colNo))});b.keydown(function(a){if(a==null)a=window.event;switch(a.keyCode){case 33:case 34:case 37:case 38:case 39:case 40:e.mode="none";break;default:e.mode="edit"}});b.bind("change",function(){e.saveOneScreenCellInMemory(f.rowNo,f.colNo)});b.focus(function(){e.mode="none"});b.dblclick(function(a){b.focus();b.select();preventPropagation(a)});b.blur(function(){e.mode="none";e.saveOneScreenCellInMemory(f.rowNo,
f.colNo)});a.item&&this.loadValue(a.item)};this.destroy=function(){};this.focus=function(){b.focus();b.select()};this.blur=function(){b.blur()};this.autofocus=function(){return!1};this.loadValue=function(c){if(c.valueOptions!=null){var d=a.item.valueOptions.value.toString().substr(0,3)+" / "+a.item.valueOptions.value.toString().substr(3,3);b.val(d);this.rowNo=c.parentRow.rowNo;this.colNo=c.parentCol.colNo;this.defaultValue=d}};this.serializeValue=function(){return b.val()};this.applyValue=function(a){if(this.validate()){a.errorMesg=
"";for(var c=b.val().toUpperCase().replace("/","");c.indexOf(" ")>=0;)c=c.replace(" ","");a.valueOptions={value:c,currency1:c.substr(0,3),currency2:c.substr(3,3)};a.updateCellByWidget();this.defaultValue=a.valueOptions.value}};this.getValue=function(){return b.val()};this.isValueChanged=function(){return!(b.val()==""&&this.defaultValue==null)&&b.val()!=this.defaultValue};this.validate=function(){for(var a=b.val().toUpperCase().replace("/","");a.indexOf(" ")>=0;)a=a.replace(" ","");if(a.length!=6)return!1;
for(var c=a.substr(3,3)+" / "+a.substr(0,3),a=a.substr(0,3)+" / "+a.substr(3,3),g=0;g<d.length;g++)if(d[g]==a||d[g]==c)return!0;return!1};this.setBackground=function(a){b.css("background",a)};this.setClass=function(){};this.init()},DeltaEditor:function(a){var b,c;this.init=function(){var d=a.grid,e=this;b=$("<INPUT type='text' class='gridCellBorder'>");c=$("<div class='formatter_txt' />");b.appendTo(a.container);c.appendTo(a.container);b.width(30);c.width(getLengthFromString(a.container.style.width)-
2-32);c.css("left",32);b.height(getLengthFromString(a.container.style.height)-2);c.height(getLengthFromString(a.container.style.height));b.bind("change",function(){d.saveOneScreenCellInMemory(e.rowNo,e.colNo)});a.item&&this.loadValue(a.item)};this.focus=function(){a.grid.mode="edit";b.focus();b.select()};this.blur=function(){a.grid.mode="none";b.blur()};this.autofocus=function(){return!1};this.destroy=function(){};this.loadValue=function(a){if(a.valueOptions!=null)b.val(a.valueOptions.value),c.html(a.valueOptions.text),
this.rowNo=a.parentRow.rowNo,this.colNo=a.parentCol.colNo,this.defaultValue=a.valueOptions.value};this.serializeValue=function(){return b.val()+" "+c.html()};this.applyValue=function(a){a.valueOptions={value:b.val(),text:c.html()};a.updateCellByWidget();this.defaultValue=a.valueOptions.value};this.getValue=function(){return b.val()+" "+c.html()};this.isValueChanged=function(){return!(b.val()==""&&this.defaultValue==null)&&b.val()!=this.defaultValue};this.validate=function(){return{valid:!0,msg:null}};
this.setBackground=function(a){b.css("background",a)};this.setClass=function(){};this.init()},ToggleEditor:function(a){var b,c,d;this.defaultValue="";this.rowNo=a.rowNo;this.colNo=a.colNo;this.possibleOptions=[];this.currentIndex=0;this.init=function(){var e=a.grid,f=this;b=$("<div class='toggle'/>");c=$("<div class='toggleText'/>");d=$("<div class='toggleImg'>");b.appendTo(a.container);c.appendTo(b);d.appendTo(b);b.width(getLengthFromString(a.container.style.width));b.height("100%");c.width(getLengthFromString(a.container.style.width)-
16);c.height("100%");d.css("left",getLengthFromString(a.container.style.width)-16);d.width(16);d.height("100%");var g=function(){if(f.possibleOptions.length>0)f.currentIndex=(f.currentIndex+1)%f.possibleOptions.length,c.html(f.possibleOptions[f.currentIndex].text),e.saveOneScreenCellInMemory(f.rowNo,f.colNo)};b.click(g);var h=function(a){if(a==null)a=window.event;switch(a.keyCode){case 13:e.mode="none";g();break;default:e.mode="select"}};b.keydown(h);c.keydown(h);b.focus();a.item&&this.loadValue(a.item)};
this.destroy=function(){this.blur()};this.focus=function(){a.grid.mode="edit";d[0].className="toggleImgFocus";b.focus()};this.blur=function(){a.grid.mode="none";d[0].className="toggleImg";b.blur()};this.autofocus=function(){return!0};this.loadValue=function(a){if(a.valueOptions!=null){this.rowNo=a.parentRow.rowNo;this.colNo=a.parentCol.colNo;var b=a.valueOptions.possibleOptions;this.possibleOptions=[];var d=0,h;for(h in b){if(h==a.valueOptions.value)this.currentIndex=d;this.possibleOptions[this.possibleOptions.length]=
{text:b[h],value:h};d++}a=this.possibleOptions[this.currentIndex].text;c.html(a);this.defaultValue=a}};this.serializeValue=function(){return c.html()};this.applyValue=function(a){var b=this.possibleOptions,d={},h;for(h in b)d[b[h].value]=b[h].text;a.valueOptions={possibleOptions:d,value:b[this.currentIndex].value,currentIndex:this.currentIndex};a.updateCellByWidget();this.defaultValue=c.html()};this.getValue=function(){return c.html()};this.isValueChanged=function(){return!(c.html()==""&&this.defaultValue==
null)&&c.html()!=this.defaultValue};this.validate=function(){return{valid:!0,msg:null}};this.setBackground=function(){};this.setClass=function(){};this.init()},ClassToggleEditor:function(a){var b;this.init=function(){b=$("<p class='curveTypeLink' />");b.appendTo(a.container);b.width(getLengthFromString(a.container.style.width)-2);b.height(getLengthFromString(a.container.style.height));a.item&&this.loadValue(a.item)};this.destroy=function(){};this.focus=function(){b.focus()};this.blur=function(){b.blur()};
this.autofocus=function(){return!1};this.loadValue=function(a){if(a.valueOptions!=null)this.rowNo=a.parentRow.rowNo,this.colNo=a.parentCol.colNo,b.html(a.value),this.defaultValue=a.value,b.click(function(){a.valueOptions.action(a.parentRow.rowNo,a.parentCol.colNo)}),this.action=a.valueOptions.action};this.serializeValue=function(){return b.html()};this.applyValue=function(a){a.valueOptions={action:this.action};a.updateCellByWidget();this.defaultValue=b.html()};this.getValue=function(){return b.html()};
this.isValueChanged=function(){return!(b.html()==""&&this.defaultValue==null)&&b.html()!=this.defaultValue};this.validate=function(){return{valid:!0,msg:null}};this.setBackground=function(){};this.setClass=function(){};this.init()},NotionalEditor:function(a){var b,c,d,e;this.defaultNotionalVal=this.defaultValue="";this.rowNo=a.rowNo;this.colNo=a.colNo;this.possibleOptions=[];this.currentIndex=-1;this.displayType=new formatType("currency");this.displayMode="format";this.init=function(){var f=a.grid,
g=this;b=$("<div class='notional' tabindex='0'/>");c=$("<input class='notionalInput' type='text'/>");d=$("<div class='toggle' tabindex='0'/>");e=$("<div class='currencyText' tabindex='1'/>");c.appendTo(b);d.appendTo(b);e.appendTo(d);b.appendTo(a.container);d.width(35);d.height(getLengthFromString(a.container.style.height));e.width(35);e.height(getLengthFromString(a.container.style.height));d.css("left",getLengthFromString(a.container.style.width)-33);c.width(getLengthFromString(a.container.style.width)-
33);var h=function(){if(g.possibleOptions.length>0)g.currentIndex=(g.currentIndex+1)%g.possibleOptions.length,e.html(g.possibleOptions[g.currentIndex]),f.saveOneScreenCellInMemory(g.rowNo,g.colNo);c.blur();f.mode="select"};d.click(h);var i=function(a){if(a==null)a=window.event;switch(a.keyCode){case 13:f.mode="none";h();break;case 9:a.shiftKey?(c.focus(),f.mode="none",preventDefaultBehaviour(a)):f.mode="edit";break;default:f.mode="select"}};d.keydown(i);e.keydown(i);d.focus();a.item&&this.loadValue(a.item);
c.focus(function(){f.mode="edit";g.defaultNotionalVal!=0&&c.val(g.defaultNotionalVal);g.displayMode="value"});c.blur(function(){f.mode="none";var b=notionalValue(c.val());!b||b==0||b==""||b=="0"?c.val(""):c.val(b);f.saveOneScreenCellInMemory(g.rowNo,g.colNo);g.loadValue(a.item);g.displayMode="format"});c.keydown(function(a){if(a==null)a=window.event;switch(a.keyCode){case 9:a.shiftKey?f.mode="edit":(c.blur(),d.focus(),f.mode="none",preventDefaultBehaviour(a));break;default:f.mode="edit"}})};this.destroy=
function(){c.blur()};this.focus=function(){a.grid.mode="edit";c.focus();c.select()};this.blur=function(){a.grid.saveOneScreenCellInMemory(this.rowNo,this.colNo);a.grid.mode="none";c.blur()};this.autofocus=function(){return!1};this.loadValue=function(a){if(a.valueOptions!=null){this.rowNo=a.parentRow.rowNo;this.colNo=a.parentCol.colNo;this.possibleOptions=a.valueOptions.possibleOptions;this.currentIndex=a.valueOptions.currentIndex;e.html(this.possibleOptions[this.currentIndex]);this.defaultValue=this.possibleOptions[this.currentIndex];
var b=""+a.valueOptions.value,d=b.match(/^[-+]?[0-9]*\.?[0-9]*[mMkKbBtT]?$/);d&&d.length>0&&b!=""?(this.displayMode="format",this.displayType=new formatType("currency"),this.displayType.decimalCount=0,this.displayType.symbol="",b=convertTo(a.valueOptions.value,"integer",this.displayType),!b||b==""?c.val(""):c.val(b),this.defaultNotionalVal=a.valueOptions.value):(this.displayMode="format",this.displayType=new formatType("currency"),this.displayType.decimalCount=0,this.displayType.symbol="",c.val(""),
this.defaultNotionalVal="")}};this.serializeValue=function(){return c.val()};this.applyValue=function(a){if(this.validate()){var b=notionalValue(convertToNum(c.val(),this.displayType));b<1E15&&b>=0&&c.val()!=""?(a.errorMesg="",a.valueOptions={possibleOptions:this.possibleOptions,value:notionalValue(b),currentIndex:this.currentIndex,displayValue:convertTo(notionalValue(b),"integer",this.displayType)},a.updateCellByWidget(),this.defaultNotionalVal=a.valueOptions.value,this.defaultValue=a.valueOptions.possibleOptions[a.valueOptions.currentIndex],
(a=convertTo(notionalValue(b),"integer",this.displayType))?c.val(a):c.val("")):(c.val()==""?(c.val(""),this.defaultNotionalVal="",a.valueOptions={possibleOptions:this.possibleOptions,value:"",currentIndex:this.currentIndex,displayValue:""},this.defaultValue=a.valueOptions.possibleOptions[a.valueOptions.currentIndex]):(c.val(""),this.defaultNotionalVal="",this.defaultValue=a.valueOptions.possibleOptions[a.valueOptions.currentIndex],a.valueOptions={possibleOptions:this.possibleOptions,value:"",currentIndex:this.currentIndex,
displayValue:""}),a.errorMesg="Incorrect Input",a.updateCellByWidget())}else this.loadValue(a)};this.getValue=function(){return c.val()};this.isValueChanged=function(){return!(e.html()==""&&this.defaultValue==null)&&e.html()!=this.defaultValue||!(c.val()==""&&this.defaultNotionalVal==null)&&c.val()!=this.defaultNotionalVal&&this.displayMode=="value"};this.validate=function(){var a=(c.val()+"").match(/^[+]?[0-9]*\.?[0-9]*[mMkKbBtT]?$/);if(a&&a.length>0)return!0;a=notionalValue(convertToNum(c.val(),
this.displayType));return parseInt(a)!=NaN?!0:!1};this.setBackground=function(a){c.css("background",a);b.css("background",a)};this.setClass=function(){};this.init()},DateCellEditor:function(a){var b,c,d=!1;this.init=function(){var e=a.grid,f=this;b=$("<INPUT type=text class='dateGridCell' />");c=$("<div class='dateImage' />");b.appendTo(a.container);c.appendTo(a.container);this.isOpen=!1;a.item&&this.loadValue(a.item);b.width(getLengthFromString(a.container.style.width));c.css("top",2);c.height(15);
c.width(16);c.css("left",getLengthFromString(a.container.style.width)-21);b.height(getLengthFromString(a.container.style.height));b.focus(function(a){e.mode="edit";preventPropagation(a)});b.blur(function(){e.mode="none";e.saveOneScreenCellInMemory(f.rowNo,f.colNo)});var g=function(){if(d==!1){var a=new Date,c=a.getMonth()+1,g=a.getDate(),a=a.getFullYear(),c=g+" "+getNameOfMonth(c)+" "+a;b.DatePicker({flat:!1,date:c,current:c,calendars:1,starts:1,onChange:function(a){b.val(a);e.saveOneScreenCellInMemory(f.rowNo,
f.colNo);b.DatePickerHide();e.mode="select"}});b.DatePickerSetDate(b.val(),!0);d=!0;b.DatePickerShow()}else d=!1,b.DatePickerHide(),$(".datepicker").remove()};b.keydown(function(a){if(a==null)a=window.event;switch(a.keyCode){case 13:g(a),Grid.mode="select"}});c.mousedown(function(a){g(a)});b.click(function(){b.DatePickerHide()})};this.destroy=function(){$(".datepicker").remove()};this.position=function(){};this.autofocus=function(){return!1};this.focus=function(){b.focus();b.select();a.grid.mode=
"edit"};this.blur=function(){b.blur();a.grid.mode="none"};this.loadValue=function(a){if(a.valueOptions!=null){this.rowNo=a.parentRow.rowNo;this.colNo=a.parentCol.colNo;var c="",d;a.valueOptions.value&&(d=a.valueOptions.value.toString().split("/"),c=d[1]+" "+getNameOfMonth(d[0])+" "+d[2]);if(a.valueOptions.value=="")b.val(""),this.defaultValue="";if(d&&d.length==3)this.defaultValue=getDateFromText(c),b.val(c)}};this.serializeValue=function(){return b.val()};this.applyValue=function(a){var c=getDateFromText(b.val());
c?(a.errorMesg="",a.valueOptions={value:c},a.updateCellByWidget(),this.defaultValue=a.valueOptions.value):(a.errorMesg="",this.loadValue(a),this.defaultValue="")};this.getValue=function(){return b.val()};this.isValueChanged=function(){var a=getDateFromText(b.val());return a&&!(a==""&&this.defaultValue==null)&&a!=this.defaultValue};this.validate=function(){return{valid:!0,msg:null}};this.setBackground=function(c){b.css("background",c);a.container&&$(a.container).css("background",c)};this.setClass=
function(){};this.init()},RadioCellEditor:function(a){var b;this.init=function(){b=document.createElement("div");a.container.appendChild(b);a.item&&this.loadValue(a.item)};this.destroy=function(){};this.loadValue=function(c){var d=this;if(c.valueOptions!=null){var e=c.valueOptions;removeAllChildren(b);this.options=[];for(var f=0;f<e.possibleValues.length;f++){var g=e.possibleValues[f];if(g.value!=""){var h=document.createElement("input");h.type="radio";h.value=g.value;h.name=c.valueOptions.groupName;
h.index=f;$(h).appendTo(b);d.options[f]=h;var i=function(){for(var b=0;b<d.options.length;b++)d.options[b].checked=!1;this.checked=!0;d.selectedIndex=this.index;a.grid.saveOneScreenCellInMemory(a.rowNo,a.colNo)};h.onclick=i;h=document.createElement("span");h.innerHTML=g.text;$(h).appendTo(b);h.index=f;h.onclick=i}}this.selectedIndex=e.selectedIndex;this.options[this.selectedIndex].checked=!0;this.possibleValues=e.possibleValues;this.rowNo=c.parentRow.rowNo;this.colNo=c.parentCol.colNo}};this.serializeValue=
function(){return this.options[this.selectedIndex].value};this.applyValue=function(a){a.valueOptions={value:this.options[this.selectedIndex].value,possibleValues:this.possibleValues,selectedIndex:this.selectedIndex};a.updateCellByWidget();this.defaultValue=a.valueOptions.value};this.getValue=function(){return this.options[this.selectedIndex].value};this.isValueChanged=function(){return!(this.options[this.selectedIndex].value==""&&this.defaultValue==null)&&this.options[this.selectedIndex].value!=this.defaultValue};
this.validate=function(){return{valid:!0,msg:null}};this.focus=function(){a.grid.mode="select"};this.blur=function(){a.grid.mode="none"};this.autofocus=function(){return!0};this.position=function(){};this.setBackground=function(){};this.setClass=function(){};this.init()},InputCellEditor:function(a){var b;this.dataFormatType="string";this.init=function(){var c,d=a.grid,e=this;c=document.createElement("input");c.className="inputCell ";c.onblur=function(){d.saveOneScreenCellInMemory(e.rowNo,e.colNo);
d.mode="none"};c.onfocus=function(){d.mode="edit";b.select();if(d.isInXLSRange(e.rowNo,e.colNo)){var a=d.XLSCellArray[e.rowNo][e.colNo];this.value=a.displayType&&a.displayType.format=="percent"?percentToVal(a.stringValue):a.stringValue;a.isDirty=!1}};c.onkeyup=function(){d.mode="edit";var a=b;if(d.formulaBarInput!=null)d.formulaBarInput.value=a.val()};a.container.appendChild(c);b=$(c);c=d.isCurrentCell(e.rowNo,e.colNo);a.item&&this.loadValue(a.item,c)};this.destroy=function(){};this.position=function(a){b.width(a.width);
b.height(a.height)};this.focus=function(){a.grid.mode="edit"};this.blur=function(){a.grid.mode="none"};this.autofocus=function(){return!1};this.loadValue=function(a,d){if(a.valueOptions!=null&&(this.rowNo=a.parentRow.rowNo,this.colNo=a.parentCol.colNo,d?b.val(a.displayValue):(this.value=a.displayType&&a.displayType.format=="percent"?percentToVal(a.stringValue):a.stringValue,b.val(this.value)),this.defaultValue=a.valueOptions.value,a.valueOptions.dataFormatType))this.dataFormatType=a.valueOptions.dataFormatType};
this.serializeValue=function(){return b.val()};this.applyValue=function(a){if(this.validate()){a.errorMesg="";var d=b.val();if(a.displayType&&a.displayType.format=="percent")d=stringToPercent(d);else if(a.displayType&&a.displayType.format=="delta"){var e=d.match(/^[0-9]*$/);e&&e.length>0||(d="")}a.valueOptions={value:d,dataFormatType:this.dataFormatType};a.updateCellByString(d);a.isModified=!1;this.defaultValue=a.valueOptions.value}};this.getValue=function(){return b.val()};this.isValueChanged=function(){return!(b.val()==
""&&this.defaultValue==null)&&b.val()!=this.defaultValue};this.validate=function(){if(this.dataFormatType=="integer"){var a=/^[0-9]*$/;return(a=b.val().match(a))&&a.length>0?!0:!1}else return this.dataFormatType=="float"?(a=/^[-+]?[0-9]*\.?[0-9]*$/,(a=b.val().match(a))&&a.length>0?!0:!1):!0};this.focus=function(){a.grid.mode="edit";b.focus();b.select()};this.blur=function(){b.blur()};this.setBackground=function(a){b.css("background",a)};this.setClass=function(a){b.attr("class",a)};this.init()},DropDownCellEditor:function(a){var b;
this.rowNo=a.rowNo;this.colNo=a.colNo;this.selectedObj=this.dropdownMenu=null;this.shortcutMap={};this.valueMap={};this.isShortcutEnabled=!1;this.isAutocompleteEnabled=!0;this.highlightedItem=null;this.highlightedIndex=0;var c=null;this.init=function(){var d=this;b=document.createElement("input");b.type="text";b.className="dropdownText";var e=a.grid;c=$("<div class='drop_down'/>");var f=$("<div class='drop_down_img'>");f.click(function(c){if(d.dropdownMenu==null){$(document).trigger("click");var f=
d.possibleValues;if(f.length>0)d.dropdownMenu=new dropdown,d.dropdownMenu.createDropdown(a.container),d.dropdownMenu.dropdownDiv.style.minWidth=a.container.clientWidth+"px",d.dropdownMenu.setPosition({left:$(a.container).offset().left,top:$(a.container).offset().top+a.container.clientHeight}),document.onclick=function(){d.destroy()},document.body.onclick=function(){d.destroy()};for(var i=0;i<f.length;i++)if(f[i].value!=""){var j=new dropdownItem;j.create();if(!f[i].displayLabel)f[i].displayLabel=
f[i].label;j.setObj({name:f[i].label,displayName:f[i].displayLabel,shorcut:f[i].shortcut,value:f[i].value,index:i,subIndex:-1});d.dropdownMenu.addItem(j);if(f[i].subMenu){for(var k=0;k<f[i].subMenu.length;k++){var m=new dropdownItem;m.create();if(!f[i].subMenu[k].displayLabel)f[i].subMenu[k].displayLabel=f[i].subMenu[k].label;m.setObj({name:f[i].subMenu[k].label,displayName:f[i].subMenu[k].displayLabel,shorcut:f[i].subMenu[k].shortcut,value:f[i].subMenu[k].value,index:i,subIndex:k});m.setAction(function(){d.destroy();
preventPropagation(c);if(this.parentObj)d.selectedObj=this.parentObj.dropdownItemObj,b.value=this.parentObj.dropdownItemObj.displayName,e.saveOneScreenCellInMemory(a.rowNo,a.colNo)});j.addSubMenuItem(m)}k=function(a){preventPropagation(a)}}else k=function(c){d.destroy();preventPropagation(c);d.selectedObj=this.parentObj.dropdownItemObj;b.value=this.parentObj.dropdownItemObj.displayName;e.saveOneScreenCellInMemory(a.rowNo,a.colNo)};j.setAction(k)}preventPropagation(c)}else $(document).trigger("click")});
b.onkeydown=function(a){if(a==null)a=window.event;if(d.dropdownMenu&&d.isAutocompleteEnabled&&d.highlightedItem)if(a.keyCode==38){if(d.highlightedIndex>0)d.dropdownMenu.dropdownItemArray[d.highlightedIndex].setSelected(!1),d.highlightedIndex--,d.highlightedItem=d.dropdownMenu.dropdownItemArray[d.highlightedIndex].dropdownItemObj,d.dropdownMenu.dropdownItemArray[d.highlightedIndex].setSelected(!0),preventPropagation(a)}else if(a.keyCode==40&&d.highlightedIndex>=0){if(d.highlightedIndex+1<d.dropdownMenu.dropdownItemArray.length)d.dropdownMenu.dropdownItemArray[d.highlightedIndex].setSelected(!1),
d.highlightedIndex++,d.highlightedItem=d.dropdownMenu.dropdownItemArray[d.highlightedIndex].dropdownItemObj,d.dropdownMenu.dropdownItemArray[d.highlightedIndex].setSelected(!0);preventPropagation(a)}};b.onkeyup=function(c){if(c==null)c=window.event;e.mode="edit";if(c.keyCode!=38&&c.keyCode!=40&&d.isAutocompleteEnabled){d.dropdownMenu!=null&&d.destroy();var f=d.possibleValues;if(f.length>0)d.dropdownMenu=new dropdown,d.dropdownMenu.createDropdown(a.container),d.dropdownMenu.dropdownDiv.style.minWidth=
a.container.style.width,d.dropdownMenu.setPosition({left:findPosX(a.container),top:findPosY(a.container)+getLengthFromString(a.container.style.height)}),document.onclick=function(){d.destroy()};for(var i=0,j=0;j<f.length;j++)if(f[j].value!=""){if(!f[j].displayLabel)f[j].displayLabel=f[j].label;if(f[j].displayLabel.toLowerCase().match(b.value.toLowerCase())){i++;var k=new dropdownItem;k.create();k.setObj({name:f[j].label,displayName:f[j].displayLabel,shorcut:f[j].shortcut,value:f[j].value,index:j,
subIndex:-1});d.dropdownMenu.addItem(k);if(i==1)d.highlightedItem={name:f[j].label,displayName:f[j].displayLabel,shorcut:f[j].shortcut,value:f[j].value,index:j,subIndex:-1},d.highlightedIndex=0,k.setSelected(!0);var m=function(c){d.destroy();preventPropagation(c);d.selectedObj=this.parentObj.dropdownItemObj;b.value=this.parentObj.dropdownItemObj.displayName;e.saveOneScreenCellInMemory(a.rowNo,a.colNo)};k.setAction(m)}}i==0&&(k=new dropdownItem,k.create(),k.setObj({name:"Invalid Input",displayName:"Invalid Input",
shorcut:"",value:"Invalid Input",index:-1,subIndex:-1}),d.dropdownMenu.addItem(k),k.setAction(function(a){d.destroy();preventPropagation(a)}));preventPropagation(c)}};$(b).width("100%");c.appendTo(a.container);$(b).appendTo(c);f.appendTo(c);a.item&&this.loadValue(a.item)};this.destroy=function(){this.highlightedItem=null;this.highlightedIndex=-1;this.dropdownMenu!=null&&(this.dropdownMenu.hideSubMenu(),document.body.removeChild(this.dropdownMenu.dropdownDiv));this.dropdownMenu=null;document.onclick=
null};this.loadValue=function(a){if(a.valueOptions!=null){var c=a.valueOptions;if(a.valueOptions.isAutocompleteEnabled==!1)this.isAutocompleteEnabled=!1;var f=a.valueOptions.index,g=a.valueOptions.subIndex;if(g==-1){var h=c.possibleValues;if(!h[f].displayLabel)h[f].displayLabel=h[f].label;this.selectedObj={name:h[f].label,displayName:h[f].displayLabel,shorcut:h[f].shortcut,value:h[f].value,index:f,subIndex:-1}}else{h=c.possibleValues;if(!h[f].subMenu[g].displayLabel)h[f].subMenu[g].displayLabel=h[f].subMenu[g].label;
this.selectedObj={name:h[f].subMenu[g].label,displayName:h[f].subMenu[g].displayLabel,shorcut:h[f].subMenu[g].shortcut,value:h[f].subMenu[g].value,index:f,subIndex:g}}this.defaultValue=b.value=this.selectedObj.displayName;this.possibleValues=c.possibleValues;this.rowNo=a.parentRow.rowNo;this.colNo=a.parentCol.colNo;this.valueMap={};this.shortcutMap={};for(f=0;f<c.possibleValues.length;f++)if(c.possibleValues[f].subMenu){this.isAutocompleteEnabled=!1;for(g=0;g<c.possibleValues[f].subMenu.length;g++)c.possibleValues[f].subMenu[g].shortcut&&
(this.shortcutMap[c.possibleValues[f].subMenu[g].shortcut.toUpperCase()]={index:f,subIndex:g},this.valueMap[c.possibleValues[f].subMenu[g].value]={index:f,subIndex:g})}else c.possibleValues[f].shortcut&&(this.shortcutMap[c.possibleValues[f].shortcut.toUpperCase()]={index:f,subIndex:-1},this.valueMap[c.possibleValues[f].value]={index:f,subIndex:-1})}};this.serializeValue=function(){return combo.value};this.applyValue=function(a){var c=b.value.toUpperCase(),f=this.possibleValues,g=this.shortcutMap,
h=this.valueMap;if(this.highlightedItem)this.selectedObj=this.highlightedItem,this.highlightedItem=null,this.highlightedIndex=-1,b.value=this.selectedObj.displayName;else if(g[c]){if(g[c].subIndex==-1){var i=g[c].index;if(!f[i].displayLabel)f[i].displayLabel=f[i].label;this.selectedObj={name:f[i].label,displayName:f[i].displayLabel,shorcut:f[i].shortcut,value:f[i].value,index:i,subIndex:-1}}else{i=g[c].index;c=g[c].subIndex;if(!f[i].subMenu[c].displayLabel)f[i].subMenu[c].displayLabel=f[i].subMenu[c].label;
this.selectedObj={name:f[i].subMenu[c].label,displayName:f[i].subMenu[c].displayLabel,shorcut:f[i].subMenu[c].shortcut,value:f[i].subMenu[c].value,index:i,subIndex:c}}b.value=this.selectedObj.displayName}else if(h[c]){if(h[c].subIndex==-1){i=h[c].index;if(!f[i].displayLabel)f[i].displayLabel=f[i].label;this.selectedObj={name:f[i].label,displayName:f[i].displayLabel,shorcut:f[i].shortcut,value:f[i].value,index:i,subIndex:-1}}else{i=h[c].index;c=h[c].subIndex;if(!f[i].subMenu[c].displayLabel)f[i].subMenu[c].displayLabel=
f[i].subMenu[c].label;this.selectedObj={name:f[i].subMenu[c].label,displayName:f[i].subMenu[c].displayLabel,shorcut:f[i].subMenu[c].shortcut,value:f[i].subMenu[c].value,index:i,subIndex:c}}b.value=this.selectedObj.displayName}a.valueOptions={value:this.selectedObj.value,possibleValues:this.possibleValues,index:this.selectedObj.index,subIndex:this.selectedObj.subIndex};b.value=this.selectedObj.displayName;a.updateCellByWidget();this.defaultValue=this.selectedObj.value};this.getValue=function(){return this.selectedObj.value};
this.isValueChanged=function(){return!(b.value==""&&this.defaultValue==null)&&b.value!=this.defaultValue};this.validate=function(){return{valid:!0,msg:null}};this.focus=function(){b.focus();b.select();a.grid.mode="select"};this.blur=function(){b.blur();var c=a.grid;c.saveOneScreenCellInMemory(this.rowNo,this.colNo);this.destroy();c.mode="none"};this.autofocus=function(){return!1};this.position=function(a){$(b).width(a.width);$(b).height(a.height)};this.setBackground=function(a){$(b).css("background",
a);c.css("background",a)};this.setClass=function(){};this.init()},getEditor:function(a){switch(a){case "date":return FinsheetEditors.DateCellEditor;case "input":return FinsheetEditors.InputCellEditor;case "combo":return FinsheetEditors.DropDownCellEditor;case "dropdown":return FinsheetEditors.DropDownCellEditor;case "currencyPair":return FinsheetEditors.CurrencyPairEditor;case "toggle":return FinsheetEditors.ToggleEditor;case "notional":return FinsheetEditors.NotionalEditor;case "amount":return FinsheetEditors.NotionalEditor;
case "delta":return FinsheetEditors.DeltaEditor;case "classToggle":return FinsheetEditors.ClassToggleEditor;case "radio":return FinsheetEditors.RadioCellEditor;case "checkbox":return FinsheetEditors.CheckBoxCellEditor;default:return FinsheetEditors.InputCellEditor}},getFormatter:function(a){switch(a){case "date":return FinsheetEditors.DateCellFormatter;case "input":return FinsheetEditors.InputCellFormatter;case "combo":return FinsheetEditors.DropDownCellEditor;case "dropdown":return FinsheetEditors.DropDownCellEditor;
case "delta":return FinsheetEditors.DeltaCellFormatter;case "currencyPair":return FinsheetEditors.CurrencyPairFormatter;case "toggle":return FinsheetEditors.ToggleEditor;case "notional":return FinsheetEditors.NotionalEditor;case "amount":return FinsheetEditors.NotionalEditor;case "classToggle":return FinsheetEditors.ClassToggleEditor;case "checkbox":return FinsheetEditors.CheckBoxCellEditor;case "radio":return FinsheetEditors.RadioCellEditor;default:return FinsheetEditors.InputCellFormatter}},hasFormatter:function(a){switch(a){case "date":return!1;
case "input":return!0;case "combo":return!1;case "dropdown":return!1;case "delta":return!0;case "currencyPair":return!0;case "toggle":return!1;case "notional":return!1;case "amount":return!1;case "classToggle":return!0;case "radio":return!1;case "checkbox":return!1;default:return!0}}};function defineGridFormat(){clsDionGrid.prototype.mapFnToRange=function(a,b){var c=a.split(":");if(c.length!=4)return!1;var d=parseInt(c[0]),e=parseInt(c[1]),f=parseInt(c[2]),c=parseInt(c[3]);if(d>f)var g=f,f=d,d=g;e>c&&(g=c,c=e,e=g);for(;d<=f;d++)for(g=e;g<=c;g++)b(d,g);this.updateScreenFromXLS()};clsDionGrid.prototype.boldRangeFn=function(a){var b=this;this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=toggleClassName(b.XLSCellArray[a][d].className,"boldFontCellClass ")})};clsDionGrid.prototype.italicRangeFn=
function(a){var b=this;this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=toggleClassName(b.XLSCellArray[a][d].className,"italicStyleCellClass ")})};clsDionGrid.prototype.underlineRangeFn=function(a){var b=this;this.mapFnToRange(a,function(a,d){b.XLSCellArray[a][d].className=toggleClassName(b.XLSCellArray[a][d].className,"underlineDecorationCellClass ")})};clsDionGrid.prototype.alignRangeFn=function(a,b){var c=this;this.mapFnToRange(a,function(a,e){c.XLSCellArray[a][e].className=removeClassName(c.XLSCellArray[a][e].className,
c.XLSCellArray[a][e].align+"AlignCellClass");c.XLSCellArray[a][e].align=b;c.XLSCellArray[a][e].className+=b+"AlignCellClass "})};clsDionGrid.prototype.borderMapper=function(a,b){var c=a.split(":");if(c.length!=4)return!1;var d=parseInt(c[0]),e=parseInt(c[1]),f=parseInt(c[2]),c=parseInt(c[3]);if(d>f)var g=f,f=d,d=g;e>c&&(g=c,c=e,e=g);if(b=="top")for(g=e;g<=c;g++)this.XLSCellArray[d][g].className=removeClassName(this.XLSCellArray[d][g].className,"borderDashedTopCellClass "),this.XLSCellArray[d][g].className=
addClassName(this.XLSCellArray[d][g].className,"borderTopCellClass ");else if(b=="bottom")for(g=e;g<=c;g++)f!=this.XLSRowCount?(this.XLSCellArray[f+1][g].className=removeClassName(this.XLSCellArray[f+1][g].className,"borderDashedTopCellClass"),this.XLSCellArray[f+1][g].className=addClassName(this.XLSCellArray[f+1][g].className,"borderTopCellClass ")):(this.XLSCellArray[f][g].className=removeClassName(this.XLSCellArray[f][g].className,"borderDashedBottomCellClass"),this.XLSCellArray[f][g].className=
addClassName(this.XLSCellArray[f][g].className,"borderBottomCellClass "));else if(b=="right")for(var h=d;h<=f;h++)c!=this.XLSColCount?(this.XLSCellArray[h][c+1].className=removeClassName(this.XLSCellArray[h][c+1].className,"borderDashedLeftCellClass"),this.XLSCellArray[h][c+1].className.indexOf("borderLeftCellClass ")==-1&&(this.XLSCellArray[h][c+1].className+="borderLeftCellClass ")):(this.XLSCellArray[h][c].className=removeClassName(this.XLSCellArray[h][c].className,"borderDashedRightCellClass"),
this.XLSCellArray[h][c].className.indexOf("borderRightCellClass ")==-1&&(this.XLSCellArray[h][c].className+="borderRightCellClass "));else if(b=="left")for(h=d;h<=f;h++)this.XLSCellArray[h][e].className=removeClassName(this.XLSCellArray[h][e].className,"borderDashedLeftCellClass "),this.XLSCellArray[h][e].className.indexOf("borderLeftCellClass ")==-1&&(this.XLSCellArray[h][e].className+="borderLeftCellClass ");else if(b=="all")this.borderMapper(a,"right"),this.borderMapper(a,"left"),this.borderMapper(a,
"bottom"),this.borderMapper(a,"top");else if(b=="topDashed")for(g=e;g<=c;g++)this.XLSCellArray[d][g].className.indexOf("borderDashedTopCellClass ")==-1&&(this.XLSCellArray[d][g].className+="borderDashedTopCellClass ");else if(b=="bottomDashed")for(g=e;g<=c;g++)f!=this.XLSRowCount?this.XLSCellArray[f+1][g].className.indexOf("borderDashedTopCellClass ")==-1&&(this.XLSCellArray[f+1][g].className+="borderDashedTopCellClass "):this.XLSCellArray[f][g].className.indexOf("borderDashedBottomCellClass ")==
-1&&(this.XLSCellArray[f][g].className+="borderDashedBottomCellClass ");else if(b=="rightDashed")for(h=d;h<=f;h++)c!=this.XLSColCount?this.XLSCellArray[h][c+1].className.indexOf("borderDashedLeftCellClass ")==-1&&(this.XLSCellArray[h][c+1].className+="borderDashedLeftCellClass "):this.XLSCellArray[h][c].className.indexOf("borderDashedRightCellClass ")==-1&&(this.XLSCellArray[h][c].className+="borderDashedRightCellClass ");else if(b=="leftDashed")for(h=d;h<=f;h++)this.XLSCellArray[h][e].className.indexOf("borderDashedLeftCellClass ")==
-1&&(this.XLSCellArray[h][e].className+="borderDashedLeftCellClass ");else if(b=="allDashed")this.borderMapper(a,"rightDashed"),this.borderMapper(a,"leftDashed"),this.borderMapper(a,"bottomDashed"),this.borderMapper(a,"topDashed");else if(b=="none"){for(h=d;h<=f;h++)for(g=e;g<=c;g++)this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderLeftCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedLeftCellClass "),
this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderRightCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedRightCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderTopCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedTopCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,
"borderBottomCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedBottomCellClass ");for(h=d;h<=f&&c+1<=this.XLSColCount;h++)this.XLSCellArray[h][c+1].className=removeClassName(this.XLSCellArray[h][c+1].className,"borderLeftCellClass "),this.XLSCellArray[h][c+1].className=removeClassName(this.XLSCellArray[h][c+1].className,"borderDashedLeftCellClass ");for(g=e;g<=c&&f+1<=this.XLSRowCount;g++)this.XLSCellArray[f+1][g].className=removeClassName(this.XLSCellArray[f+
1][g].className,"borderTopCellClass "),this.XLSCellArray[f+1][g].className=removeClassName(this.XLSCellArray[f+1][g].className,"borderDashedTopCellClass ")}else if(b=="noneDashed"){for(h=d;h<=f;h++)for(g=e;g<=c;g++)this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedLeftCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedRightCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,
"borderDashedTopCellClass "),this.XLSCellArray[h][g].className=removeClassName(this.XLSCellArray[h][g].className,"borderDashedBottomCellClass ");for(h=d;h<=f&&c+1<=this.XLSColCount;h++)this.XLSCellArray[h][c+1].className=removeClassName(this.XLSCellArray[h][c+1].className,"borderDashedLeftCellClass ");for(g=e;g<=c&&f+1<=this.XLSRowCount;g++)this.XLSCellArray[f+1][g].className=removeClassName(this.XLSCellArray[f+1][g].className,"borderDashedTopCellClass ")}this.updateScreenFromXLS()}}defineGridFormat();function defineFormatType(){formatType=function(a){this.format=a;if(a=="integer")this.decimalCount=0,this.useThousandSeparator=!1;else if(a=="float")this.decimalCount=2,this.useThousandSeparator=!1;else if(a=="currency")this.decimalCount=2,this.useThousandSeparator=!0,this.symbol="$";else if(a=="accounting")this.decimalCount=2,this.useThousandSeparator=!0,this.symbol="";else if(a=="percent")this.decimalCount=0};formatType.prototype.copy=function(){var a=new formatType(this.format);if(this.format==
"integer")a.decimalCount=this.decimalCount,a.useThousandSeparator=this.useThousandSeparator;else if(this.format=="float")a.decimalCount=this.decimalCount,a.useThousandSeparator=this.useThousandSeparator;else if(this.format=="currency")a.decimalCount=this.decimalCount,a.useThousandSeparator=this.useThousandSeparator,a.symbol=this.symbol;else if(this.format=="accounting")a.decimalCount=this.decimalCount,a.useThousandSeparator=this.useThousandSeparator,a.symbol=this.symbol;else if(this.format=="percent")a.decimalCount=
this.decimalCount;return a}}defineFormatType();function Map(){this.keyArray=[];this.valArray=[];this.put=put;this.get=get;this.size=size;this.clear=clear;this.keySet=keySet;this.valSet=valSet;this.showMe=showMe;this.findIt=findIt;this.remove=remove}function put(a,b){this.findIt(a)==-1&&(this.keyArray.push(a),this.valArray.push(b))}function get(a){var b=null,a=this.findIt(a);a!=-1&&(b=this.valArray[a]);return b}function remove(a){a=this.findIt(a);if(a!=-1)this.keyArray=removeAt(this.keyArray,a),this.valArray=removeAt(this.valArray,a)}
function size(){return this.keyArray.length}function clear(){for(;this.keyArray.length>0;)this.keyArray.pop(),this.valArray.pop()}function keySet(){return this.keyArray}function valSet(){return this.valArray}function showMe(){for(var a="",b=0;b<this.keyArray.length;b++)a+="Key: "+this.keyArray[b]+"\tValues: "+this.valArray[b]+"\n";return a}function findIt(a){for(var b=-1,c=0;c<this.keyArray.length;c++)if(this.keyArray[c]==a){b=c;break}return b}
function removeAt(a,b){var c=a.slice(0,b),d=a.slice(b+1);return c.concat(d)};function defineDropdown(){dropdownItemObj=function(a,b,c,d){this.name=a;this.shortcut=b;this.value=c;this.displayName=d};dropdown=function(){this.dropdownDiv=null;this.dropdownItemArray=[];this.dropdownItemCount=0;this.subMenu=null};dropdown.prototype.createDropdown=function(){this.dropdownDiv=document.createElement("div");this.dropdownDiv.className="dropdownDiv";document.body.appendChild(this.dropdownDiv)};dropdown.prototype.addItem=function(a){this.dropdownItemArray[this.dropdownItemCount]=a;this.dropdownDiv.appendChild(a.dropdownItemDiv);
this.dropdownItemCount++;a.parent=this;var b=this;a.dropdownItemDiv.onmouseover=function(){b.hideSubMenu()}};dropdown.prototype.hideSubMenu=function(){if(this.subMenu!=null)this.subMenu.dropdownDiv.style.display="none",document.body.removeChild(this.subMenu.dropdownDiv),this.subMenu=null};dropdown.prototype.showSubMenu=function(){if(this.subMenu!=null)document.body.appendChild(this.subMenu.dropdownDiv),this.subMenu.dropdownDiv.style.display="block"};dropdown.prototype.setPosition=function(a){this.dropdownDiv.style.left=
a.left+"px";this.dropdownDiv.style.top=a.top+"px"};dropdown.prototype.setWidth=function(a){this.dropdownDiv.style.width=a+"px"};dropdown.prototype.destroy=function(){this.hideSubMenu();document.body.removeChild(this.dropdownDiv)};dropdownItem=function(){this.parentDivElement=this.dropdownItemDiv=this.parent=this.subMenu=this.action=this.dropdownItemObj=null};dropdownItem.prototype.create=function(){this.dropdownItemDiv=document.createElement("div");this.dropdownItemDiv.parentObj=this;this.dropdownItemDiv.className=
"dropdownCell"};dropdownItem.prototype.setObj=function(a){this.dropdownItemObj=a;this.dropdownItemDiv.innerHTML=a.name};dropdownItem.prototype.setSelected=function(a){this.dropdownItemDiv.className=a?"dropdownCellSelected":"dropdownCell"};dropdownItem.prototype.setAction=function(a){this.action=a;this.dropdownItemDiv.onclick=a};dropdownItem.prototype.setParentDivElement=function(a){this.parentDivElement=a};dropdownItem.prototype.addSubMenuItem=function(a){var b=this;this.subMenu==null?(this.subMenu=
new dropdown,this.subMenu.createDropdown(this.dropdownItemId+"subMenu"),document.body.removeChild(this.subMenu.dropdownDiv),this.subMenu.addItem(a),b.dropdownItemDiv.innerHTML+="<span class='fr' style='padding-left:5px'><img src='/static/newGrid/img/side-arrow.png'/></span>",this.dropdownItemDiv.onmouseover=function(){b.parent.hideSubMenu();b.parent.subMenu=b.subMenu;b.parent.showSubMenu()},this.subMenu.dropdownDiv.style.left=getLengthFromString(this.parent.dropdownDiv.style.left)+this.parent.dropdownDiv.offsetWidth+
"px",this.subMenu.dropdownDiv.style.top=findPosY(b.dropdownItemDiv)+"px"):this.subMenu.addItem(a)}}defineDropdown();var workbook={grids:new Map,nameMap:new Map,copiedCellArray:[],copiedRange:"",curDionGrid:null,curXLSRowNo:0,curXLSColNo:0,formulaRange:"",contextMenuDiv:null,cellMap:{},registerGrid:function(a,b){workbook.grids.put(a,b)},getGridById:function(a){return workbook.grids.get(a)},nameRange:function(a,b,c){workbook.nameMap.put(a,b+"."+c)},stopKeyCapture:function(){if(workbook.curDionGrid)workbook.curDionGrid.mode="none"},getCellByName:function(a){if(a=workbook.nameMap.get(a)){var b=a.split(".");if(b.length==
2&&(a=workbook.grids.get(b[0]))&&isCell(b[1])){var c=getCellRowCol(b[1].toUpperCase()),b=parseInt(c[1]),c=getColNoFromLabel(c[0]);if(a.isInXLSRange(b,c))return a.XLSCellArray[b][c].value}}},getCellValueArrayByRange:function(a){if(a=workbook.nameMap.get(a)){var b=a.split(".");if(b.length==2&&(a=workbook.grids.get(b[0])))if(isRange(b[1])){for(var c=[],d=getCellRowCol(b[1].split(":")[0].toUpperCase()),e=parseInt(d[1]),f=getColNoFromLabel(d[0]),d=getCellRowCol(b[1].split(":")[1].toUpperCase()),b=parseInt(d[1]),
d=getColNoFromLabel(d[0]),g=e;g<=b;g++){c[g-e]=[];for(var h=f;h<=d;h++)if(a.isInLRange(g,h))c[g-e][h-f]=a.XLSCellArray[g][h].value}return c}else if(isCell(b[1])&&(d=getCellRowCol(b[1].toUpperCase()),e=parseInt(d[1]),f=getColNoFromLabel(d[0]),a.isInXLSRange(e,f)))return c=[],c[0]=a.XLSCellArray[e][f].value,c}},getRangeNoByName:function(a){if(a=workbook.nameMap.get(a)){var b=a.split(".");if(b.length==2&&workbook.grids.get(b[0]))if(isRange(b[1])){var a=getCellRowCol(b[1].split(":")[0].toUpperCase()),
c=parseInt(a[1]),d=getColNoFromLabel(a[0]),a=getCellRowCol(b[1].split(":")[1].toUpperCase()),b=parseInt(a[1]),a=getColNoFromLabel(a[0]);return{startRow:c,startCol:d,endRow:b,endCol:a}}else if(isCell(b[1]))return a=getCellRowCol(b[1].toUpperCase()),c=parseInt(a[1]),a=getColNoFromLabel(a[0]),{startRow:c,startCol:a,endRow:c,endCol:a}}},setValueByName:function(a,b){workbook.nameMap.get(a);var c=a.split(".");if(c.length==2){var d=workbook.getGridById(c[0]);if(d){if(isCell(c[1])){var e=getCellRowCol(range.toUpperCase()),
c=parseInt(e[1]),e=getColNoFromLabel(e[0]);d.isInXLSRange(c,e)&&d.setValue(c,e,b)}return null}}},setCopiedRange:function(a,b){if(isNumRange(b)&&workbook.getGridById(a))workbook.copiedRange=a+"."+b},clearCopiedRange:function(){workbook.copiedRange="";workbook.copiedCellArray=[]},getCellByString:function(a){if(!isGridCell(a))return null;var b=a.split("."),a=workbook.getGridById(b[0]);if(!a)return null;var c=getCellRowCol(b[1].toUpperCase()),b=parseInt(c[1]),c=getColNoFromLabel(c[0]);return a.XLSCellArray[b][c]},
isCurGrid:function(a){a=a.gridName;return workbook.curDionGrid!=null?workbook.curDionGrid.gridName==a:!1},setCellId:function(a,b,c){if(a&&b)b=b.gridName,workbook.cellMap[b]||(workbook.cellMap[b]={}),workbook.cellMap[b][a]=c},getCellById:function(a,b){if(a){var a=""+a,c=a.split("."),d="";if(c.length==1)d=b.gridName;else if(c.length==2)d=c[0],a=c[1];else return null;return!workbook.cellMap[d]?null:workbook.cellMap[d][a]}}};(function(a){var b=function(){var b={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"},d={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',
head:["<td>",'<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>','<th colspan="6" class="datepickerMonth"><a href="#"><span></span></a></th>','<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=week%></span></th>","<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>",
"<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[0].week%></span></a></th>','<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>',
'<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',
"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[1].week%></span></a></th>','<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>',
'<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[2].week%></span></a></th>','<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>',
'<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>',
'<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[3].week%></span></a></th>','<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>',
'<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[4].week%></span></a></th>',
'<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>',
'<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[5].week%></span></a></th>','<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>',
'<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',
"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>',
'<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]},e={flat:!1,starts:1,prev:"&#9664;",next:"&#9654;",lastSel:!1,mode:"single",view:"days",calendars:1,format:"d b Y",position:"bottom",eventName:"click",
onRender:function(){return{}},onChange:function(){return!0},onShow:function(){return!0},onBeforeShow:function(){return!0},onHide:function(){return!0},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar",
"Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekMin:"wk"}},f=function(b){var c=a(b).data("datepicker"),b=a(b),f=Math.floor(c.calendars/2),e,g,i,j,k=0,m,l,t,n,p;b.find("td>table tbody").remove();for(var u=0;u<c.calendars;u++){e=new Date(c.current);e.addMonths(-f+u);p=b.find("table").eq(u+1);switch(p[0].className){case "datepickerViewDays":i=h(e,"B, Y");break;case "datepickerViewMonths":i=e.getFullYear();break;case "datepickerViewYears":i=e.getFullYear()-6+" - "+(e.getFullYear()+5)}p.find("thead tr:first th:eq(1) span").text(i);
i=e.getFullYear()-6;g={data:[],className:"datepickerYears"};for(j=0;j<12;j++)g.data.push(i+j);n=tmpl(d.months.join(""),g);e.setDate(1);g={weeks:[],test:10};j=e.getMonth();i=(e.getDay()-c.starts)%7;e.addDays(-(i+(i<0?7:0)));for(k=0;k<42;){l=parseInt(k/7,10);t=k%7;g.weeks[l]||(m=e.getWeekNumber(),g.weeks[l]={week:m,days:[]});g.weeks[l].days[t]={text:e.getDate(),classname:[]};j!=e.getMonth()&&g.weeks[l].days[t].classname.push("datepickerNotInMonth");e.getDay()==0&&g.weeks[l].days[t].classname.push("datepickerSunday");
e.getDay()==6&&g.weeks[l].days[t].classname.push("datepickerSaturday");m=c.onRender(e);var v=e.valueOf();(m.selected||c.date==v||a.inArray(v,c.date)>-1||c.mode=="range"&&v>=c.date[0]&&v<=c.date[1])&&g.weeks[l].days[t].classname.push("datepickerSelected");m.disabled&&g.weeks[l].days[t].classname.push("datepickerDisabled");m.className&&g.weeks[l].days[t].classname.push(m.className);g.weeks[l].days[t].classname=g.weeks[l].days[t].classname.join(" ");k++;e.addDays(1)}n=tmpl(d.days.join(""),g)+n;g={data:c.locale.monthsShort,
className:"datepickerMonths"};n=tmpl(d.months.join(""),g)+n;p.append(n)}},g=function(a,b){if(a.constructor==Date)return new Date(a);for(var c=a.split(/\W+/),d=b.split(/\W+/),f,e,g,i,h,j=new Date,k=0;k<c.length;k++)switch(d[k]){case "d":case "e":f=parseInt(c[k],10);break;case "m":e=parseInt(c[k],10)-1;break;case "Y":case "y":g=parseInt(c[k],10);g+=g>100?0:g<29?2E3:1900;break;case "H":case "I":case "k":case "l":i=parseInt(c[k],10);break;case "P":case "p":/pm/i.test(c[k])&&i<12?i+=12:/am/i.test(c[k])&&
i>=12&&(i-=12);break;case "M":h=parseInt(c[k],10);break;case "b":for(var m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=0;l<m.length;l++)if(m[l]==c[k]){e=l;break}}return new Date(g===void 0?j.getFullYear():g,e===void 0?j.getMonth():e,f===void 0?j.getDate():f,i===void 0?j.getHours():i,h===void 0?j.getMinutes():h,0)},h=function(a,b){var c=a.getMonth(),d=a.getDate(),f=a.getFullYear();a.getWeekNumber();var e=a.getDay(),g=a.getHours(),i=g>=12,h=i?g-12:g,j=a.getDayOfYear();
h==0&&(h=12);for(var k=a.getMinutes(),m=a.getSeconds(),l=b.split(""),n,p=0;p<l.length;p++){n=l[p];switch(l[p]){case "a":n=a.getDayName();break;case "A":n=a.getDayName(!0);break;case "b":n=a.getMonthName();break;case "B":n=a.getMonthName(!0);break;case "C":n=1+Math.floor(f/100);break;case "d":n=d<10?"0"+d:d;break;case "e":n=d;break;case "H":n=g<10?"0"+g:g;break;case "I":n=h<10?"0"+h:h;break;case "j":n=j<100?j<10?"00"+j:"0"+j:j;break;case "k":n=g;break;case "l":n=h;break;case "m":n=c<9?"0"+(1+c):1+
c;break;case "M":n=k<10?"0"+k:k;break;case "p":case "P":n=i?"PM":"AM";break;case "s":n=Math.floor(a.getTime()/1E3);break;case "S":n=m<10?"0"+m:m;break;case "u":n=e+1;break;case "w":n=e;break;case "y":n=(""+f).substr(2,2);break;case "Y":n=f}l[p]=n}return l.join("")},i=function(a){if(!Date.prototype.tempDate)Date.prototype.tempDate=null,Date.prototype.months=a.months,Date.prototype.monthsShort=a.monthsShort,Date.prototype.days=a.days,Date.prototype.daysShort=a.daysShort,Date.prototype.getMonthName=
function(a){return this[a?"months":"monthsShort"][this.getMonth()]},Date.prototype.getDayName=function(a){return this[a?"days":"daysShort"][this.getDay()]},Date.prototype.addDays=function(a){this.setDate(this.getDate()+a);this.tempDate=this.getDate()},Date.prototype.addMonths=function(a){if(this.tempDate==null)this.tempDate=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+a);this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.addYears=function(a){if(this.tempDate==
null)this.tempDate=this.getDate();this.setDate(1);this.setFullYear(this.getFullYear()+a);this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.getMaxDays=function(){var a=new Date(Date.parse(this)),b=28,c;c=a.getMonth();for(b=28;a.getMonth()==c;)b++,a.setDate(b);return b-1},Date.prototype.getFirstDay=function(){var a=new Date(Date.parse(this));a.setDate(1);return a.getDay()},Date.prototype.getWeekNumber=function(){var a=new Date(this);a.setDate(a.getDate()-(a.getDay()+6)%7+3);var b=
a.valueOf();a.setMonth(0);a.setDate(4);return Math.round((b-a.valueOf())/6048E5)+1},Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),b=new Date(this.getFullYear(),0,0,0,0,0);return Math.floor((a-b)/24*36E5)}},j=function(b){var c=a(b).data("datepicker"),d=a("#"+c.id);if(!c.extraHeight)b=a(b).find("div"),c.extraHeight=b.get(0).offsetHeight+b.get(1).offsetHeight,c.extraWidth=b.get(2).offsetWidth+b.get(3).offsetWidth;var f=d.find("table:first").get(0),
b=f.offsetWidth,f=f.offsetHeight;d.css({width:b+c.extraWidth+"px",height:f+c.extraHeight+"px"}).find("div.datepickerContainer").css({width:b+"px",height:f+"px"})},k=function(b){if(a(b.target).is("span"))b.target=b.target.parentNode;var c=a(b.target);if(c.is("a")){b.target.blur();if(c.hasClass("datepickerDisabled"))return!1;var d=a(this).data("datepicker"),b=c.parent(),e=b.parent().parent().parent(),g=a("table",this).index(e.get(0))-1,i=new Date(d.current),j=!1,k=!1;if(b.is("th"))if(b.hasClass("datepickerWeek")&&
d.mode=="range"&&!b.next().hasClass("datepickerDisabled")){var l=parseInt(b.next().text(),10);i.addMonths(g-Math.floor(d.calendars/2));b.next().hasClass("datepickerNotInMonth")&&i.addMonths(l>15?-1:1);i.setDate(l);d.date[0]=i.setHours(0,0,0,0).valueOf();i.setHours(23,59,59,0);i.addDays(6);d.date[1]=i.valueOf();j=k=!0;d.lastSel=!1}else if(b.hasClass("datepickerMonth"))switch(i.addMonths(g-Math.floor(d.calendars/2)),e.get(0).className){case "datepickerViewDays":e.get(0).className="datepickerViewMonths";
c.find("span").text(i.getFullYear());break;case "datepickerViewMonths":e.get(0).className="datepickerViewYears";c.find("span").text(i.getFullYear()-6+" - "+(i.getFullYear()+5));break;case "datepickerViewYears":e.get(0).className="datepickerViewDays",c.find("span").text(h(i,"B, Y"))}else{if(b.parent().parent().is("thead")){switch(e.get(0).className){case "datepickerViewDays":d.current.addMonths(b.hasClass("datepickerGoPrev")?-1:1);break;case "datepickerViewMonths":d.current.addYears(b.hasClass("datepickerGoPrev")?
-1:1);break;case "datepickerViewYears":d.current.addYears(b.hasClass("datepickerGoPrev")?-12:12)}k=!0}}else if(b.is("td")&&!b.hasClass("datepickerDisabled")){switch(e.get(0).className){case "datepickerViewMonths":d.current.setMonth(e.find("tbody.datepickerMonths td").index(b));d.current.setFullYear(parseInt(e.find("thead th.datepickerMonth span").text(),10));d.current.addMonths(Math.floor(d.calendars/2)-g);e.get(0).className="datepickerViewDays";break;case "datepickerViewYears":d.current.setFullYear(parseInt(c.text(),
10));e.get(0).className="datepickerViewMonths";break;default:switch(l=parseInt(c.text(),10),i.addMonths(g-Math.floor(d.calendars/2)),b.hasClass("datepickerNotInMonth")&&i.addMonths(l>15?-1:1),j=!0,i.setDate(l),d.mode){case "multiple":l=i.setHours(0,0,0,0).valueOf();a.inArray(l,d.date)>-1?a.each(d.date,function(a,b){if(b==l)return d.date.splice(a,1),!1}):d.date.push(l);break;case "range":d.lastSel||(d.date[0]=i.setHours(0,0,0,0).valueOf());l=i.setHours(23,59,59,0).valueOf();l<d.date[0]?(d.date[1]=
d.date[0]+86399E3,d.date[0]=l-86399E3):d.date[1]=l;d.lastSel=!d.lastSel;break;default:d.date=i.valueOf()}}k=!0}k&&f(this);j&&d.onChange.apply(this,m(d))}return!1},m=function(b){var c;return b.mode=="single"?(c=new Date(b.date),[h(c,b.format),c,b.el]):(c=[[],[],b.el],a.each(b.date,function(a,d){var f=new Date(d);c[0].push(h(f,b.format));c[1].push(f)}),c)},l=function(a,b,c){if(a==b)return!0;if(a.contains)return a.contains(b);if(a.compareDocumentPosition)return!!(a.compareDocumentPosition(b)&16);for(b=
b.parentNode;b&&b!=c;){if(b==a)return!0;b=b.parentNode}return!1},p=function(){var b=a("#"+a(this).data("datepickerId"));if(!b.is(":visible")){var c=b.get(0);f(c);var d=b.data("datepicker");d.onBeforeShow.apply(this,[b.get(0)]);var e=a(this).offset(),g;g=document.compatMode=="CSS1Compat";g={l:window.pageXOffset||(g?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(g?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(g?document.documentElement.clientWidth:
document.body.clientWidth),h:window.innerHeight||(g?document.documentElement.clientHeight:document.body.clientHeight)};var i=e.top,h=e.left;a.curCSS(c,"display");b.css({visibility:"hidden",display:"block"});j(c);switch(d.position){case "top":i-=c.offsetHeight;break;case "left":h-=c.offsetWidth;break;case "right":h+=this.offsetWidth;break;case "bottom":i+=this.offsetHeight}i+c.offsetHeight>g.t+g.h&&(i=e.top-c.offsetHeight);i<g.t&&(i=e.top+this.offsetHeight+c.offsetHeight);h+c.offsetWidth>g.l+g.w&&
(h=e.left-c.offsetWidth);h<g.l&&(h=e.left+this.offsetWidth);b.css({visibility:"visible",display:"block",top:i+"px",left:h+"px"});d.onShow.apply(this,[b.get(0)])!=!1&&b.show();a(document).bind("mousedown",{cal:b,trigger:this},n)}return!1},n=function(b){b.target!=b.data.trigger&&!l(b.data.cal.get(0),b.target,b.data.cal.get(0))&&(b.data.cal.data("datepicker")&&b.data.cal.data("datepicker").onHide.apply(this,[b.data.cal.get(0)])!=!1&&b.data.cal.hide(),a(document).unbind("mousedown",n))};return{init:function(h){h=
a.extend({},e,h||{});i(h.locale);h.calendars=Math.max(1,parseInt(h.calendars,10)||1);h.mode=/single|multiple|range/.test(h.mode)?h.mode:"single";return this.each(function(){if(!a(this).data("datepicker")){h.el=this;if(h.date.constructor==String)h.date=g(h.date,h.format),h.date.setHours(0,0,0,0);if(h.mode!="single")if(h.date.constructor!=Array)h.date=[h.date.valueOf()],h.mode=="range"&&h.date.push((new Date(h.date[0])).setHours(23,59,59,0).valueOf());else{for(var e=0;e<h.date.length;e++)h.date[e]=
g(h.date[e],h.format).setHours(0,0,0,0).valueOf();h.mode=="range"&&(h.date[1]=(new Date(h.date[1])).setHours(23,59,59,0).valueOf())}else h.date=h.date.valueOf();h.current=h.current?g(h.current,h.format):new Date;h.current.setDate(1);h.current.setHours(0,0,0,0);var e="datepicker_"+parseInt(Math.random()*1E3),i;h.id=e;a(this).data("datepickerId",h.id);var o=a(d.wrapper).attr("id",e).bind("click",k).data("datepicker",h);h.className&&o.addClass(h.className);for(var l="",e=0;e<h.calendars;e++)i=h.starts,
e>0&&(l+=d.space),l+=tmpl(d.head.join(""),{week:h.locale.weekMin,prev:h.prev,next:h.next,day1:h.locale.daysMin[i++%7],day2:h.locale.daysMin[i++%7],day3:h.locale.daysMin[i++%7],day4:h.locale.daysMin[i++%7],day5:h.locale.daysMin[i++%7],day6:h.locale.daysMin[i++%7],day7:h.locale.daysMin[i++%7]});o.find("tr:first").append(l).find("table").addClass(b[h.view]);f(o.get(0));h.flat?(o.appendTo(this).show().css("position","relative"),j(o.get(0))):(o.appendTo(document.body),a(this).bind(h.eventName,p))}})},
showPicker:function(){return this.each(function(){a(this).data("datepickerId")&&p.apply(this)})},hidePicker:function(){return this.each(function(){a(this).data("datepickerId")&&a("#"+a(this).data("datepickerId")).hide()})},togglePicker:function(){return a("#"+a(this).data("datepickerId")).is(":visible")?this.each(function(){a(this).data("datepickerId")&&a("#"+a(this).data("datepickerId")).hide()}):this.each(function(){a(this).data("datepickerId")&&p.apply(this)})},setDate:function(b,c){return this.each(function(){if(a(this).data("datepickerId")){var d=
a("#"+a(this).data("datepickerId")),e=d.data("datepicker");e.date=b;if(e.date.constructor==String)e.date=g(e.date,e.format),e.date.setHours(0,0,0,0);if(e.mode!="single")if(e.date.constructor!=Array)e.date=[e.date.valueOf()],e.mode=="range"&&e.date.push((new Date(e.date[0])).setHours(23,59,59,0).valueOf());else{for(var h=0;h<e.date.length;h++)e.date[h]=g(e.date[h],e.format).setHours(0,0,0,0).valueOf();e.mode=="range"&&(e.date[1]=(new Date(e.date[1])).setHours(23,59,59,0).valueOf())}else e.date=e.date.valueOf();
if(c)e.current=new Date(e.mode!="single"?e.date[0]:e.date);f(d.get(0))}})},getDate:function(b){if(this.size()>0)return m(a("#"+a(this).data("datepickerId")).data("datepicker"))[b?0:1]},clear:function(){return this.each(function(){if(a(this).data("datepickerId")){var b=a("#"+a(this).data("datepickerId")),c=b.data("datepicker");if(c.mode!="single")c.date=[],f(b.get(0))}})},fixLayout:function(){return this.each(function(){if(a(this).data("datepickerId")){var b=a("#"+a(this).data("datepickerId"));b.data("datepicker").flat&&
j(b.get(0))}})}}}();a.fn.extend({DatePicker:b.init,DatePickerHide:b.hidePicker,DatePickerShow:b.showPicker,DatePickerToggle:b.togglePicker,DatePickerSetDate:b.setDate,DatePickerGetDate:b.getDate,DatePickerClear:b.clear,DatePickerLayout:b.fixLayout})})(jQuery);
(function(){var a={};this.tmpl=function c(d,e){var f=!/\W/.test(d)?a[d]=a[d]||c(document.getElementById(d).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+d.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return e?f(e):f}})();(function(a){a.fn.extend({autocomplete:function(b,c){var d=typeof b=="string",c=a.extend({},a.Autocompleter.defaults,{url:d?b:null,data:d?null:b,delay:d?a.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(a){return a};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c)})},result:function(a){return this.bind("result",a)},search:function(a){return this.trigger("search",[a])},flushCache:function(){return this.trigger("flushCache")},
setOptions:function(a){return this.trigger("setOptions",[a])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(b,c){function d(){var d=o.selected();if(!d)return!1;var e=d.result;p=e;if(c.multiple){var g=f(m.val());if(g.length>1){var i=c.multipleSeparator.length,j=a(b).selection().start,k,l=0;a.each(g,function(a,b){l+=b.length;if(j<=l)return k=a,!1;l+=i});g[k]=e;e=g.join(c.multipleSeparator)}e+=c.multipleSeparator}m.val(e);h();m.trigger("result",[d.data,d.value]);
return!0}function e(a,b){if(r==k.DEL)o.hide();else{var d=m.val();if(b||d!=p)p=d,d=g(d),d.length>=c.minChars?(m.addClass(c.loadingClass),c.matchCase||(d=d.toLowerCase()),j(d,i,h)):(m.removeClass(c.loadingClass),o.hide())}}function f(b){return!b?[""]:!c.multiple?[a.trim(b)]:a.map(b.split(c.multipleSeparator),function(c){return a.trim(b).length?a.trim(c):null})}function g(d){if(!c.multiple)return d;var e=f(d);if(e.length==1)return e[0];e=a(b).selection().start;e=e==d.length?f(d):f(d.replace(d.substring(e),
""));return e[e.length-1]}function h(){o.visible();o.hide();clearTimeout(l);m.removeClass(c.loadingClass);c.mustMatch&&m.search(function(a){a||(c.multiple?(a=f(m.val()).slice(0,-1),m.val(a.join(c.multipleSeparator)+(a.length?c.multipleSeparator:""))):(m.val(""),m.trigger("result",null)))})}function i(d,e){if(e&&e.length&&s){m.removeClass(c.loadingClass);o.display(e,d);var f=e[0].value;c.autoFill&&g(m.val()).toLowerCase()==d.toLowerCase()&&r!=k.BACKSPACE&&(m.val(m.val()+f.substring(g(p).length)),a(b).selection(p.length,
p.length+f.length));o.show()}else h()}function j(d,e,f){c.matchCase||(d=d.toLowerCase());var h=n.load(d);if(h&&h.length)e(d,h);else if(typeof c.url=="string"&&c.url.length>0){var i={timestamp:+new Date};a.each(c.extraParams,function(a,b){i[a]=typeof b=="function"?b():b});a.ajax({mode:"abort",port:"autocomplete"+b.name,dataType:c.dataType,url:c.url,data:a.extend({q:g(d),limit:c.max},i),success:function(b){var f;if(!(f=c.parse&&c.parse(b))){f=[];for(var b=b.split("\n"),g=0;g<b.length;g++){var h=a.trim(b[g]);
h&&(h=h.split("|"),f[f.length]={data:h,value:h[0],result:c.formatResult&&c.formatResult(h,h[0])||h[0]})}}n.add(d,f);e(d,f)}})}else o.emptyList(),f(d)}var k={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},m=a(b).attr("autocomplete","off").addClass(c.inputClass),l,p="",n=a.Autocompleter.Cache(c),s=0,r,q={mouseDownOnSelect:!1},o=a.Autocompleter.Select(c,b,d,q),w;a.browser.opera&&a(b.form).bind("submit.autocomplete",function(){if(w)return w=!1});m.bind((a.browser.opera?
"keypress":"keydown")+".autocomplete",function(b){s=1;r=b.keyCode;switch(b.keyCode){case k.UP:b.preventDefault();o.visible()?o.prev():e(0,!0);break;case k.DOWN:b.preventDefault();o.visible()?o.next():e(0,!0);break;case k.PAGEUP:b.preventDefault();o.visible()?o.pageUp():e(0,!0);break;case k.PAGEDOWN:b.preventDefault();o.visible()?o.pageDown():e(0,!0);break;case c.multiple&&a.trim(c.multipleSeparator)==","&&k.COMMA:case k.TAB:case k.RETURN:if(d())return b.preventDefault(),w=!0,!1;break;case k.ESC:o.hide();
break;default:clearTimeout(l),l=setTimeout(e,c.delay)}}).focus(function(){s++}).blur(function(){s=0;q.mouseDownOnSelect||(clearTimeout(l),l=setTimeout(h,200))}).click(function(){s++>1&&!o.visible()&&e(0,!0)}).bind("search",function(){function b(a,d){var e;if(d&&d.length)for(var f=0;f<d.length;f++)if(d[f].result.toLowerCase()==a.toLowerCase()){e=d[f];break}typeof c=="function"?c(e):m.trigger("result",e&&[e.data,e.value])}var c=arguments.length>1?arguments[1]:null;a.each(f(m.val()),function(a,c){j(c,
b,b)})}).bind("flushCache",function(){n.flush()}).bind("setOptions",function(b,d){a.extend(c,d);"data"in d&&n.populate()}).bind("unautocomplete",function(){o.unbind();m.unbind();a(b.form).unbind(".autocomplete")})};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(a){return a[0]},formatMatch:null,autoFill:!1,
width:0,multiple:!1,multipleSeparator:", ",highlight:function(a,c){return a.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+c.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180};a.Autocompleter.Cache=function(b){function c(a,c){b.matchCase||(a=a.toLowerCase());var d=a.indexOf(c);b.matchContains=="word"&&(d=a.toLowerCase().search("\\b"+c.toLowerCase()));return d==-1?!1:d==0||b.matchContains}function d(a,c){h>b.cacheLength&&
f();g[a]||h++;g[a]=c}function e(){if(!b.data)return!1;var c={},e=0;if(!b.url)b.cacheLength=1;c[""]=[];for(var f=0,g=b.data.length;f<g;f++){var h=b.data[f],h=typeof h=="string"?[h]:h,p=b.formatMatch(h,f+1,b.data.length);if(p!==!1){var n=p.charAt(0).toLowerCase();c[n]||(c[n]=[]);h={value:p,data:h,result:b.formatResult&&b.formatResult(h)||p};c[n].push(h);e++<b.max&&c[""].push(h)}}a.each(c,function(a,c){b.cacheLength++;d(a,c)})}function f(){g={};h=0}var g={},h=0;setTimeout(e,25);return{flush:f,add:d,
populate:e,load:function(d){if(!b.cacheLength||!h)return null;if(!b.url&&b.matchContains){var e=[],f;for(f in g)if(f.length>0){var m=g[f];a.each(m,function(a,b){c(b.value,d)&&e.push(b)})}return e}else if(g[d])return g[d];else if(b.matchSubset)for(f=d.length-1;f>=b.minChars;f--)if(m=g[d.substr(0,f)])return e=[],a.each(m,function(a,b){c(b.value,d)&&(e[e.length]=b)}),e;return null}}};a.Autocompleter.Select=function(b,c,d,e){function f(){p&&(n=a("<div/>").hide().addClass(b.resultsClass).css("position",
"absolute").appendTo(document.body),s=a("<ul/>").appendTo(n).mouseover(function(b){g(b).nodeName&&g(b).nodeName.toUpperCase()=="LI"&&(k=a("li",s).removeClass(i.ACTIVE).index(g(b)),a(g(b)).addClass(i.ACTIVE))}).click(function(b){a(g(b)).addClass(i.ACTIVE);d();c.focus();return!1}).mousedown(function(){e.mouseDownOnSelect=!0}).mouseup(function(){e.mouseDownOnSelect=!1}),b.width>0&&n.css("width",b.width),p=!1)}function g(a){for(a=a.target;a&&a.tagName!="LI";)a=a.parentNode;return!a?[]:a}function h(a){j.slice(k,
k+1).removeClass(i.ACTIVE);k+=a;k<0?k=j.size()-1:k>=j.size()&&(k=0);a=j.slice(k,k+1).addClass(i.ACTIVE);if(b.scroll){var c=0;j.slice(0,k).each(function(){c+=this.offsetHeight});c+a[0].offsetHeight-s.scrollTop()>s[0].clientHeight?s.scrollTop(c+a[0].offsetHeight-s.innerHeight()):c<s.scrollTop()&&s.scrollTop(c)}}var i={ACTIVE:"ac_over"},j,k=-1,m,l="",p=!0,n,s;return{display:function(c,d){f();m=c;l=d;s.empty();for(var e=b.max&&b.max<m.length?b.max:m.length,g=0;g<e;g++)if(m[g]){var h=b.formatItem(m[g].data,
g+1,e,m[g].value,l);h!==!1&&(h=a("<li/>").html(b.highlight(h,l)).addClass(g%2==0?"ac_even":"ac_odd").appendTo(s)[0],a.data(h,"ac_data",m[g]))}j=s.find("li");b.selectFirst&&(j.slice(0,1).addClass(i.ACTIVE),k=0);a.fn.bgiframe&&s.bgiframe()},next:function(){h(1)},prev:function(){h(-1)},pageUp:function(){k!=0&&k-8<0?h(-k):h(-8)},pageDown:function(){k!=j.size()-1&&k+8>j.size()?h(j.size()-1-k):h(8)},hide:function(){n&&n.hide();j&&j.removeClass(i.ACTIVE);k=-1},visible:function(){return n&&n.is(":visible")},
current:function(){return this.visible()&&(j.filter("."+i.ACTIVE)[0]||b.selectFirst&&j[0])},show:function(){var d=a(c).offset();n.css({width:typeof b.width=="string"||b.width>0?b.width:a(c).width(),top:d.top+c.offsetHeight,left:d.left}).show();if(b.scroll&&(s.scrollTop(0),s.css({maxHeight:b.scrollHeight,overflow:"auto"}),a.browser.msie&&typeof document.body.style.maxHeight==="undefined")){var e=0;j.each(function(){e+=this.offsetHeight});d=e>b.scrollHeight;s.css("height",d?b.scrollHeight:e);d||j.width(s.width()-
parseInt(j.css("padding-left"))-parseInt(j.css("padding-right")))}},selected:function(){var b=j&&j.filter("."+i.ACTIVE).removeClass(i.ACTIVE);return b&&b.length&&a.data(b[0],"ac_data")},emptyList:function(){s&&s.empty()},unbind:function(){n&&n.remove()}}};a.fn.selection=function(a,c){if(a!==void 0)return this.each(function(){if(this.createTextRange){var d=this.createTextRange();c===void 0||a==c?d.move("character",a):(d.collapse(!0),d.moveStart("character",a),d.moveEnd("character",c));d.select()}else if(this.setSelectionRange)this.setSelectionRange(a,
c);else if(this.selectionStart)this.selectionStart=a,this.selectionEnd=c});var d=this[0];if(d.createTextRange){var e=document.selection.createRange(),f=d.value,g=e.text.length;e.text="<->";e=d.value.indexOf("<->");d.value=f;this.selection(e,e+g);return{start:e,end:e+g}}else if(d.selectionStart!==void 0)return{start:d.selectionStart,end:d.selectionEnd}}})(jQuery);
